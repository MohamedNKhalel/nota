"use strict";(self.webpackChunknota=self.webpackChunknota||[]).push([[881],{8398:(Pu,mr,re)=>{re.d(mr,{$:()=>Gu,A:()=>ct,G:()=>jt,K:()=>ta,L:()=>zn,N:()=>Mt,P:()=>$i,R:()=>sr,U:()=>Te,V:()=>Cs,W:()=>Uu,X:()=>Bu,Y:()=>vt,Z:()=>bi,_:()=>Ci,a:()=>qi,a0:()=>Oe,a1:()=>Ms,a2:()=>Wu,a3:()=>Jn,a4:()=>Ku,a5:()=>Rt,a6:()=>$u,a7:()=>Gs,a8:()=>fa,a9:()=>Di,aA:()=>Ho,aB:()=>Qe,aC:()=>H,aD:()=>Da,aE:()=>de,aF:()=>He,aG:()=>kr,aH:()=>Tc,aI:()=>vc,aJ:()=>Je,aN:()=>Dn,aQ:()=>Ne,aa:()=>Zu,ab:()=>Nn,ac:()=>Ll,ad:()=>Qu,ae:()=>Oi,af:()=>Li,ag:()=>Ml,ah:()=>Fl,ak:()=>Hu,al:()=>Ul,am:()=>Bl,ap:()=>la,aq:()=>Fi,as:()=>ni,at:()=>Re,au:()=>gt,av:()=>wi,aw:()=>_n,ax:()=>q,ay:()=>Fa,az:()=>Un,b:()=>Aa,c:()=>lo,d:()=>nh,e:()=>th,f:()=>Ec,g:()=>Va,h:()=>Ac,i:()=>wa,j:()=>wc,k:()=>Nc,l:()=>On,m:()=>mh,p:()=>We,r:()=>eh,s:()=>Xl,u:()=>Cr});var w=re(5861),ae=re(534),A=re(9058),ye=re(7879),Tt=re(7582),ut=re(4537);const We={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ct={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const jt=function lt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Nt=function kt(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},dn=new A.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),nn=new ye.Yd("@firebase/auth");function gr(l,...o){nn.logLevel<=ye.in.ERROR&&nn.error(`Auth (${ae.SDK_VERSION}): ${l}`,...o)}function q(l,...o){throw rn(l,...o)}function Qe(l,...o){return rn(l,...o)}function bn(l,o,a){const h=Object.assign(Object.assign({},Nt()),{[o]:a});return new A.LL("auth","Firebase",h).create(o,{appName:l.name})}function Pe(l){return bn(l,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ge(l,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&q(l,"argument-error"),bn(l,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function rn(l,...o){if("string"!=typeof l){const a=o[0],h=[...o.slice(1)];return h[0]&&(h[0].appName=l.name),l._errorFactory.create(a,...h)}return dn.create(l,...o)}function H(l,o,...a){if(!l)throw rn(o,...a)}function st(l){const o="INTERNAL ASSERTION FAILED: "+l;throw gr(o),new Error(o)}function gt(l,o){l||st(o)}function Wt(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function Ue(){return"http:"===sn()||"https:"===sn()}function sn(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class Kt{constructor(o,a){this.shortDelay=o,this.longDelay=a,gt(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,A.uI)()||(0,A.b$)()}get(){return function Ct(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Ue()||(0,A.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function _t(l,o){gt(l.emulator,"Emulator should always be set here");const{url:a}=l.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class ft{static initialize(o,a,h){this.fetchImpl=o,a&&(this.headersImpl=a),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void st("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void st("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void st("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const fn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Dt=new Kt(3e4,6e4);function Se(l,o){return l.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:l.tenantId}):o}function be(l,o,a,h){return Le.apply(this,arguments)}function Le(){return(Le=(0,w.Z)(function*(l,o,a,h,g={}){return on(l,g,(0,w.Z)(function*(){let I={},b={};h&&("GET"===o?b=h:I={body:JSON.stringify(h)});const F=(0,A.xO)(Object.assign({key:l.config.apiKey},b)).slice(1),$=yield l._getAdditionalHeaders();return $["Content-Type"]="application/json",l.languageCode&&($["X-Firebase-Locale"]=l.languageCode),ft.fetch()(K(l,l.config.apiHost,a,F),Object.assign({method:o,headers:$,referrerPolicy:"no-referrer"},I))}))})).apply(this,arguments)}function on(l,o,a){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,w.Z)(function*(l,o,a){l._canInitEmulator=!1;const h=Object.assign(Object.assign({},fn),o);try{const g=new ot(l),I=yield Promise.race([a(),g.promise]);g.clearNetworkTimeout();const b=yield I.json();if("needConfirmation"in b)throw xe(l,"account-exists-with-different-credential",b);if(I.ok&&!("errorMessage"in b))return b;{const F=I.ok?b.errorMessage:b.error.message,[$,ie]=F.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===$)throw xe(l,"credential-already-in-use",b);if("EMAIL_EXISTS"===$)throw xe(l,"email-already-in-use",b);if("USER_DISABLED"===$)throw xe(l,"user-disabled",b);const ce=h[$]||$.toLowerCase().replace(/[_\s]+/g,"-");if(ie)throw bn(l,ce,ie);q(l,ce)}}catch(g){if(g instanceof A.ZR)throw g;q(l,"network-request-failed",{message:String(g)})}})).apply(this,arguments)}function pt(l,o,a,h){return an.apply(this,arguments)}function an(){return(an=(0,w.Z)(function*(l,o,a,h,g={}){const I=yield be(l,o,a,h,g);return"mfaPendingCredential"in I&&q(l,"multi-factor-auth-required",{_serverResponse:I}),I})).apply(this,arguments)}function K(l,o,a,h){const g=`${o}${a}?${h}`;return l.config.emulator?_t(l.config,g):`${l.config.apiScheme}://${g}`}function Ge(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ot{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,h)=>{this.timer=setTimeout(()=>h(Qe(this.auth,"network-request-failed")),Dt.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function xe(l,o,a){const h={appName:l.name};a.email&&(h.email=a.email),a.phoneNumber&&(h.phoneNumber=a.phoneNumber);const g=Qe(l,o,h);return g.customData._tokenResponse=a,g}function Y(l){return void 0!==l&&void 0!==l.getResponse}function ne(l){return void 0!==l&&void 0!==l.enterprise}class Is{constructor(o){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=o.recaptchaEnforcementState}getProviderEnforcementState(o){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const a of this.recaptchaEnforcementState)if(a.provider&&a.provider===o)return Ge(a.enforcementState);return null}isProviderEnabled(o){return"ENFORCE"===this.getProviderEnforcementState(o)||"AUDIT"===this.getProviderEnforcementState(o)}}function U(){return(U=(0,w.Z)(function*(l){return(yield be(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function j(l,o){return Be.apply(this,arguments)}function Be(){return(Be=(0,w.Z)(function*(l,o){return be(l,"GET","/v2/recaptchaConfig",Se(l,o))})).apply(this,arguments)}function vi(){return(vi=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function _r(){return(_r=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function vs(l,o){return Gr.apply(this,arguments)}function Gr(){return(Gr=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function qn(l){if(l)try{const o=new Date(Number(l));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Ei(){return(Ei=(0,w.Z)(function*(l,o=!1){const a=(0,A.m9)(l),h=yield a.getIdToken(o),g=he(h);H(g&&g.exp&&g.auth_time&&g.iat,a.auth,"internal-error");const I="object"==typeof g.firebase?g.firebase:void 0,b=I?.sign_in_provider;return{claims:g,token:h,authTime:qn(zr(g.auth_time)),issuedAtTime:qn(zr(g.iat)),expirationTime:qn(zr(g.exp)),signInProvider:b||null,signInSecondFactor:I?.sign_in_second_factor||null}})).apply(this,arguments)}function zr(l){return 1e3*Number(l)}function he(l){const[o,a,h]=l.split(".");if(void 0===o||void 0===a||void 0===h)return gr("JWT malformed, contained fewer than 3 sections"),null;try{const g=(0,A.tV)(a);return g?JSON.parse(g):(gr("Failed to decode base64 JWT payload"),null)}catch(g){return gr("Caught error parsing JWT payload as JSON",g?.toString()),null}}function pn(l){const o=he(l);return H(o,"internal-error"),H(typeof o.exp<"u","internal-error"),H(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}function Ke(l,o){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,w.Z)(function*(l,o,a=!1){if(a)return o;try{return yield o}catch(h){throw h instanceof A.ZR&&function ue({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(h)&&l.auth.currentUser===l&&(yield l.auth.signOut()),h}})).apply(this,arguments)}class yr{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const g=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,g)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const h=this.getInterval(o);this.timerId=setTimeout((0,w.Z)(function*(){yield a.iteration()}),h)}iteration(){var o=this;return(0,w.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===a?.code&&o.schedule(!0))}o.schedule()})()}}class fe{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=qn(this.lastLoginAt),this.creationTime=qn(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function un(l){return ke.apply(this,arguments)}function ke(){return(ke=(0,w.Z)(function*(l){var o;const a=l.auth,h=yield l.getIdToken(),g=yield Ke(l,vs(a,{idToken:h}));H(g?.users.length,a,"internal-error");const I=g.users[0];l._notifyReloadListener(I);const b=null!==(o=I.providerUserInfo)&&void 0!==o&&o.length?gn(I.providerUserInfo):[],F=function Ir(l,o){return[...l.filter(h=>!o.some(g=>g.providerId===h.providerId)),...o]}(l.providerData,b),ce=!!l.isAnonymous&&!(l.email&&I.passwordHash||F?.length),ve={uid:I.localId,displayName:I.displayName||null,photoURL:I.photoUrl||null,email:I.email||null,emailVerified:I.emailVerified||!1,phoneNumber:I.phoneNumber||null,tenantId:I.tenantId||null,providerData:F,metadata:new fe(I.createdAt,I.lastLoginAt),isAnonymous:ce};Object.assign(l,ve)})).apply(this,arguments)}function mn(){return(mn=(0,w.Z)(function*(l){const o=(0,A.m9)(l);yield un(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function gn(l){return l.map(o=>{var{providerId:a}=o,h=(0,Tt._T)(o,["providerId"]);return{providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function cn(){return(cn=(0,w.Z)(function*(l,o){const a=yield on(l,{},(0,w.Z)(function*(){const h=(0,A.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:g,apiKey:I}=l.config,b=K(l,g,"/v1/token",`key=${I}`),F=yield l._getAdditionalHeaders();return F["Content-Type"]="application/x-www-form-urlencoded",ft.fetch()(b,{method:"POST",headers:F,body:h})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}function B(){return(B=(0,w.Z)(function*(l,o){return be(l,"POST","/v2/accounts:revokeToken",Se(l,o))})).apply(this,arguments)}class x{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){H(o.idToken,"internal-error"),H(typeof o.idToken<"u","internal-error"),H(typeof o.refreshToken<"u","internal-error");const a="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):pn(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}updateFromIdToken(o){H(0!==o.length,"internal-error");const a=pn(o);this.updateTokensAndExpiration(o,null,a)}getToken(o,a=!1){var h=this;return(0,w.Z)(function*(){return a||!h.accessToken||h.isExpired?(H(h.refreshToken,o,"user-token-expired"),h.refreshToken?(yield h.refresh(o,h.refreshToken),h.accessToken):null):h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var h=this;return(0,w.Z)(function*(){const{accessToken:g,refreshToken:I,expiresIn:b}=yield function Zo(l,o){return cn.apply(this,arguments)}(o,a);h.updateTokensAndExpiration(g,I,Number(b))})()}updateTokensAndExpiration(o,a,h){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(o,a){const{refreshToken:h,accessToken:g,expirationTime:I}=a,b=new x;return h&&(H("string"==typeof h,"internal-error",{appName:o}),b.refreshToken=h),g&&(H("string"==typeof g,"internal-error",{appName:o}),b.accessToken=g),I&&(H("number"==typeof I,"internal-error",{appName:o}),b.expirationTime=I),b}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new x,this.toJSON())}_performRefresh(){return st("not implemented")}}function P(l,o){H("string"==typeof l||typeof l>"u","internal-error",{appName:o})}class z{constructor(o){var{uid:a,auth:h,stsTokenManager:g}=o,I=(0,Tt._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=g,this.accessToken=g.accessToken,this.displayName=I.displayName||null,this.email=I.email||null,this.emailVerified=I.emailVerified||!1,this.phoneNumber=I.phoneNumber||null,this.photoURL=I.photoURL||null,this.isAnonymous=I.isAnonymous||!1,this.tenantId=I.tenantId||null,this.providerData=I.providerData?[...I.providerData]:[],this.metadata=new fe(I.createdAt||void 0,I.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,w.Z)(function*(){const h=yield Ke(a,a.stsTokenManager.getToken(a.auth,o));return H(h,a.auth,"internal-error"),a.accessToken!==h&&(a.accessToken=h,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),h})()}getIdTokenResult(o){return function $o(l){return Ei.apply(this,arguments)}(this,o)}reload(){return function X(l){return mn.apply(this,arguments)}(this)}_assign(o){this!==o&&(H(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const a=new z(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return a.metadata._copy(this.metadata),a}_onReload(o){H(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var h=this;return(0,w.Z)(function*(){let g=!1;o.idToken&&o.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(o),g=!0),a&&(yield un(h)),yield h.auth._persistUserIfCurrent(h),g&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var o=this;return(0,w.Z)(function*(){if((0,ae._isFirebaseServerApp)(o.auth.app))return Promise.reject(Pe(o.auth));const a=yield o.getIdToken();return yield Ke(o,function Ii(l,o){return vi.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var h,g,I,b,F,$,ie,ce;const ve=null!==(h=a.displayName)&&void 0!==h?h:void 0,Ft=null!==(g=a.email)&&void 0!==g?g:void 0,Pn=null!==(I=a.phoneNumber)&&void 0!==I?I:void 0,is=null!==(b=a.photoURL)&&void 0!==b?b:void 0,Wa=null!==(F=a.tenantId)&&void 0!==F?F:void 0,ss=null!==($=a._redirectEventId)&&void 0!==$?$:void 0,os=null!==(ie=a.createdAt)&&void 0!==ie?ie:void 0,oi=null!==(ce=a.lastLoginAt)&&void 0!==ce?ce:void 0,{uid:ai,emailVerified:Ro,isAnonymous:Po,providerData:as,stsTokenManager:Ka}=a;H(ai&&Ka,o,"internal-error");const Ih=x.fromJSON(this.name,Ka);H("string"==typeof ai,o,"internal-error"),P(ve,o.name),P(Ft,o.name),H("boolean"==typeof Ro,o,"internal-error"),H("boolean"==typeof Po,o,"internal-error"),P(Pn,o.name),P(is,o.name),P(Wa,o.name),P(ss,o.name),P(os,o.name),P(oi,o.name);const So=new z({uid:ai,auth:o,email:Ft,emailVerified:Ro,displayName:ve,isAnonymous:Po,photoURL:is,phoneNumber:Pn,tenantId:Wa,stsTokenManager:Ih,createdAt:os,lastLoginAt:oi});return as&&Array.isArray(as)&&(So.providerData=as.map(bo=>Object.assign({},bo))),ss&&(So._redirectEventId=ss),So}static _fromIdTokenResponse(o,a,h=!1){return(0,w.Z)(function*(){const g=new x;g.updateFromServerResponse(a);const I=new z({uid:a.localId,auth:o,stsTokenManager:g,isAnonymous:h});return yield un(I),I})()}static _fromGetAccountInfoResponse(o,a,h){return(0,w.Z)(function*(){const g=a.users[0];H(void 0!==g.localId,"internal-error");const I=void 0!==g.providerUserInfo?gn(g.providerUserInfo):[],b=!(g.email&&g.passwordHash||I?.length),F=new x;F.updateFromIdToken(h);const $=new z({uid:g.localId,auth:o,stsTokenManager:F,isAnonymous:b}),ie={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:I,metadata:new fe(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash||I?.length)};return Object.assign($,ie),$})()}}const te=new Map;function de(l){gt(l instanceof Function,"Expected a class definition");let o=te.get(l);return o?(gt(o instanceof l,"Instance stored in cache mismatched with class"),o):(o=new l,te.set(l,o),o)}const Te=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,w.Z)(function*(){return!0})()}_set(a,h){var g=this;return(0,w.Z)(function*(){g.storage[a]=h})()}_get(a){var h=this;return(0,w.Z)(function*(){const g=h.storage[a];return void 0===g?null:g})()}_remove(a){var h=this;return(0,w.Z)(function*(){delete h.storage[a]})()}_addListener(a,h){}_removeListener(a,h){}}return l.type="NONE",l})();function He(l,o,a){return`firebase:${l}:${o}:${a}`}class V{constructor(o,a,h){this.persistence=o,this.auth=a,this.userKey=h;const{config:g,name:I}=this.auth;this.fullUserKey=He(this.userKey,g.apiKey,I),this.fullPersistenceKey=He("persistence",g.apiKey,I),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,w.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?z._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,w.Z)(function*(){if(a.persistence===o)return;const h=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,h?a.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,h="authUser"){return(0,w.Z)(function*(){if(!a.length)return new V(de(Te),o,h);const g=(yield Promise.all(a.map(function(){var ie=(0,w.Z)(function*(ce){if(yield ce._isAvailable())return ce});return function(ce){return ie.apply(this,arguments)}}()))).filter(ie=>ie);let I=g[0]||de(Te);const b=He(h,o.config.apiKey,o.name);let F=null;for(const ie of a)try{const ce=yield ie._get(b);if(ce){const ve=z._fromJSON(o,ce);ie!==I&&(F=ve),I=ie;break}}catch{}const $=g.filter(ie=>ie._shouldAllowMigration);return I._shouldAllowMigration&&$.length?(I=$[0],F&&(yield I._set(b,F.toJSON())),yield Promise.all(a.map(function(){var ie=(0,w.Z)(function*(ce){if(ce!==I)try{yield ce._remove(b)}catch{}});return function(ce){return ie.apply(this,arguments)}}())),new V(I,o,h)):new V(I,o,h)})()}}function At(l){const o=l.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(jr(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(_e(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(Su(o))return"Blackberry";if(Gn(o))return"Webos";if(Xt(o))return"Safari";if((o.includes("chrome/")||Ai(o))&&!o.includes("edge/"))return"Chrome";if(_n(o))return"Android";{const h=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===h?.length)return h[1]}return"Other"}function _e(l=(0,A.z$)()){return/firefox\//i.test(l)}function Xt(l=(0,A.z$)()){const o=l.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function Ai(l=(0,A.z$)()){return/crios\//i.test(l)}function jr(l=(0,A.z$)()){return/iemobile/i.test(l)}function _n(l=(0,A.z$)()){return/android/i.test(l)}function Su(l=(0,A.z$)()){return/blackberry/i.test(l)}function Gn(l=(0,A.z$)()){return/webos/i.test(l)}function wi(l=(0,A.z$)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function Ho(l=(0,A.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}function Lt(l=(0,A.z$)()){return wi(l)||_n(l)||Gn(l)||Su(l)||/windows phone/i.test(l)||jr(l)}function Wr(l,o=[]){let a;switch(l){case"Browser":a=At((0,A.z$)());break;case"Worker":a=`${At((0,A.z$)())}-${l}`;break;default:a=l}const h=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${ae.SDK_VERSION}/${h}`}class Ri{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const h=I=>new Promise((b,F)=>{try{b(o(I))}catch($){F($)}});h.onAbort=a,this.queue.push(h);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,w.Z)(function*(){if(a.auth.currentUser===o)return;const h=[];try{for(const g of a.queue)yield g(o),g.onAbort&&h.push(g.onAbort)}catch(g){h.reverse();for(const I of h)try{I()}catch{}throw a.auth._errorFactory.create("login-blocked",{originalMessage:g?.message})}})()}}function yt(){return(yt=(0,w.Z)(function*(l,o={}){return be(l,"GET","/v2/passwordPolicy",Se(l,o))})).apply(this,arguments)}class Cu{constructor(o){var a,h,g,I;const b=o.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(a=b.minPasswordLength)&&void 0!==a?a:6,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),void 0!==b.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),void 0!==b.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),void 0!==b.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),void 0!==b.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=o.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(g=null===(h=o.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==g?g:"",this.forceUpgradeOnSignin=null!==(I=o.forceUpgradeOnSignin)&&void 0!==I&&I,this.schemaVersion=o.schemaVersion}validatePassword(o){var a,h,g,I,b,F;const $={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(o,$),this.validatePasswordCharacterOptions(o,$),$.isValid&&($.isValid=null===(a=$.meetsMinPasswordLength)||void 0===a||a),$.isValid&&($.isValid=null===(h=$.meetsMaxPasswordLength)||void 0===h||h),$.isValid&&($.isValid=null===(g=$.containsLowercaseLetter)||void 0===g||g),$.isValid&&($.isValid=null===(I=$.containsUppercaseLetter)||void 0===I||I),$.isValid&&($.isValid=null===(b=$.containsNumericCharacter)||void 0===b||b),$.isValid&&($.isValid=null===(F=$.containsNonAlphanumericCharacter)||void 0===F||F),$}validatePasswordLengthOptions(o,a){const h=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;h&&(a.meetsMinPasswordLength=o.length>=h),g&&(a.meetsMaxPasswordLength=o.length<=g)}validatePasswordCharacterOptions(o,a){let h;this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);for(let g=0;g<o.length;g++)h=o.charAt(g),this.updatePasswordCharacterOptionsStatuses(a,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(o,a,h,g,I){this.customStrengthOptions.containsLowercaseLetter&&(o.containsLowercaseLetter||(o.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(o.containsUppercaseLetter||(o.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(o.containsNumericCharacter||(o.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(o.containsNonAlphanumericCharacter||(o.containsNonAlphanumericCharacter=I))}}class yn{constructor(o,a,h,g){this.app=o,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=h,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Pi(this),this.idTokenSubscription=new Pi(this),this.beforeStateQueue=new Ri(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=g.sdkClientVersion}_initializeWithPersistence(o,a){var h=this;return a&&(this._popupRedirectResolver=de(a)),this._initializationPromise=this.queue((0,w.Z)(function*(){var g,I;if(!h._deleted&&(h.persistenceManager=yield V.create(h,o),!h._deleted)){if(null!==(g=h._popupRedirectResolver)&&void 0!==g&&g._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(a),h.lastNotifiedUid=(null===(I=h.currentUser)||void 0===I?void 0:I.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,w.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUserFromIdToken(o){var a=this;return(0,w.Z)(function*(){try{const h=yield vs(a,{idToken:o}),g=yield z._fromGetAccountInfoResponse(a,h,o);yield a.directlySetCurrentUser(g)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),yield a.directlySetCurrentUser(null)}})()}initializeCurrentUser(o){var a=this;return(0,w.Z)(function*(){var h;if((0,ae._isFirebaseServerApp)(a.app)){const F=a.app.settings.authIdToken;return F?new Promise($=>{setTimeout(()=>a.initializeCurrentUserFromIdToken(F).then($,$))}):a.directlySetCurrentUser(null)}const g=yield a.assertedPersistence.getCurrentUser();let I=g,b=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const F=null===(h=a.redirectUser)||void 0===h?void 0:h._redirectEventId,$=I?._redirectEventId,ie=yield a.tryRedirectSignIn(o);(!F||F===$)&&ie?.user&&(I=ie.user,b=!0)}if(!I)return a.directlySetCurrentUser(null);if(!I._redirectEventId){if(b)try{yield a.beforeStateQueue.runMiddleware(I)}catch(F){I=g,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(F))}return I?a.reloadAndSetCurrentUserOrClear(I):a.directlySetCurrentUser(null)}return H(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===I._redirectEventId?a.directlySetCurrentUser(I):a.reloadAndSetCurrentUserOrClear(I)})()}tryRedirectSignIn(o){var a=this;return(0,w.Z)(function*(){let h=null;try{h=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch{yield a._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,w.Z)(function*(){try{yield un(o)}catch(h){if("auth/network-request-failed"!==h?.code)return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Et(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var o=this;return(0,w.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,w.Z)(function*(){if((0,ae._isFirebaseServerApp)(a.app))return Promise.reject(Pe(a));const h=o?(0,A.m9)(o):null;return h&&H(h.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(h&&h._clone(a))})()}_updateCurrentUser(o,a=!1){var h=this;return(0,w.Z)(function*(){if(!h._deleted)return o&&H(h.tenantId===o.tenantId,h,"tenant-id-mismatch"),a||(yield h.beforeStateQueue.runMiddleware(o)),h.queue((0,w.Z)(function*(){yield h.directlySetCurrentUser(o),h.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,w.Z)(function*(){return(0,ae._isFirebaseServerApp)(o.app)?Promise.reject(Pe(o)):(yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0))})()}setPersistence(o){var a=this;return(0,ae._isFirebaseServerApp)(this.app)?Promise.reject(Pe(this)):this.queue((0,w.Z)(function*(){yield a.assertedPersistence.setPersistence(de(o))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(o){var a=this;return(0,w.Z)(function*(){a._getPasswordPolicyInternal()||(yield a._updatePasswordPolicy());const h=a._getPasswordPolicyInternal();return h.schemaVersion!==a.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(a._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(o)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var o=this;return(0,w.Z)(function*(){const a=yield function bu(l){return yt.apply(this,arguments)}(o),h=new Cu(a);null===o.tenantId?o._projectPasswordPolicy=h:o._tenantPasswordPolicies[o.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new A.LL("auth","Firebase",o())}onAuthStateChanged(o,a,h){return this.registerStateListener(this.authStateSubscription,o,a,h)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,h){return this.registerStateListener(this.idTokenSubscription,o,a,h)}authStateReady(){return new Promise((o,a)=>{if(this.currentUser)o();else{const h=this.onAuthStateChanged(()=>{h(),o()},a)}})}revokeAccessToken(o){var a=this;return(0,w.Z)(function*(){if(a.currentUser){const h=yield a.currentUser.getIdToken(),g={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:o,idToken:h};null!=a.tenantId&&(g.tenantId=a.tenantId),yield function Qo(l,o){return B.apply(this,arguments)}(a,g)}})()}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var h=this;return(0,w.Z)(function*(){const g=yield h.getOrInitRedirectPersistenceManager(a);return null===o?g.removeCurrentUser():g.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,w.Z)(function*(){if(!a.redirectPersistenceManager){const h=o&&de(o)||a._popupRedirectResolver;H(h,a,"argument-error"),a.redirectPersistenceManager=yield V.create(a,[de(h._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,w.Z)(function*(){var h,g;return a._isInitialized&&(yield a.queue((0,w.Z)(function*(){}))),(null===(h=a._currentUser)||void 0===h?void 0:h._redirectEventId)===o?a._currentUser:(null===(g=a.redirectUser)||void 0===g?void 0:g._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,w.Z)(function*(){if(o===a.currentUser)return a.queue((0,w.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,h,g){if(this._deleted)return()=>{};const I="function"==typeof a?a:a.next.bind(a);let b=!1;const F=this._isInitialized?Promise.resolve():this._initializationPromise;if(H(F,this,"internal-error"),F.then(()=>{b||I(this.currentUser)}),"function"==typeof a){const $=o.addObserver(a,h,g);return()=>{b=!0,$()}}{const $=o.addObserver(a);return()=>{b=!0,$()}}}directlySetCurrentUser(o){var a=this;return(0,w.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return H(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Wr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,w.Z)(function*(){var a;const h={"X-Client-Version":o.clientVersion};o.app.options.appId&&(h["X-Firebase-gmpid"]=o.app.options.appId);const g=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();g&&(h["X-Firebase-Client"]=g);const I=yield o._getAppCheckToken();return I&&(h["X-Firebase-AppCheck"]=I),h})()}_getAppCheckToken(){var o=this;return(0,w.Z)(function*(){var a;const h=yield null===(a=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getToken();return h?.error&&function qr(l,...o){nn.logLevel<=ye.in.WARN&&nn.warn(`Auth (${ae.SDK_VERSION}): ${l}`,...o)}(`Error while retrieving App Check token: ${h.error}`),h?.token})()}}function Je(l){return(0,A.m9)(l)}class Pi{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,A.ne)(a=>this.observer=a)}get next(){return H(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Kr={loadJS:()=>(0,w.Z)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Jo(l){return Kr.loadJS(l)}function xu(l){return`__${l}${Math.floor(1e6*Math.random())}`}class Vu{constructor(o){this.type="recaptcha-enterprise",this.auth=Je(o)}verify(o="verify",a=!1){var h=this;return(0,w.Z)(function*(){function I(){return I=(0,w.Z)(function*(F){if(!a){if(null==F.tenantId&&null!=F._agentRecaptchaConfig)return F._agentRecaptchaConfig.siteKey;if(null!=F.tenantId&&void 0!==F._tenantRecaptchaConfigs[F.tenantId])return F._tenantRecaptchaConfigs[F.tenantId].siteKey}return new Promise(function(){var $=(0,w.Z)(function*(ie,ce){j(F,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ve=>{if(void 0!==ve.recaptchaKey){const Ft=new Is(ve);return null==F.tenantId?F._agentRecaptchaConfig=Ft:F._tenantRecaptchaConfigs[F.tenantId]=Ft,ie(Ft.siteKey)}ce(new Error("recaptcha Enterprise site key undefined"))}).catch(ve=>{ce(ve)})});return function(ie,ce){return $.apply(this,arguments)}}())}),I.apply(this,arguments)}function b(F,$,ie){const ce=window.grecaptcha;ne(ce)?ce.enterprise.ready(()=>{ce.enterprise.execute(F,{action:o}).then(ve=>{$(ve)}).catch(()=>{$("NO_RECAPTCHA")})}):ie(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((F,$)=>{(function g(F){return I.apply(this,arguments)})(h.auth).then(ie=>{if(!a&&ne(window.grecaptcha))b(ie,F,$);else{if(typeof window>"u")return void $(new Error("RecaptchaVerifier is only supported in browser"));let ce=function bl(){return Kr.recaptchaEnterpriseScript}();0!==ce.length&&(ce+=ie),Jo(ce).then(()=>{b(ie,F,$)}).catch(ve=>{$(ve)})}}).catch(ie=>{$(ie)})})})()}}function ku(l,o,a){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,w.Z)(function*(l,o,a,h=!1){const g=new Vu(l);let I;try{I=yield g.verify(a)}catch{I=yield g.verify(a,!0)}const b=Object.assign({},o);return Object.assign(b,h?{captchaResp:I}:{captchaResponse:I}),Object.assign(b,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(b,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),b})).apply(this,arguments)}function Si(l,o,a,h){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,w.Z)(function*(l,o,a,h){var g;if(null!==(g=l._getRecaptchaConfig())&&void 0!==g&&g.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const I=yield ku(l,o,a,"getOobCode"===a);return h(l,I)}return h(l,o).catch(function(){var I=(0,w.Z)(function*(b){if("auth/missing-recaptcha-token"===b.code){console.log(`${a} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const F=yield ku(l,o,a,"getOobCode"===a);return h(l,F)}return Promise.reject(b)});return function(b){return I.apply(this,arguments)}}())}),Xo.apply(this,arguments)}function ta(l,o,a){const h=Je(l);H(h._canInitEmulator,h,"emulator-config-failed"),H(/^https?:\/\//.test(o),h,"invalid-emulator-scheme");const g=!!a?.disableWarnings,I=na(o),{host:b,port:F}=function ra(l){const o=na(l),a=/(\/\/)?([^?#/]+)/.exec(l.substr(o.length));if(!a)return{host:"",port:null};const h=a[2].split("@").pop()||"",g=/^(\[[^\]]+\])(:|$)/.exec(h);if(g){const I=g[1];return{host:I,port:Du(h.substr(I.length+1))}}{const[I,b]=h.split(":");return{host:I,port:Du(b)}}}(o);h.config.emulator={url:`${I}//${b}${null===F?"":`:${F}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:b,port:F,protocol:I.replace(":",""),options:Object.freeze({disableWarnings:g})}),g||function Dl(){function l(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}function na(l){const o=l.indexOf(":");return o<0?"":l.substr(0,o+1)}function Du(l){if(!l)return null;const o=Number(l);return isNaN(o)?null:o}class zn{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return st("not implemented")}_getIdTokenResponse(o){return st("not implemented")}_linkToIdToken(o,a){return st("not implemented")}_getReauthenticationResolver(o){return st("not implemented")}}function ht(l,o){return Ts.apply(this,arguments)}function Ts(){return(Ts=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:resetPassword",Se(l,o))})).apply(this,arguments)}function Es(){return(Es=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Ou(l,o){return Me.apply(this,arguments)}function Me(){return(Me=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:signUp",o)})).apply(this,arguments)}function mt(){return(mt=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:update",Se(l,o))})).apply(this,arguments)}function Fe(l,o){return ws.apply(this,arguments)}function ws(){return(ws=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithPassword",Se(l,o))})).apply(this,arguments)}function xn(l,o){return wt.apply(this,arguments)}function wt(){return(wt=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:sendOobCode",Se(l,o))})).apply(this,arguments)}function ia(){return(ia=(0,w.Z)(function*(l,o){return xn(l,o)})).apply(this,arguments)}function nt(l,o){return sa.apply(this,arguments)}function sa(){return(sa=(0,w.Z)(function*(l,o){return xn(l,o)})).apply(this,arguments)}function Vn(l,o){return ze.apply(this,arguments)}function ze(){return(ze=(0,w.Z)(function*(l,o){return xn(l,o)})).apply(this,arguments)}function $r(){return($r=(0,w.Z)(function*(l,o){return xn(l,o)})).apply(this,arguments)}function vr(){return(vr=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithEmailLink",Se(l,o))})).apply(this,arguments)}function In(){return(In=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithEmailLink",Se(l,o))})).apply(this,arguments)}class en extends zn{constructor(o,a,h,g=null){super("password",h),this._email=o,this._password=a,this._tenantId=g}static _fromEmailAndPassword(o,a){return new en(o,a,"password")}static _fromEmailAndCode(o,a,h=null){return new en(o,a,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if(a?.email&&a?.password){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,w.Z)(function*(){switch(a.signInMethod){case"password":return Si(o,{returnSecureToken:!0,email:a._email,password:a._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Fe);case"emailLink":return function Rs(l,o){return vr.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:q(o,"internal-error")}})()}_linkToIdToken(o,a){var h=this;return(0,w.Z)(function*(){switch(h.signInMethod){case"password":return Si(o,{idToken:a,returnSecureToken:!0,email:h._email,password:h._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ou);case"emailLink":return function Ol(l,o){return In.apply(this,arguments)}(o,{idToken:a,email:h._email,oobCode:h._password});default:q(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function tn(l,o){return vn.apply(this,arguments)}function vn(){return(vn=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithIdp",Se(l,o))})).apply(this,arguments)}class Mt extends zn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new Mt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):q("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:g}=a,I=(0,Tt._T)(a,["providerId","signInMethod"]);if(!h||!g)return null;const b=new Mt(h,g);return b.idToken=I.idToken||void 0,b.accessToken=I.accessToken||void 0,b.secret=I.secret,b.nonce=I.nonce,b.pendingToken=I.pendingToken||null,b}_getIdTokenResponse(o){return tn(o,this.buildRequest())}_linkToIdToken(o,a){const h=this.buildRequest();return h.idToken=a,tn(o,h)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,tn(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,A.xO)(a)}return o}}function Ps(){return(Ps=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:sendVerificationCode",Se(l,o))})).apply(this,arguments)}function Kn(){return(Kn=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithPhoneNumber",Se(l,o))})).apply(this,arguments)}function Zr(){return(Zr=(0,w.Z)(function*(l,o){const a=yield pt(l,"POST","/v1/accounts:signInWithPhoneNumber",Se(l,o));if(a.temporaryProof)throw xe(l,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Tr={USER_NOT_FOUND:"user-not-found"};function Er(){return(Er=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithPhoneNumber",Se(l,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Tr)})).apply(this,arguments)}class $n extends zn{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new $n({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new $n({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function Mu(l,o){return Kn.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function oa(l,o){return Zr.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function aa(l,o){return Er.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:h,verificationCode:g}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:h,code:g}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:h,phoneNumber:g,temporaryProof:I}=o;return h||a||g||I?new $n({verificationId:a,verificationCode:h,phoneNumber:g,temporaryProof:I}):null}}class Zn{constructor(o){var a,h,g,I,b,F;const $=(0,A.zd)((0,A.pd)(o)),ie=null!==(a=$.apiKey)&&void 0!==a?a:null,ce=null!==(h=$.oobCode)&&void 0!==h?h:null,ve=function Fu(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(g=$.mode)&&void 0!==g?g:null);H(ie&&ce&&ve,"argument-error"),this.apiKey=ie,this.operation=ve,this.code=ce,this.continueUrl=null!==(I=$.continueUrl)&&void 0!==I?I:null,this.languageCode=null!==(b=$.languageCode)&&void 0!==b?b:null,this.tenantId=null!==(F=$.tenantId)&&void 0!==F?F:null}static parseLink(o){const a=function Ss(l){const o=(0,A.zd)((0,A.pd)(l)).link,a=o?(0,A.zd)((0,A.pd)(o)).deep_link_id:null,h=(0,A.zd)((0,A.pd)(l)).deep_link_id;return(h?(0,A.zd)((0,A.pd)(h)).link:null)||h||a||o||l}(o);try{return new Zn(a)}catch{return null}}}let Cs=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(a,h){return en._fromEmailAndPassword(a,h)}static credentialWithLink(a,h){const g=Zn.parseLink(h);return H(g,"argument-error"),en._fromEmailAndCode(a,g.code,g.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class En{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Qr extends En{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class bi extends Qr{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return H("providerId"in a&&"signInMethod"in a,"argument-error"),Mt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return H(o.idToken||o.accessToken,"argument-error"),Mt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return bi.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return bi.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:h,oauthTokenSecret:g,pendingToken:I,nonce:b,providerId:F}=o;if(!h&&!g&&!a&&!I||!F)return null;try{return new bi(F)._credential({idToken:a,accessToken:h,nonce:b,pendingToken:I})}catch{return null}}}let Uu=(()=>{class l extends Qr{constructor(){super("facebook.com")}static credential(a){return Mt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),Bu=(()=>{class l extends Qr{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Mt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:g}=a;if(!h&&!g)return null;try{return l.credential(h,g)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),vt=(()=>{class l extends Qr{constructor(){super("github.com")}static credential(a){return Mt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class Ne extends zn{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return tn(o,this.buildRequest())}_linkToIdToken(o,a){const h=this.buildRequest();return h.idToken=a,tn(o,h)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,tn(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:g,pendingToken:I}=a;return h&&g&&I&&h===g?new Ne(h,I):null}static _create(o,a){return new Ne(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ci extends En{constructor(o){H(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Ci.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Ci.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=Ne.fromJSON(o);return H(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:h}=o;if(!a||!h)return null;try{return Ne._create(h,a)}catch{return null}}}let Gu=(()=>{class l extends Qr{constructor(){super("twitter.com")}static credential(a,h){return Mt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:h,oauthTokenSecret:g}=a;if(!h||!g)return null;try{return l.credential(h,g)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function Hr(l,o){return ua.apply(this,arguments)}function ua(){return(ua=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signUp",Se(l,o))})).apply(this,arguments)}class $t{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,h,g=!1){return(0,w.Z)(function*(){const I=yield z._fromIdTokenResponse(o,h,g),b=Ee(h);return new $t({user:I,providerId:b,_tokenResponse:h,operationType:a})})()}static _forOperation(o,a,h){return(0,w.Z)(function*(){yield o._updateTokensIfNecessary(h,!0);const g=Ee(h);return new $t({user:o,providerId:g,_tokenResponse:h,operationType:a})})()}}function Ee(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function Oe(l){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,w.Z)(function*(l){var o;if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const a=Je(l);if(yield a._initializationPromise,null!==(o=a.currentUser)&&void 0!==o&&o.isAnonymous)return new $t({user:a.currentUser,providerId:null,operationType:"signIn"});const h=yield Hr(a,{returnSecureToken:!0}),g=yield $t._fromIdTokenResponse(a,"signIn",h,!0);return yield a._updateCurrentUser(g.user),g})).apply(this,arguments)}class Jr extends A.ZR{constructor(o,a,h,g){var I;super(a.code,a.message),this.operationType=h,this.user=g,Object.setPrototypeOf(this,Jr.prototype),this.customData={appName:o.name,tenantId:null!==(I=o.tenantId)&&void 0!==I?I:void 0,_serverResponse:a.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(o,a,h,g){return new Jr(o,a,h,g)}}function xs(l,o,a,h){return("reauthenticate"===o?a._getReauthenticationResolver(l):a._getIdTokenResponse(l)).catch(I=>{throw"auth/multi-factor-auth-required"===I.code?Jr._fromErrorAndOperation(l,I,o,h):I})}function ca(l){return new Set(l.map(({providerId:o})=>o).filter(o=>!!o))}function la(l,o){return Vs.apply(this,arguments)}function Vs(){return Vs=(0,w.Z)(function*(l,o){const a=(0,A.m9)(l);yield Ds(!0,a,o);const{providerUserInfo:h}=yield function Ti(l,o){return _r.apply(this,arguments)}(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),g=ca(h||[]);return a.providerData=a.providerData.filter(I=>g.has(I.providerId)),g.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a}),Vs.apply(this,arguments)}function ks(l,o){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,w.Z)(function*(l,o,a=!1){const h=yield Ke(l,o._linkToIdToken(l.auth,yield l.getIdToken()),a);return $t._forOperation(l,"link",h)})).apply(this,arguments)}function Ds(l,o,a){return ha.apply(this,arguments)}function ha(){return(ha=(0,w.Z)(function*(l,o,a){yield un(o);const g=!1===l?"provider-already-linked":"no-such-provider";H(ca(o.providerData).has(a)===l,o.auth,g)})).apply(this,arguments)}function zu(l,o){return Os.apply(this,arguments)}function Os(){return(Os=(0,w.Z)(function*(l,o,a=!1){const{auth:h}=l;if((0,ae._isFirebaseServerApp)(h.app))return Promise.reject(Pe(h));const g="reauthenticate";try{const I=yield Ke(l,xs(h,g,o,l),a);H(I.idToken,h,"internal-error");const b=he(I.idToken);H(b,h,"internal-error");const{sub:F}=b;return H(l.uid===F,h,"user-mismatch"),$t._forOperation(l,g,I)}catch(I){throw"auth/user-not-found"===I?.code&&q(h,"user-mismatch"),I}})).apply(this,arguments)}function ju(l,o){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,w.Z)(function*(l,o,a=!1){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h="signIn",g=yield xs(l,h,o),I=yield $t._fromIdTokenResponse(l,h,g);return a||(yield l._updateCurrentUser(I.user)),I})).apply(this,arguments)}function Ms(l,o){return da.apply(this,arguments)}function da(){return(da=(0,w.Z)(function*(l,o){return ju(Je(l),o)})).apply(this,arguments)}function Wu(l,o){return xi.apply(this,arguments)}function xi(){return(xi=(0,w.Z)(function*(l,o){const a=(0,A.m9)(l);return yield Ds(!1,a,o.providerId),ks(a,o)})).apply(this,arguments)}function Jn(l,o){return Ar.apply(this,arguments)}function Ar(){return(Ar=(0,w.Z)(function*(l,o){return zu((0,A.m9)(l),o)})).apply(this,arguments)}function Yr(){return(Yr=(0,w.Z)(function*(l,o){return pt(l,"POST","/v1/accounts:signInWithCustomToken",Se(l,o))})).apply(this,arguments)}function Ku(l,o){return Us.apply(this,arguments)}function Us(){return Us=(0,w.Z)(function*(l,o){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const a=Je(l),h=yield function Fs(l,o){return Yr.apply(this,arguments)}(a,{token:o,returnSecureToken:!0}),g=yield $t._fromIdTokenResponse(a,"signIn",h);return yield a._updateCurrentUser(g.user),g}),Us.apply(this,arguments)}class Zt{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?Bs._fromServerResponse(o,a):"totpInfo"in a?Yn._fromServerResponse(o,a):q(o,"internal-error")}}class Bs extends Zt{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new Bs(a)}}class Yn extends Zt{constructor(o){super("totp",o)}static _fromServerResponse(o,a){return new Yn(a)}}function Vi(l,o,a){var h;H((null===(h=a.url)||void 0===h?void 0:h.length)>0,l,"invalid-continue-uri"),H(typeof a.dynamicLinkDomain>"u"||a.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(H(a.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(H(a.android.packageName.length>0,l,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function ki(l){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,w.Z)(function*(l){const o=Je(l);o._getPasswordPolicyInternal()&&(yield o._updatePasswordPolicy())})).apply(this,arguments)}function Rt(l,o,a){return qs.apply(this,arguments)}function qs(){return(qs=(0,w.Z)(function*(l,o,a){const h=Je(l),g={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};a&&Vi(h,g,a),yield Si(h,g,"getOobCode",nt)})).apply(this,arguments)}function $u(l,o,a){return Ni.apply(this,arguments)}function Ni(){return Ni=(0,w.Z)(function*(l,o,a){yield ht((0,A.m9)(l),{oobCode:o,newPassword:a}).catch(function(){var h=(0,w.Z)(function*(g){throw"auth/password-does-not-meet-requirements"===g.code&&ki(l),g});return function(g){return h.apply(this,arguments)}}())}),Ni.apply(this,arguments)}function Gs(l,o){return wr.apply(this,arguments)}function wr(){return wr=(0,w.Z)(function*(l,o){yield function As(l,o){return mt.apply(this,arguments)}((0,A.m9)(l),{oobCode:o})}),wr.apply(this,arguments)}function fa(l,o){return er.apply(this,arguments)}function er(){return(er=(0,w.Z)(function*(l,o){const a=(0,A.m9)(l),h=yield ht(a,{oobCode:o}),g=h.requestType;switch(H(g,a,"internal-error"),g){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":H(h.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":H(h.mfaInfo,a,"internal-error");default:H(h.email,a,"internal-error")}let I=null;return h.mfaInfo&&(I=Zt._fromServerResponse(Je(a),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:I},operation:g}})).apply(this,arguments)}function Di(l,o){return zs.apply(this,arguments)}function zs(){return(zs=(0,w.Z)(function*(l,o){const{data:a}=yield fa((0,A.m9)(l),o);return a.email})).apply(this,arguments)}function Zu(l,o,a){return pa.apply(this,arguments)}function pa(){return(pa=(0,w.Z)(function*(l,o,a){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h=Je(l),b=yield Si(h,{returnSecureToken:!0,email:o,password:a,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hr).catch($=>{throw"auth/password-does-not-meet-requirements"===$.code&&ki(l),$}),F=yield $t._fromIdTokenResponse(h,"signIn",b);return yield h._updateCurrentUser(F.user),F})).apply(this,arguments)}function Nn(l,o,a){return(0,ae._isFirebaseServerApp)(l.app)?Promise.reject(Pe(l)):Ms((0,A.m9)(l),Cs.credential(o,a)).catch(function(){var h=(0,w.Z)(function*(g){throw"auth/password-does-not-meet-requirements"===g.code&&ki(l),g});return function(g){return h.apply(this,arguments)}}())}function Ll(l,o,a){return Pt.apply(this,arguments)}function Pt(){return(Pt=(0,w.Z)(function*(l,o,a){const h=Je(l),g={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};(function I(b,F){H(F.handleCodeInApp,h,"argument-error"),F&&Vi(h,b,F)})(g,a),yield Si(h,g,"getOobCode",Vn)})).apply(this,arguments)}function Qu(l,o){const a=Zn.parseLink(o);return"EMAIL_SIGNIN"===a?.operation}function Oi(l,o,a){return js.apply(this,arguments)}function js(){return(js=(0,w.Z)(function*(l,o,a){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h=(0,A.m9)(l),g=Cs.credentialWithLink(o,a||Wt());return H(g._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),Ms(h,g)})).apply(this,arguments)}function Ws(){return(Ws=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:createAuthUri",Se(l,o))})).apply(this,arguments)}function Li(l,o){return ma.apply(this,arguments)}function ma(){return ma=(0,w.Z)(function*(l,o){const h={identifier:o,continueUri:Ue()?Wt():"http://localhost"},{signinMethods:g}=yield function An(l,o){return Ws.apply(this,arguments)}((0,A.m9)(l),h);return g||[]}),ma.apply(this,arguments)}function Ml(l,o){return me.apply(this,arguments)}function me(){return me=(0,w.Z)(function*(l,o){const a=(0,A.m9)(l),g={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};o&&Vi(a.auth,g,o);const{email:I}=yield function Lu(l,o){return ia.apply(this,arguments)}(a.auth,g);I!==l.email&&(yield l.reload())}),me.apply(this,arguments)}function Fl(l,o,a){return Mi.apply(this,arguments)}function Mi(){return Mi=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l),I={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:o};a&&Vi(h.auth,I,a);const{email:b}=yield function kn(l,o){return $r.apply(this,arguments)}(h.auth,I);b!==l.email&&(yield l.reload())}),Mi.apply(this,arguments)}function Ks(){return(Ks=(0,w.Z)(function*(l,o){return be(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Hu(l,o){return Xr.apply(this,arguments)}function Xr(){return Xr=(0,w.Z)(function*(l,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const h=(0,A.m9)(l),I={idToken:yield h.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},b=yield Ke(h,function ga(l,o){return Ks.apply(this,arguments)}(h.auth,I));h.displayName=b.displayName||null,h.photoURL=b.photoUrl||null;const F=h.providerData.find(({providerId:$})=>"password"===$);F&&(F.displayName=h.displayName,F.photoURL=h.photoURL),yield h._updateTokensIfNecessary(b)}),Xr.apply(this,arguments)}function Ul(l,o){const a=(0,A.m9)(l);return(0,ae._isFirebaseServerApp)(a.auth.app)?Promise.reject(Pe(a.auth)):_a(a,o,null)}function Bl(l,o){return _a((0,A.m9)(l),null,o)}function _a(l,o,a){return tr.apply(this,arguments)}function tr(){return tr=(0,w.Z)(function*(l,o,a){const{auth:h}=l,I={idToken:yield l.getIdToken(),returnSecureToken:!0};o&&(I.email=o),a&&(I.password=a);const b=yield Ke(l,function jn(l,o){return Es.apply(this,arguments)}(h,I));yield l._updateTokensIfNecessary(b,!0)}),tr.apply(this,arguments)}class Pr{constructor(o,a,h={}){this.isNewUser=o,this.providerId=a,this.profile=h}}class nr extends Pr{constructor(o,a,h,g){super(o,a,h),this.username=g}}class Ju extends Pr{constructor(o,a){super(o,"facebook.com",a)}}class ei extends nr{constructor(o,a){super(o,"github.com",a,"string"==typeof a?.login?a?.login:null)}}class Yu extends Pr{constructor(o,a){super(o,"google.com",a)}}class Xu extends nr{constructor(o,a,h){super(o,"twitter.com",a,h)}}function Fi(l){const{user:o,_tokenResponse:a}=l;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function Rr(l){var o,a;if(!l)return null;const{providerId:h}=l,g=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},I=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!h&&l?.idToken){const b=null===(a=null===(o=he(l.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(b)return new Pr(I,"anonymous"!==b&&"custom"!==b?b:null)}if(!h)return null;switch(h){case"facebook.com":return new Ju(I,g);case"github.com":return new ei(I,g);case"google.com":return new Yu(I,g);case"twitter.com":return new Xu(I,g,l.screenName||null);case"custom":case"anonymous":return new Pr(I,null);default:return new Pr(I,h,g)}}(a)}class ir{constructor(o,a,h){this.type=o,this.credential=a,this.user=h}static _fromIdtoken(o,a){return new ir("enroll",o,a)}static _fromMfaPendingCredential(o){return new ir("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,h;if(o?.multiFactorSession){if(null!==(a=o.multiFactorSession)&&void 0!==a&&a.pendingCredential)return ir._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(h=o.multiFactorSession)&&void 0!==h&&h.idToken)return ir._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Hs{constructor(o,a,h){this.session=o,this.hints=a,this.signInResolver=h}static _fromError(o,a){const h=Je(o),g=a.customData._serverResponse,I=(g.mfaInfo||[]).map(F=>Zt._fromServerResponse(h,F));H(g.mfaPendingCredential,h,"internal-error");const b=ir._fromMfaPendingCredential(g.mfaPendingCredential);return new Hs(b,I,function(){var F=(0,w.Z)(function*($){const ie=yield $._process(h,b);delete g.mfaInfo,delete g.mfaPendingCredential;const ce=Object.assign(Object.assign({},g),{idToken:ie.idToken,refreshToken:ie.refreshToken});switch(a.operationType){case"signIn":const ve=yield $t._fromIdTokenResponse(h,a.operationType,ce);return yield h._updateCurrentUser(ve.user),ve;case"reauthenticate":return H(a.user,h,"internal-error"),$t._forOperation(a.user,a.operationType,ce);default:q(h,"internal-error")}});return function($){return F.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,w.Z)(function*(){return a.signInResolver(o)})()}}function ni(l,o){var a;const h=(0,A.m9)(l),g=o;return H(o.customData.operationType,h,"argument-error"),H(null===(a=g.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,h,"argument-error"),Hs._fromError(h,g)}class Ta{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(h=>Zt._fromServerResponse(o.auth,h)))})}static _fromUser(o){return new Ta(o)}getSession(){var o=this;return(0,w.Z)(function*(){return ir._fromIdtoken(yield o.user.getIdToken(),o.user)})()}enroll(o,a){var h=this;return(0,w.Z)(function*(){const g=o,I=yield h.getSession(),b=yield Ke(h.user,g._process(h.user.auth,I,a));return yield h.user._updateTokensIfNecessary(b),h.user.reload()})()}unenroll(o){var a=this;return(0,w.Z)(function*(){const h="string"==typeof o?o:o.uid,g=yield a.user.getIdToken();try{const I=yield Ke(a.user,function nc(l,o){return be(l,"POST","/v2/accounts/mfaEnrollment:withdraw",Se(l,o))}(a.user.auth,{idToken:g,mfaEnrollmentId:h}));a.enrolledFactors=a.enrolledFactors.filter(({uid:b})=>b!==h),yield a.user._updateTokensIfNecessary(I),yield a.user.reload()}catch(I){throw I}})()}}const rt=new WeakMap;function Re(l){const o=(0,A.m9)(l);return rt.has(o)||rt.set(o,Ta._fromUser(o)),rt.get(o)}const Bi="__sak";class Ea{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Bi,"1"),this.storage.removeItem(Bi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Aa=(()=>{class l extends Ea{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Lt(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const g=this.storage.getItem(h),I=this.localCache[h];g!==I&&a(h,I,g)}}onStorageEvent(a,h=!1){if(!a.key)return void this.forAllChangedKeys((F,$,ie)=>{this.notifyListeners(F,ie)});const g=a.key;h?this.detachListener():this.stopPolling();const I=()=>{const F=this.storage.getItem(g);!h&&this.localCache[g]===F||this.notifyListeners(g,F)},b=this.storage.getItem(g);!function wl(){return(0,A.w1)()&&10===document.documentMode}()||b===a.newValue||a.newValue===a.oldValue?I():setTimeout(I,10)}notifyListeners(a,h){this.localCache[a]=h;const g=this.listeners[a];if(g)for(const I of Array.from(g))I(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,g)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:g}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,h){var g=()=>super._set,I=this;return(0,w.Z)(function*(){yield g().call(I,a,h),I.localCache[a]=JSON.stringify(h)})()}_get(a){var h=()=>super._get,g=this;return(0,w.Z)(function*(){const I=yield h().call(g,a);return g.localCache[a]=JSON.stringify(I),I})()}_remove(a){var h=()=>super._remove,g=this;return(0,w.Z)(function*(){yield h().call(g,a),delete g.localCache[a]})()}}return l.type="LOCAL",l})(),qi=(()=>{class l extends Ea{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}return l.type="SESSION",l})();let zi=(()=>{class l{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(I=>I.isListeningto(a));if(h)return h;const g=new l(a);return this.receivers.push(g),g}isListeningto(a){return this.eventTarget===a}handleEvent(a){var h=this;return(0,w.Z)(function*(){const g=a,{eventId:I,eventType:b,data:F}=g.data,$=h.handlersMap[b];if(!$?.size)return;g.ports[0].postMessage({status:"ack",eventId:I,eventType:b});const ie=Array.from($).map(function(){var ve=(0,w.Z)(function*(Ft){return Ft(g.origin,F)});return function(Ft){return ve.apply(this,arguments)}}()),ce=yield function Gi(l){return Promise.all(l.map(function(){var o=(0,w.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(h){return{fulfilled:!1,reason:h}}});return function(a){return o.apply(this,arguments)}}()))}(ie);g.ports[0].postMessage({status:"done",eventId:I,eventType:b,response:ce})})()}_subscribe(a,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function Dn(l="",o=10){let a="";for(let h=0;h<o;h++)a+=Math.floor(10*Math.random());return l+a}class Ys{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,h=50){var g=this;return(0,w.Z)(function*(){const I=typeof MessageChannel<"u"?new MessageChannel:null;if(!I)throw new Error("connection_unavailable");let b,F;return new Promise(($,ie)=>{const ce=Dn("",20);I.port1.start();const ve=setTimeout(()=>{ie(new Error("unsupported_event"))},h);F={messageChannel:I,onMessage(Ft){const Pn=Ft;if(Pn.data.eventId===ce)switch(Pn.data.status){case"ack":clearTimeout(ve),b=setTimeout(()=>{ie(new Error("timeout"))},3e3);break;case"done":clearTimeout(b),$(Pn.data.response);break;default:clearTimeout(ve),clearTimeout(b),ie(new Error("invalid_response"))}}},g.handlers.add(F),I.port1.addEventListener("message",F.onMessage),g.target.postMessage({eventType:o,eventId:ce,data:a},[I.port2])}).finally(()=>{F&&g.removeMessageHandler(F)})})()}}function at(){return window}function Xs(){return typeof at().WorkerGlobalScope<"u"&&"function"==typeof at().importScripts}function eo(){return(eo=(0,w.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const oc="firebaseLocalStorageDb",to="firebaseLocalStorage",no="fbase_key";class wn{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function ji(l,o){return l.transaction([to],o?"readwrite":"readonly").objectStore(to)}function Xe(){const l=indexedDB.open(oc,1);return new Promise((o,a)=>{l.addEventListener("error",()=>{a(l.error)}),l.addEventListener("upgradeneeded",()=>{const h=l.result;try{h.createObjectStore(to,{keyPath:no})}catch(g){a(g)}}),l.addEventListener("success",(0,w.Z)(function*(){const h=l.result;h.objectStoreNames.contains(to)?o(h):(h.close(),yield function Kl(){const l=indexedDB.deleteDatabase(oc);return new wn(l).toPromise()}(),o(yield Xe()))}))})}function ro(l,o,a){return Wi.apply(this,arguments)}function Wi(){return(Wi=(0,w.Z)(function*(l,o,a){const h=ji(l,!0).put({[no]:o,value:a});return new wn(h).toPromise()})).apply(this,arguments)}function Sr(){return(Sr=(0,w.Z)(function*(l,o){const a=ji(l,!1).get(o),h=yield new wn(a).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function ln(l,o){const a=ji(l,!0).delete(o);return new wn(a).toPromise()}const wa=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,w.Z)(function*(){return a.db||(a.db=yield Xe()),a.db})()}_withRetries(a){var h=this;return(0,w.Z)(function*(){let g=0;for(;;)try{const I=yield h._openDb();return yield a(I)}catch(I){if(g++>3)throw I;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,w.Z)(function*(){return Xs()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,w.Z)(function*(){a.receiver=zi._getInstance(function jl(){return Xs()?self:null}()),a.receiver._subscribe("keyChanged",function(){var h=(0,w.Z)(function*(g,I){return{keyProcessed:(yield a._poll()).includes(I.key)}});return function(g,I){return h.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var h=(0,w.Z)(function*(g,I){return["keyChanged"]});return function(g,I){return h.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,w.Z)(function*(){var h,g;if(a.activeServiceWorker=yield function zl(){return eo.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Ys(a.activeServiceWorker);const I=yield a.sender._send("ping",{},800);I&&null!==(h=I[0])&&void 0!==h&&h.fulfilled&&null!==(g=I[0])&&void 0!==g&&g.value.includes("keyChanged")&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var h=this;return(0,w.Z)(function*(){if(h.sender&&h.activeServiceWorker&&function sc(){var l;return(null===(l=navigator?.serviceWorker)||void 0===l?void 0:l.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:a},h.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,w.Z)(function*(){try{if(!indexedDB)return!1;const a=yield Xe();return yield ro(a,Bi,"1"),yield ln(a,Bi),!0}catch{}return!1})()}_withPendingWrite(a){var h=this;return(0,w.Z)(function*(){h.pendingWrites++;try{yield a()}finally{h.pendingWrites--}})()}_set(a,h){var g=this;return(0,w.Z)(function*(){return g._withPendingWrite((0,w.Z)(function*(){return yield g._withRetries(I=>ro(I,a,h)),g.localCache[a]=h,g.notifyServiceWorker(a)}))})()}_get(a){var h=this;return(0,w.Z)(function*(){const g=yield h._withRetries(I=>function ac(l,o){return Sr.apply(this,arguments)}(I,a));return h.localCache[a]=g,g})()}_remove(a){var h=this;return(0,w.Z)(function*(){return h._withPendingWrite((0,w.Z)(function*(){return yield h._withRetries(g=>ln(g,a)),delete h.localCache[a],h.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,w.Z)(function*(){const h=yield a._withRetries(b=>{const F=ji(b,!1).getAll();return new wn(F).toPromise()});if(!h)return[];if(0!==a.pendingWrites)return[];const g=[],I=new Set;if(0!==h.length)for(const{fbase_key:b,value:F}of h)I.add(b),JSON.stringify(a.localCache[b])!==JSON.stringify(F)&&(a.notifyListeners(b,F),g.push(b));for(const b of Object.keys(a.localCache))a.localCache[b]&&!I.has(b)&&(a.notifyListeners(b,null),g.push(b));return g})()}notifyListeners(a,h){this.localCache[a]=h;const g=this.listeners[a];if(g)for(const I of Array.from(g))I(h)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,w.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),ri=1e12;class Ql{constructor(o){this.auth=o,this.counter=ri,this._widgets=new Map}render(o,a){const h=this.counter;return this._widgets.set(h,new fc(o,this.auth.name,a||{})),this.counter++,h}reset(o){var a;const h=o||ri;null===(a=this._widgets.get(h))||void 0===a||a.delete(),this._widgets.delete(h)}getResponse(o){var a;return(null===(a=this._widgets.get(o||ri))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,w.Z)(function*(){var h;return null===(h=a._widgets.get(o||ri))||void 0===h||h.execute(),""})()}}class fc{constructor(o,a,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const g="string"==typeof o?document.getElementById(o):o;H(g,"argument-error",{appName:a}),this.container=g,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function io(l){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<l;h++)o.push(a.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const so=xu("rcb"),pc=new Kt(3e4,6e4);class Hl{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=at().grecaptcha)||void 0===o||!o.render)}load(o,a=""){return H(function mc(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(a),o,"argument-error"),this.shouldResolveImmediately(a)&&Y(at().grecaptcha)?Promise.resolve(at().grecaptcha):new Promise((h,g)=>{const I=at().setTimeout(()=>{g(Qe(o,"network-request-failed"))},pc.get());at()[so]=()=>{at().clearTimeout(I),delete at()[so];const F=at().grecaptcha;if(!F||!Y(F))return void g(Qe(o,"internal-error"));const $=F.render;F.render=(ie,ce)=>{const ve=$(ie,ce);return this.counter++,ve},this.hostLanguage=a,h(F)},Jo(`${function Sl(){return Kr.recaptchaV2Script}()}?${(0,A.xO)({onload:so,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(I),g(Qe(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!(null===(a=at().grecaptcha)||void 0===a||!a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Jl{load(o){return(0,w.Z)(function*(){return new Ql(o)})()}clearedOneInstance(){}}const gc="recaptcha",Yl={theme:"light",type:"image"};class sr{constructor(o,a,h=Object.assign({},Yl)){this.parameters=h,this.type=gc,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Je(o),this.isInvisible="invisible"===this.parameters.size,H(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const g="string"==typeof a?document.getElementById(a):a;H(g,this.auth,"argument-error"),this.container=g,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Jl:new Hl,this.validateStartingState()}verify(){var o=this;return(0,w.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),h=o.getAssertedRecaptcha();return h.getResponse(a)||new Promise(I=>{const b=F=>{F&&(o.tokenChangeListeners.delete(b),I(F))};o.tokenChangeListeners.add(b),o.isInvisible&&h.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){H(!this.parameters.sitekey,this.auth,"argument-error"),H(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),H(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(h=>h(a)),"function"==typeof o)o(a);else if("string"==typeof o){const h=at()[o];"function"==typeof h&&h(a)}}}assertNotDestroyed(){H(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,w.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const h=document.createElement("div");a.appendChild(h),a=h}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,w.Z)(function*(){H(Ue()&&!Xs(),o.auth,"internal-error"),yield function ii(){let l=null;return new Promise(o=>{"complete"!==document.readyState?(l=()=>o(),window.addEventListener("load",l)):o()}).catch(o=>{throw l&&window.removeEventListener("load",l),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function J(l){return U.apply(this,arguments)}(o.auth);H(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return H(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class oo{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=$n._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Xl(l,o,a){return ao.apply(this,arguments)}function ao(){return(ao=(0,w.Z)(function*(l,o,a){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h=Je(l),g=yield br(h,o,(0,A.m9)(a));return new oo(g,I=>Ms(h,I))})).apply(this,arguments)}function On(l,o,a){return uo.apply(this,arguments)}function uo(){return(uo=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);yield Ds(!1,h,"phone");const g=yield br(h.auth,o,(0,A.m9)(a));return new oo(g,I=>Wu(h,I))})).apply(this,arguments)}function eh(l,o,a){return co.apply(this,arguments)}function co(){return(co=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);if((0,ae._isFirebaseServerApp)(h.auth.app))return Promise.reject(Pe(h.auth));const g=yield br(h.auth,o,(0,A.m9)(a));return new oo(g,I=>Jn(h,I))})).apply(this,arguments)}function br(l,o,a){return Ln.apply(this,arguments)}function Ln(){return Ln=(0,w.Z)(function*(l,o,a){var h;const g=yield a.verify();try{let I;if(H("string"==typeof g,l,"argument-error"),H(a.type===gc,l,"argument-error"),I="string"==typeof o?{phoneNumber:o}:o,"session"in I){const b=I.session;if("phoneNumber"in I)return H("enroll"===b.type,l,"internal-error"),(yield function ya(l,o){return be(l,"POST","/v2/accounts/mfaEnrollment:start",Se(l,o))}(l,{idToken:b.credential,phoneEnrollmentInfo:{phoneNumber:I.phoneNumber,recaptchaToken:g}})).phoneSessionInfo.sessionInfo;{H("signin"===b.type,l,"internal-error");const F=(null===(h=I.multiFactorHint)||void 0===h?void 0:h.uid)||I.multiFactorUid;return H(F,l,"missing-multi-factor-info"),(yield function hc(l,o){return be(l,"POST","/v2/accounts/mfaSignIn:start",Se(l,o))}(l,{mfaPendingCredential:b.credential,mfaEnrollmentId:F,phoneSignInInfo:{recaptchaToken:g}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:b}=yield function Wn(l,o){return Ps.apply(this,arguments)}(l,{phoneNumber:I.phoneNumber,recaptchaToken:g});return b}}finally{a._reset()}}),Ln.apply(this,arguments)}function Cr(l,o){return Mn.apply(this,arguments)}function Mn(){return(Mn=(0,w.Z)(function*(l,o){const a=(0,A.m9)(l);if((0,ae._isFirebaseServerApp)(a.auth.app))return Promise.reject(Pe(a.auth));yield ks(a,o)})).apply(this,arguments)}let $i=(()=>{class l{constructor(a){this.providerId=l.PROVIDER_ID,this.auth=Je(a)}verifyPhoneNumber(a,h){return br(this.auth,a,(0,A.m9)(h))}static credential(a,h){return $n._fromVerification(a,h)}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:h,temporaryProof:g}=a;return h&&g?$n._fromTokenResponse(h,g):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function or(l,o){return o?de(o):(H(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class Zi extends zn{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return tn(o,this._buildIdpRequest())}_linkToIdToken(o,a){return tn(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return tn(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Ra(l){return ju(l.auth,new Zi(l),l.bypassAuthState)}function _c(l){const{auth:o,user:a}=l;return H(a,o,"internal-error"),zu(a,new Zi(l),l.bypassAuthState)}function yc(l){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,w.Z)(function*(l){const{auth:o,user:a}=l;return H(a,o,"internal-error"),ks(a,new Zi(l),l.bypassAuthState)})).apply(this,arguments)}class Sa{constructor(o,a,h,g,I=!1){this.auth=o,this.resolver=h,this.user=g,this.bypassAuthState=I,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,w.Z)(function*(h,g){o.pendingPromise={resolve:h,reject:g};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(I){o.reject(I)}});return function(h,g){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,w.Z)(function*(){const{urlResponse:h,sessionId:g,postBody:I,tenantId:b,error:F,type:$}=o;if(F)return void a.reject(F);const ie={auth:a.auth,requestUri:h,sessionId:g,tenantId:b||void 0,postBody:I||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask($)(ie))}catch(ce){a.reject(ce)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Ra;case"linkViaPopup":case"linkViaRedirect":return yc;case"reauthViaPopup":case"reauthViaRedirect":return _c;default:q(this.auth,"internal-error")}}resolve(o){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ic=new Kt(2e3,1e4);function lo(l,o,a){return xr.apply(this,arguments)}function xr(){return(xr=(0,w.Z)(function*(l,o,a){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Qe(l,"operation-not-supported-in-this-environment"));const h=Je(l);ge(l,o,En);const g=or(h,a);return new ba(h,"signInViaPopup",o,g).executeNotNull()})).apply(this,arguments)}function th(l,o,a){return Fn.apply(this,arguments)}function Fn(){return(Fn=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);if((0,ae._isFirebaseServerApp)(h.auth.app))return Promise.reject(Qe(h.auth,"operation-not-supported-in-this-environment"));ge(h.auth,o,En);const g=or(h.auth,a);return new ba(h.auth,"reauthViaPopup",o,g,h).executeNotNull()})).apply(this,arguments)}function nh(l,o,a){return ho.apply(this,arguments)}function ho(){return(ho=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);ge(h.auth,o,En);const g=or(h.auth,a);return new ba(h.auth,"linkViaPopup",o,g,h).executeNotNull()})).apply(this,arguments)}let ba=(()=>{class l extends Sa{constructor(a,h,g,I,b){super(a,h,I,b),this.provider=g,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var a=this;return(0,w.Z)(function*(){const h=yield a.execute();return H(h,a.auth,"internal-error"),h})()}onExecution(){var a=this;return(0,w.Z)(function*(){gt(1===a.filter.length,"Popup operations only handle one event");const h=Dn();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],h),a.authWindow.associatedEvent=h,a.resolver._originValidation(a.auth).catch(g=>{a.reject(g)}),a.resolver._isIframeWebStorageSupported(a.auth,g=>{g||a.reject(Qe(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const a=()=>{var h,g;this.pollId=null!==(g=null===(h=this.authWindow)||void 0===h?void 0:h.window)&&void 0!==g&&g.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Qe(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(a,Ic.get())};a()}}return l.currentPopupAction=null,l})();const rh="pendingRedirect",Qi=new Map;class Hi extends Sa{constructor(o,a,h=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,h),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,w.Z)(function*(){let h=Qi.get(a.auth._key());if(!h){try{const I=(yield function Vr(l,o){return Rn.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;h=()=>Promise.resolve(I)}catch(g){h=()=>Promise.reject(g)}Qi.set(a.auth._key(),h)}return a.bypassAuthState||Qi.set(a.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,h=this;return(0,w.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(h,o);if("unknown"!==o.type){if(o.eventId){const g=yield h.auth._redirectUserForId(o.eventId);if(g)return h.user=g,a().call(h,o);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,w.Z)(function*(){})()}cleanUp(){}}function Rn(){return(Rn=(0,w.Z)(function*(l,o){const a=go(o),h=mo(l);if(!(yield h._isAvailable()))return!1;const g="true"===(yield h._get(a));return yield h._remove(a),g})).apply(this,arguments)}function fo(l,o){return po.apply(this,arguments)}function po(){return(po=(0,w.Z)(function*(l,o){return mo(l)._set(go(o),"true")})).apply(this,arguments)}function vc(){Qi.clear()}function Tc(l,o){Qi.set(l._key(),o)}function mo(l){return de(l._redirectPersistence)}function go(l){return He(rh,l.config.apiKey,l.name)}function Ec(l,o,a){return function Ca(l,o,a){return Ji.apply(this,arguments)}(l,o,a)}function Ji(){return(Ji=(0,w.Z)(function*(l,o,a){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h=Je(l);ge(l,o,En),yield h._initializationPromise;const g=or(h,a);return yield fo(g,h),g._openRedirect(h,o,"signInViaRedirect")})).apply(this,arguments)}function Ac(l,o,a){return function _o(l,o,a){return xa.apply(this,arguments)}(l,o,a)}function xa(){return(xa=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);if(ge(h.auth,o,En),(0,ae._isFirebaseServerApp)(h.auth.app))return Promise.reject(Pe(h.auth));yield h.auth._initializationPromise;const g=or(h.auth,a);yield fo(g,h.auth);const I=yield Na(h);return g._openRedirect(h.auth,o,"reauthViaRedirect",I)})).apply(this,arguments)}function Va(l,o,a){return function yo(l,o,a){return ka.apply(this,arguments)}(l,o,a)}function ka(){return(ka=(0,w.Z)(function*(l,o,a){const h=(0,A.m9)(l);ge(h.auth,o,En),yield h.auth._initializationPromise;const g=or(h.auth,a);yield Ds(!1,h,o.providerId),yield fo(g,h.auth);const I=yield Na(h);return g._openRedirect(h.auth,o,"linkViaRedirect",I)})).apply(this,arguments)}function wc(l,o){return ar.apply(this,arguments)}function ar(){return(ar=(0,w.Z)(function*(l,o){return yield Je(l)._initializationPromise,kr(l,o,!1)})).apply(this,arguments)}function kr(l,o){return ur.apply(this,arguments)}function ur(){return(ur=(0,w.Z)(function*(l,o,a=!1){if((0,ae._isFirebaseServerApp)(l.app))return Promise.reject(Pe(l));const h=Je(l),g=or(h,o),b=yield new Hi(h,g,a).execute();return b&&!a&&(delete b.user._redirectEventId,yield h._persistUserIfCurrent(b.user),yield h._setRedirectUser(null,o)),b})).apply(this,arguments)}function Na(l){return Io.apply(this,arguments)}function Io(){return(Io=(0,w.Z)(function*(l){const o=Dn(`${l.uid}:::`);return l._redirectEventId=o,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),o})).apply(this,arguments)}class Da{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(o,h)&&(a=!0,this.sendToConsumer(o,h),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Rc(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xi(l);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var h;if(o.error&&!Xi(o)){const g=(null===(h=o.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";a.onError(Qe(this.auth,g))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const h=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&h}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Yi(o))}saveEventToCache(o){this.cachedEventUids.add(Yi(o)),this.lastProcessedEventTime=Date.now()}}function Yi(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(o=>o).join("-")}function Xi({type:l,error:o}){return"unknown"===l&&"auth/no-auth-event"===o?.code}function Un(l){return cr.apply(this,arguments)}function cr(){return(cr=(0,w.Z)(function*(l,o={}){return be(l,"GET","/v1/projects",o)})).apply(this,arguments)}const Pc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Nr=/^https?/;function lr(){return(lr=(0,w.Z)(function*(l){if(l.config.emulator)return;const{authorizedDomains:o}=yield Un(l);for(const a of o)try{if(Sc(a))return}catch{}q(l,"unauthorized-domain")})).apply(this,arguments)}function Sc(l){const o=Wt(),{protocol:a,hostname:h}=new URL(o);if(l.startsWith("chrome-extension://")){const b=new URL(l);return""===b.hostname&&""===h?"chrome-extension:"===a&&l.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&b.hostname===h}if(!Nr.test(a))return!1;if(Pc.test(l))return h===l;const g=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+g+"|"+g+")$","i").test(h)}const hr=new Kt(3e4,6e4);function Oa(){const l=at().___jsl;if(l?.H)for(const o of Object.keys(l.H))if(l.H[o].r=l.H[o].r||[],l.H[o].L=l.H[o].L||[],l.H[o].r=[...l.H[o].L],l.CP)for(let a=0;a<l.CP.length;a++)l.CP[a]=null}let es=null;const bc=new Kt(5e3,15e3),ah="__/auth/iframe",vo="emulator/auth/iframe",Cc={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xc(l){const o=l.config;H(o.authDomain,l,"auth-domain-config-required");const a=o.emulator?_t(o,vo):`https://${l.config.authDomain}/${ah}`,h={apiKey:o.apiKey,appName:l.name,v:ae.SDK_VERSION},g=uh.get(l.config.apiHost);g&&(h.eid=g);const I=l._getFrameworks();return I.length&&(h.fw=I.join(",")),`${a}?${(0,A.xO)(h).slice(1)}`}function To(){return To=(0,w.Z)(function*(l){const o=yield function oh(l){return es=es||function sh(l){return new Promise((o,a)=>{var h,g,I;function b(){Oa(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{Oa(),a(Qe(l,"network-request-failed"))},timeout:hr.get()})}if(null!==(g=null===(h=at().gapi)||void 0===h?void 0:h.iframes)&&void 0!==g&&g.Iframe)o(gapi.iframes.getContext());else{if(null===(I=at().gapi)||void 0===I||!I.load){const F=xu("iframefcb");return at()[F]=()=>{gapi.load?b():a(Qe(l,"network-request-failed"))},Jo(`${function Cl(){return Kr.gapiScript}()}?onload=${F}`).catch($=>a($))}b()}}).catch(o=>{throw es=null,o})}(l),es}(l),a=at().gapi;return H(a,l,"internal-error"),o.open({where:document.body,url:xc(l),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Cc,dontclear:!0},h=>new Promise(function(){var g=(0,w.Z)(function*(I,b){yield h.restyle({setHideOnLeave:!1});const F=Qe(l,"network-request-failed"),$=at().setTimeout(()=>{b(F)},bc.get());function ie(){at().clearTimeout($),I(h)}h.ping(ie).then(ie,()=>{b(F)})});return function(I,b){return g.apply(this,arguments)}}()))}),To.apply(this,arguments)}const Dr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class La{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const fh="__/auth/handler",Ma="emulator/auth/handler",It=encodeURIComponent("fac");function Fa(l,o,a,h,g,I){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,w.Z)(function*(l,o,a,h,g,I){H(l.config.authDomain,l,"auth-domain-config-required"),H(l.config.apiKey,l,"invalid-api-key");const b={apiKey:l.config.apiKey,appName:l.name,authType:a,redirectUrl:h,v:ae.SDK_VERSION,eventId:g};if(o instanceof En){o.setDefaultLanguage(l.languageCode),b.providerId=o.providerId||"",(0,A.xb)(o.getCustomParameters())||(b.customParameters=JSON.stringify(o.getCustomParameters()));for(const[ce,ve]of Object.entries(I||{}))b[ce]=ve}if(o instanceof Qr){const ce=o.getScopes().filter(ve=>""!==ve);ce.length>0&&(b.scopes=ce.join(","))}l.tenantId&&(b.tid=l.tenantId);const F=b;for(const ce of Object.keys(F))void 0===F[ce]&&delete F[ce];const $=yield l._getAppCheckToken(),ie=$?`#${It}=${encodeURIComponent($)}`:"";return`${function ph({config:l}){return l.emulator?_t(l,Ma):`https://${l.authDomain}/${fh}`}(l)}?${(0,A.xO)(F).slice(1)}${ie}`})).apply(this,arguments)}const Ba="webStorageSupport",Nc=class qa{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qi,this._completeRedirectFn=kr,this._overrideRedirectResult=Tc}_openPopup(o,a,h,g){var I=this;return(0,w.Z)(function*(){var b;gt(null===(b=I.eventManagers[o._key()])||void 0===b?void 0:b.manager,"_initialize() not called before _openPopup()");const F=yield Fa(o,a,h,Wt(),g);return function hh(l,o,a,h=500,g=600){const I=Math.max((window.screen.availHeight-g)/2,0).toString(),b=Math.max((window.screen.availWidth-h)/2,0).toString();let F="";const $=Object.assign(Object.assign({},Dr),{width:h.toString(),height:g.toString(),top:I,left:b}),ie=(0,A.z$)().toLowerCase();a&&(F=Ai(ie)?"_blank":a),_e(ie)&&(o=o||"http://localhost",$.scrollbars="yes");const ce=Object.entries($).reduce((Ft,[Pn,is])=>`${Ft}${Pn}=${is},`,"");if(function Al(l=(0,A.z$)()){var o;return wi(l)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(ie)&&"_self"!==F)return function dh(l,o){const a=document.createElement("a");a.href=l,a.target=o;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(h)}(o||"",F),new La(null);const ve=window.open(o||"",F,ce);H(ve,l,"popup-blocked");try{ve.focus()}catch{}return new La(ve)}(o,F,Dn())})()}_openRedirect(o,a,h,g){var I=this;return(0,w.Z)(function*(){return yield I._originValidation(o),function ic(l){at().location.href=l}(yield Fa(o,a,h,Wt(),g)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:g,promise:I}=this.eventManagers[a];return g?Promise.resolve(g):(gt(I,"If manager is not set, promise should be"),I)}const h=this.initAndGetManager(o);return this.eventManagers[a]={promise:h},h.catch(()=>{delete this.eventManagers[a]}),h}initAndGetManager(o){var a=this;return(0,w.Z)(function*(){const h=yield function ch(l){return To.apply(this,arguments)}(o),g=new Da(o);return h.register("authEvent",I=>(H(I?.authEvent,o,"invalid-auth-event"),{status:g.onEvent(I.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:g},a.iframes[o._key()]=h,g})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Ba,{type:Ba},g=>{var I;const b=null===(I=g?.[0])||void 0===I?void 0:I[Ba];void 0!==b&&a(!!b),q(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function ih(l){return lr.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Lt()||Xt()||wi()}};class Eo{constructor(o){this.factorId=o}_process(o,a,h){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,h);case"signin":return this._finalizeSignIn(o,a.credential);default:return st("unexpected MultiFactorSessionType")}}}class si extends Eo{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new si(o)}_finalizeEnroll(o,a,h){return function Ia(l,o){return be(l,"POST","/v2/accounts/mfaEnrollment:finalize",Se(l,o))}(o,{idToken:a,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function dc(l,o){return be(l,"POST","/v2/accounts/mfaSignIn:finalize",Se(l,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let mh=(()=>{class l{constructor(){}static assertion(a){return si._fromCredential(a)}}return l.FACTOR_ID="phone",l})();var rs="@firebase/auth";class Ga{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,w.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(h=>{o(h?.stsTokenManager.accessToken||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);a&&(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){H(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(0,A.Pz)("authIdTokenMaxAge"),function Pl(l){Kr=l}({loadJS:l=>new Promise((o,a)=>{const h=document.createElement("script");h.setAttribute("src",l),h.onload=o,h.onerror=g=>{const I=Qe("internal-error");I.customData=g,a(I)},h.type="text/javascript",h.charset="UTF-8",function Lc(){var l,o;return null!==(o=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==o?o:document}().appendChild(h)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function Dc(l){(0,ae._registerComponent)(new ut.wA("auth",(o,{options:a})=>{const h=o.getProvider("app").getImmediate(),g=o.getProvider("heartbeat"),I=o.getProvider("app-check-internal"),{apiKey:b,authDomain:F}=h.options;H(b&&!b.includes(":"),"invalid-api-key",{appName:h.name});const $={apiKey:b,authDomain:F,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Wr(l)},ie=new yn(h,g,I,$);return function Nl(l,o){const a=o?.persistence||[],h=(Array.isArray(a)?a:[a]).map(de);o?.errorMap&&l._updateErrorMap(o.errorMap),l._initializeWithPersistence(h,o?.popupRedirectResolver)}(ie,a),ie},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,h)=>{o.getProvider("auth-internal").initialize()})),(0,ae._registerComponent)(new ut.wA("auth-internal",o=>{const a=Je(o.getProvider("auth").getImmediate());return new Ga(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,ae.registerVersion)(rs,"1.7.7",function _h(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(l)),(0,ae.registerVersion)(rs,"1.7.7","esm2017")}("Browser")},3881:(Pu,mr,re)=>{re.d(mr,{D:()=>by});var w=re(5619),ae=re(5879),A=re(6814),ye=re(8326),Tt=re(7217),ut=re(981),Ze=re(6321),We=re(5592),qe=re(2459),bt=re(2096),ct=re(7921),lt=re(9360),kt=re(8251);function jt(){return(0,lt.e)((r,e)=>{let t,n=!1;r.subscribe((0,kt.x)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var st,gt,Nt=re(7398),dn=re(6699),yi=re(3997),nn=re(2181),gr=(re(6365),re(3106)),q=re(5861),Qe=re(534),bn=re(4537),Pe=re(7879),ge=re(9058),rn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},H={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(k,E,C){C||(C=0);var N=Array(16);if("string"==typeof E)for(var D=0;16>D;++D)N[D]=E.charCodeAt(C++)|E.charCodeAt(C++)<<8|E.charCodeAt(C++)<<16|E.charCodeAt(C++)<<24;else for(D=0;16>D;++D)N[D]=E[C++]|E[C++]<<8|E[C++]<<16|E[C++]<<24;var M=k.g[3],S=(E=k.g[0])+(M^(C=k.g[1])&((D=k.g[2])^M))+N[0]+3614090360&4294967295;S=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=(C=(D=(M=(E=C+(S<<7&4294967295|S>>>25))+((S=M+(D^E&(C^D))+N[1]+3905402710&4294967295)<<12&4294967295|S>>>20))+((S=D+(C^M&(E^C))+N[2]+606105819&4294967295)<<17&4294967295|S>>>15))+((S=C+(E^D&(M^E))+N[3]+3250441966&4294967295)<<22&4294967295|S>>>10))+((S=E+(M^C&(D^M))+N[4]+4118548399&4294967295)<<7&4294967295|S>>>25))+((S=M+(D^E&(C^D))+N[5]+1200080426&4294967295)<<12&4294967295|S>>>20))+((S=D+(C^M&(E^C))+N[6]+2821735955&4294967295)<<17&4294967295|S>>>15))+((S=C+(E^D&(M^E))+N[7]+4249261313&4294967295)<<22&4294967295|S>>>10))+((S=E+(M^C&(D^M))+N[8]+1770035416&4294967295)<<7&4294967295|S>>>25))+((S=M+(D^E&(C^D))+N[9]+2336552879&4294967295)<<12&4294967295|S>>>20))+((S=D+(C^M&(E^C))+N[10]+4294925233&4294967295)<<17&4294967295|S>>>15))+((S=C+(E^D&(M^E))+N[11]+2304563134&4294967295)<<22&4294967295|S>>>10))+((S=E+(M^C&(D^M))+N[12]+1804603682&4294967295)<<7&4294967295|S>>>25))+((S=M+(D^E&(C^D))+N[13]+4254626195&4294967295)<<12&4294967295|S>>>20))+((S=D+(C^M&(E^C))+N[14]+2792965006&4294967295)<<17&4294967295|S>>>15))+((S=C+(E^D&(M^E))+N[15]+1236535329&4294967295)<<22&4294967295|S>>>10))+((S=E+(D^M&(C^D))+N[1]+4129170786&4294967295)<<5&4294967295|S>>>27))+((S=M+(C^D&(E^C))+N[6]+3225465664&4294967295)<<9&4294967295|S>>>23))+((S=D+(E^C&(M^E))+N[11]+643717713&4294967295)<<14&4294967295|S>>>18))+((S=C+(M^E&(D^M))+N[0]+3921069994&4294967295)<<20&4294967295|S>>>12))+((S=E+(D^M&(C^D))+N[5]+3593408605&4294967295)<<5&4294967295|S>>>27))+((S=M+(C^D&(E^C))+N[10]+38016083&4294967295)<<9&4294967295|S>>>23))+((S=D+(E^C&(M^E))+N[15]+3634488961&4294967295)<<14&4294967295|S>>>18))+((S=C+(M^E&(D^M))+N[4]+3889429448&4294967295)<<20&4294967295|S>>>12))+((S=E+(D^M&(C^D))+N[9]+568446438&4294967295)<<5&4294967295|S>>>27))+((S=M+(C^D&(E^C))+N[14]+3275163606&4294967295)<<9&4294967295|S>>>23))+((S=D+(E^C&(M^E))+N[3]+4107603335&4294967295)<<14&4294967295|S>>>18))+((S=C+(M^E&(D^M))+N[8]+1163531501&4294967295)<<20&4294967295|S>>>12))+((S=E+(D^M&(C^D))+N[13]+2850285829&4294967295)<<5&4294967295|S>>>27))+((S=M+(C^D&(E^C))+N[2]+4243563512&4294967295)<<9&4294967295|S>>>23))+((S=D+(E^C&(M^E))+N[7]+1735328473&4294967295)<<14&4294967295|S>>>18))+((S=C+(M^E&(D^M))+N[12]+2368359562&4294967295)<<20&4294967295|S>>>12))+((S=E+(C^D^M)+N[5]+4294588738&4294967295)<<4&4294967295|S>>>28))+((S=M+(E^C^D)+N[8]+2272392833&4294967295)<<11&4294967295|S>>>21))+((S=D+(M^E^C)+N[11]+1839030562&4294967295)<<16&4294967295|S>>>16))+((S=C+(D^M^E)+N[14]+4259657740&4294967295)<<23&4294967295|S>>>9))+((S=E+(C^D^M)+N[1]+2763975236&4294967295)<<4&4294967295|S>>>28))+((S=M+(E^C^D)+N[4]+1272893353&4294967295)<<11&4294967295|S>>>21))+((S=D+(M^E^C)+N[7]+4139469664&4294967295)<<16&4294967295|S>>>16))+((S=C+(D^M^E)+N[10]+3200236656&4294967295)<<23&4294967295|S>>>9))+((S=E+(C^D^M)+N[13]+681279174&4294967295)<<4&4294967295|S>>>28))+((S=M+(E^C^D)+N[0]+3936430074&4294967295)<<11&4294967295|S>>>21))+((S=D+(M^E^C)+N[3]+3572445317&4294967295)<<16&4294967295|S>>>16))+((S=C+(D^M^E)+N[6]+76029189&4294967295)<<23&4294967295|S>>>9))+((S=E+(C^D^M)+N[9]+3654602809&4294967295)<<4&4294967295|S>>>28))+((S=M+(E^C^D)+N[12]+3873151461&4294967295)<<11&4294967295|S>>>21))+((S=D+(M^E^C)+N[15]+530742520&4294967295)<<16&4294967295|S>>>16))+((S=C+(D^M^E)+N[2]+3299628645&4294967295)<<23&4294967295|S>>>9))+((S=E+(D^(C|~M))+N[0]+4096336452&4294967295)<<6&4294967295|S>>>26))+((S=M+(C^(E|~D))+N[7]+1126891415&4294967295)<<10&4294967295|S>>>22))+((S=D+(E^(M|~C))+N[14]+2878612391&4294967295)<<15&4294967295|S>>>17))+((S=C+(M^(D|~E))+N[5]+4237533241&4294967295)<<21&4294967295|S>>>11))+((S=E+(D^(C|~M))+N[12]+1700485571&4294967295)<<6&4294967295|S>>>26))+((S=M+(C^(E|~D))+N[3]+2399980690&4294967295)<<10&4294967295|S>>>22))+((S=D+(E^(M|~C))+N[10]+4293915773&4294967295)<<15&4294967295|S>>>17))+((S=C+(M^(D|~E))+N[1]+2240044497&4294967295)<<21&4294967295|S>>>11))+((S=E+(D^(C|~M))+N[8]+1873313359&4294967295)<<6&4294967295|S>>>26))+((S=M+(C^(E|~D))+N[15]+4264355552&4294967295)<<10&4294967295|S>>>22))+((S=D+(E^(M|~C))+N[6]+2734768916&4294967295)<<15&4294967295|S>>>17))+((S=C+(M^(D|~E))+N[13]+1309151649&4294967295)<<21&4294967295|S>>>11))+((M=(E=C+((S=E+(D^(C|~M))+N[4]+4149444226&4294967295)<<6&4294967295|S>>>26))+((S=M+(C^(E|~D))+N[11]+3174756917&4294967295)<<10&4294967295|S>>>22))^((D=M+((S=D+(E^(M|~C))+N[2]+718787259&4294967295)<<15&4294967295|S>>>17))|~E))+N[9]+3951481745&4294967295,k.g[0]=k.g[0]+E&4294967295,k.g[1]=k.g[1]+(D+(S<<21&4294967295|S>>>11))&4294967295,k.g[2]=k.g[2]+D&4294967295,k.g[3]=k.g[3]+M&4294967295}function c(k,E){this.h=E;for(var C=[],N=!0,D=k.length-1;0<=D;D--){var M=0|k[D];N&&M==E||(C[D]=M,N=!1)}this.g=C}(function e(k,E){function C(){}C.prototype=E.prototype,k.D=E.prototype,k.prototype=new C,k.prototype.constructor=k,k.C=function(N,D,M){for(var S=Array(arguments.length-2),Fr=2;Fr<arguments.length;Fr++)S[Fr-2]=arguments[Fr];return E.prototype[D].apply(N,S)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(k,E){void 0===E&&(E=k.length);for(var C=E-this.blockSize,N=this.B,D=this.h,M=0;M<E;){if(0==D)for(;M<=C;)i(this,k,M),M+=this.blockSize;if("string"==typeof k){for(;M<E;)if(N[D++]=k.charCodeAt(M++),D==this.blockSize){i(this,N),D=0;break}}else for(;M<E;)if(N[D++]=k[M++],D==this.blockSize){i(this,N),D=0;break}}this.h=D,this.o+=E},n.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var E=1;E<k.length-8;++E)k[E]=0;var C=8*this.o;for(E=k.length-8;E<k.length;++E)k[E]=255&C,C/=256;for(this.u(k),k=Array(16),E=C=0;4>E;++E)for(var N=0;32>N;N+=8)k[C++]=this.g[E]>>>N&255;return k};var d={};function f(k){return-128<=k&&128>k?function s(k,E){var C=d;return Object.prototype.hasOwnProperty.call(C,k)?C[k]:C[k]=E(k)}(k,function(E){return new c([0|E],0>E?-1:0)}):new c([0|k],0>k?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return T;if(0>k)return Z(m(-k));for(var E=[],C=1,N=0;k>=C;N++)E[N]=k/C|0,C*=4294967296;return new c(E,0)}var T=f(0),R=f(1),O=f(16777216);function W(k){if(0!=k.h)return!1;for(var E=0;E<k.g.length;E++)if(0!=k.g[E])return!1;return!0}function Q(k){return-1==k.h}function Z(k){for(var E=k.g.length,C=[],N=0;N<E;N++)C[N]=~k.g[N];return new c(C,~k.h).add(R)}function se(k,E){return k.add(Z(E))}function le(k,E){for(;(65535&k[E])!=k[E];)k[E+1]+=k[E]>>>16,k[E]&=65535,E++}function oe(k,E){this.g=k,this.h=E}function pe(k,E){if(W(E))throw Error("division by zero");if(W(k))return new oe(T,T);if(Q(k))return E=pe(Z(k),E),new oe(Z(E.g),Z(E.h));if(Q(E))return E=pe(k,Z(E)),new oe(Z(E.g),E.h);if(30<k.g.length){if(Q(k)||Q(E))throw Error("slowDivide_ only works with positive integers.");for(var C=R,N=E;0>=N.l(k);)C=we(C),N=we(N);var D=Ie(C,1),M=Ie(N,1);for(N=Ie(N,2),C=Ie(C,2);!W(N);){var S=M.add(N);0>=S.l(k)&&(D=D.add(C),M=S),N=Ie(N,1),C=Ie(C,1)}return E=se(k,D.j(E)),new oe(D,E)}for(D=T;0<=k.l(E);){for(C=Math.max(1,Math.floor(k.m()/E.m())),N=48>=(N=Math.ceil(Math.log(C)/Math.LN2))?1:Math.pow(2,N-48),S=(M=m(C)).j(E);Q(S)||0<S.l(k);)S=(M=m(C-=N)).j(E);W(M)&&(M=R),D=D.add(M),k=se(k,S)}return new oe(D,k)}function we(k){for(var E=k.g.length+1,C=[],N=0;N<E;N++)C[N]=k.i(N)<<1|k.i(N-1)>>>31;return new c(C,k.h)}function Ie(k,E){var C=E>>5;E%=32;for(var N=k.g.length-C,D=[],M=0;M<N;M++)D[M]=0<E?k.i(M+C)>>>E|k.i(M+C+1)<<32-E:k.i(M+C);return new c(D,k.h)}(r=c.prototype).m=function(){if(Q(this))return-Z(this).m();for(var k=0,E=1,C=0;C<this.g.length;C++){var N=this.i(C);k+=(0<=N?N:4294967296+N)*E,E*=4294967296}return k},r.toString=function(k){if(2>(k=k||10)||36<k)throw Error("radix out of range: "+k);if(W(this))return"0";if(Q(this))return"-"+Z(this).toString(k);for(var E=m(Math.pow(k,6)),C=this,N="";;){var D=pe(C,E).g,M=((0<(C=se(C,D.j(E))).g.length?C.g[0]:C.h)>>>0).toString(k);if(W(C=D))return M+N;for(;6>M.length;)M="0"+M;N=M+N}},r.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h},r.l=function(k){return Q(k=se(this,k))?-1:W(k)?0:1},r.abs=function(){return Q(this)?Z(this):this},r.add=function(k){for(var E=Math.max(this.g.length,k.g.length),C=[],N=0,D=0;D<=E;D++){var M=N+(65535&this.i(D))+(65535&k.i(D)),S=(M>>>16)+(this.i(D)>>>16)+(k.i(D)>>>16);N=S>>>16,C[D]=(S&=65535)<<16|(M&=65535)}return new c(C,-2147483648&C[C.length-1]?-1:0)},r.j=function(k){if(W(this)||W(k))return T;if(Q(this))return Q(k)?Z(this).j(Z(k)):Z(Z(this).j(k));if(Q(k))return Z(this.j(Z(k)));if(0>this.l(O)&&0>k.l(O))return m(this.m()*k.m());for(var E=this.g.length+k.g.length,C=[],N=0;N<2*E;N++)C[N]=0;for(N=0;N<this.g.length;N++)for(var D=0;D<k.g.length;D++){var M=this.i(N)>>>16,S=65535&this.i(N),Fr=k.i(D)>>>16,au=65535&k.i(D);C[2*N+2*D]+=S*au,le(C,2*N+2*D),C[2*N+2*D+1]+=M*au,le(C,2*N+2*D+1),C[2*N+2*D+1]+=S*Fr,le(C,2*N+2*D+1),C[2*N+2*D+2]+=M*Fr,le(C,2*N+2*D+2)}for(N=0;N<E;N++)C[N]=C[2*N+1]<<16|C[2*N];for(N=E;N<2*E;N++)C[N]=0;return new c(C,0)},r.A=function(k){return pe(this,k).h},r.and=function(k){for(var E=Math.max(this.g.length,k.g.length),C=[],N=0;N<E;N++)C[N]=this.i(N)&k.i(N);return new c(C,this.h&k.h)},r.or=function(k){for(var E=Math.max(this.g.length,k.g.length),C=[],N=0;N<E;N++)C[N]=this.i(N)|k.i(N);return new c(C,this.h|k.h)},r.xor=function(k){for(var E=Math.max(this.g.length,k.g.length),C=[],N=0;N<E;N++)C[N]=this.i(N)^k.i(N);return new c(C,this.h^k.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,gt=H.Md5=n,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=m,c.fromString=function y(k,E){if(0==k.length)throw Error("number format error: empty string");if(2>(E=E||10)||36<E)throw Error("radix out of range: "+E);if("-"==k.charAt(0))return Z(y(k.substring(1),E));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=m(Math.pow(E,8)),N=T,D=0;D<k.length;D+=8){var M=Math.min(8,k.length-D),S=parseInt(k.substring(D,D+M),E);8>M?(M=m(Math.pow(E,M)),N=N.j(M).add(m(S))):N=(N=N.j(C)).add(m(S))}return N},st=H.Integer=c}).apply(typeof rn<"u"?rn:typeof self<"u"?self:typeof window<"u"?window:{});var sn,Ct,Et,Kt,_t,ft,fn,Dt,Se,Wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ue={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(u,p,_){return u==Array.prototype||u==Object.prototype||(u[p]=_.value),u},n=function t(u){u=["object"==typeof globalThis&&globalThis,u,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Wt&&Wt];for(var p=0;p<u.length;++p){var _=u[p];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}(this);!function i(u,p){if(p)e:{var _=n;u=u.split(".");for(var v=0;v<u.length-1;v++){var L=u[v];if(!(L in _))break e;_=_[L]}(p=p(v=_[u=u[u.length-1]]))!=v&&null!=p&&e(_,u,{configurable:!0,writable:!0,value:p})}}("Array.prototype.values",function(u){return u||function(){return function s(u,p){u instanceof String&&(u+="");var _=0,v=!1,L={next:function(){if(!v&&_<u.length){var G=_++;return{value:p(G,u[G]),done:!1}}return v=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}(this,function(p,_){return _})}});var c=c||{},d=this||self;function f(u){var p=typeof u;return"array"==(p="object"!=p?p:u?Array.isArray(u)?"array":p:"null")||"object"==p&&"number"==typeof u.length}function m(u){var p=typeof u;return"object"==p&&null!=u||"function"==p}function y(u,p,_){return u.call.apply(u.bind,arguments)}function T(u,p,_){if(!u)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,v),u.apply(p,L)}}return function(){return u.apply(p,arguments)}}function R(u,p,_){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:T).apply(null,arguments)}function O(u,p){var _=Array.prototype.slice.call(arguments,1);return function(){var v=_.slice();return v.push.apply(v,arguments),u.apply(this,v)}}function W(u,p){function _(){}_.prototype=p.prototype,u.aa=p.prototype,u.prototype=new _,u.prototype.constructor=u,u.Qb=function(v,L,G){for(var ee=Array(arguments.length-2),$e=2;$e<arguments.length;$e++)ee[$e-2]=arguments[$e];return p.prototype[L].apply(v,ee)}}function Q(u){const p=u.length;if(0<p){const _=Array(p);for(let v=0;v<p;v++)_[v]=u[v];return _}return[]}function Z(u,p){for(let _=1;_<arguments.length;_++){const v=arguments[_];if(f(v)){const L=u.length||0,G=v.length||0;u.length=L+G;for(let ee=0;ee<G;ee++)u[L+ee]=v[ee]}else u.push(v)}}function le(u){return/^[\s\xa0]*$/.test(u)}function oe(){var u=d.navigator;return u&&(u=u.userAgent)?u:""}function pe(u){return pe[" "](u),u}pe[" "]=function(){};var we=!(-1==oe().indexOf("Gecko")||-1!=oe().toLowerCase().indexOf("webkit")&&-1==oe().indexOf("Edge")||-1!=oe().indexOf("Trident")||-1!=oe().indexOf("MSIE")||-1!=oe().indexOf("Edge"));function Ie(u,p,_){for(const v in u)p.call(_,u[v],v,u)}function E(u){const p={};for(const _ in u)p[_]=u[_];return p}const C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(u,p){let _,v;for(let L=1;L<arguments.length;L++){for(_ in v=arguments[L],v)u[_]=v[_];for(let G=0;G<C.length;G++)_=C[G],Object.prototype.hasOwnProperty.call(v,_)&&(u[_]=v[_])}}function D(u){var p=1;u=u.split(":");const _=[];for(;0<p&&u.length;)_.push(u.shift()),p--;return u.length&&_.push(u.join(":")),_}function M(u){d.setTimeout(()=>{throw u},0)}function S(){var u=Jd;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}var au=new class se{constructor(p,_){this.i=p,this.j=_,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}(()=>new Cy,u=>u.reset());class Cy{constructor(){this.next=this.g=this.h=null}set(p,_){this.h=p,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let uu,cu=!1,Jd=new class Fr{constructor(){this.h=this.g=null}add(p,_){const v=au.get();v.set(p,_),this.h?this.h.next=v:this.g=v,this.h=v}},Yp=()=>{const u=d.Promise.resolve(void 0);uu=()=>{u.then(xy)}};var xy=()=>{for(var u;u=S();){try{u.h.call(u.g)}catch(_){M(_)}var p=au;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}cu=!1};function pi(){this.s=this.s,this.C=this.C}function Bt(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}pi.prototype.s=!1,pi.prototype.ma=function(){this.s||(this.s=!0,this.N())},pi.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Bt.prototype.h=function(){this.defaultPrevented=!0};var Vy=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const _=()=>{};d.addEventListener("test",_,p),d.removeEventListener("test",_,p)}catch{}return u}();function lu(u,p){if(Bt.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var _=this.type=u.type,v=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(we){e:{try{pe(p.nodeName);var L=!0;break e}catch{}L=!1}L||(p=null)}}else"mouseover"==_?p=u.fromElement:"mouseout"==_&&(p=u.toElement);this.relatedTarget=p,v?(this.clientX=void 0!==v.clientX?v.clientX:v.pageX,this.clientY=void 0!==v.clientY?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:ky[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&lu.aa.h.call(this)}}W(lu,Bt);var ky={2:"touch",3:"pen",4:"mouse"};lu.prototype.h=function(){lu.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var hu="closure_listenable_"+(1e6*Math.random()|0),Ny=0;function Dy(u,p,_,v,L){this.listener=u,this.proxy=null,this.src=p,this.type=_,this.capture=!!v,this.ha=L,this.key=++Ny,this.da=this.fa=!1}function ol(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function al(u){this.src=u,this.g={},this.h=0}function Yd(u,p){var _=p.type;if(_ in u.g){var G,v=u.g[_],L=Array.prototype.indexOf.call(v,p,void 0);(G=0<=L)&&Array.prototype.splice.call(v,L,1),G&&(ol(p),0==u.g[_].length&&(delete u.g[_],u.h--))}}function Xd(u,p,_,v){for(var L=0;L<u.length;++L){var G=u[L];if(!G.da&&G.listener==p&&G.capture==!!_&&G.ha==v)return L}return-1}al.prototype.add=function(u,p,_,v,L){var G=u.toString();(u=this.g[G])||(u=this.g[G]=[],this.h++);var ee=Xd(u,p,v,L);return-1<ee?(p=u[ee],_||(p.fa=!1)):((p=new Dy(p,this.src,G,!!v,L)).fa=_,u.push(p)),p};var ef="closure_lm_"+(1e6*Math.random()|0),tf={};function Xp(u,p,_,v,L){if(v&&v.once)return tm(u,p,_,v,L);if(Array.isArray(p)){for(var G=0;G<p.length;G++)Xp(u,p[G],_,v,L);return null}return _=of(_),u&&u[hu]?u.K(p,_,m(v)?!!v.capture:!!v,L):em(u,p,_,!1,v,L)}function em(u,p,_,v,L,G){if(!p)throw Error("Invalid event type");var ee=m(L)?!!L.capture:!!L,$e=rf(u);if($e||(u[ef]=$e=new al(u)),(_=$e.add(p,_,v,ee,G)).proxy)return _;if(v=function Oy(){const p=Ly;return function u(_){return p.call(u.src,u.listener,_)}}(),_.proxy=v,v.src=u,v.listener=_,u.addEventListener)Vy||(L=ee),void 0===L&&(L=!1),u.addEventListener(p.toString(),v,L);else if(u.attachEvent)u.attachEvent(rm(p.toString()),v);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(v)}return _}function tm(u,p,_,v,L){if(Array.isArray(p)){for(var G=0;G<p.length;G++)tm(u,p[G],_,v,L);return null}return _=of(_),u&&u[hu]?u.L(p,_,m(v)?!!v.capture:!!v,L):em(u,p,_,!0,v,L)}function nm(u,p,_,v,L){if(Array.isArray(p))for(var G=0;G<p.length;G++)nm(u,p[G],_,v,L);else v=m(v)?!!v.capture:!!v,_=of(_),u&&u[hu]?(u=u.i,(p=String(p).toString())in u.g&&-1<(_=Xd(G=u.g[p],_,v,L))&&(ol(G[_]),Array.prototype.splice.call(G,_,1),0==G.length&&(delete u.g[p],u.h--))):u&&(u=rf(u))&&(p=u.g[p.toString()],u=-1,p&&(u=Xd(p,_,v,L)),(_=-1<u?p[u]:null)&&nf(_))}function nf(u){if("number"!=typeof u&&u&&!u.da){var p=u.src;if(p&&p[hu])Yd(p.i,u);else{var _=u.type,v=u.proxy;p.removeEventListener?p.removeEventListener(_,v,u.capture):p.detachEvent?p.detachEvent(rm(_),v):p.addListener&&p.removeListener&&p.removeListener(v),(_=rf(p))?(Yd(_,u),0==_.h&&(_.src=null,p[ef]=null)):ol(u)}}}function rm(u){return u in tf?tf[u]:tf[u]="on"+u}function Ly(u,p){if(u.da)u=!0;else{p=new lu(p,this);var _=u.listener,v=u.ha||u.src;u.fa&&nf(u),u=_.call(v,p)}return u}function rf(u){return(u=u[ef])instanceof al?u:null}var sf="__closure_events_fn_"+(1e9*Math.random()>>>0);function of(u){return"function"==typeof u?u:(u[sf]||(u[sf]=function(p){return u.handleEvent(p)}),u[sf])}function qt(){pi.call(this),this.i=new al(this),this.M=this,this.F=null}function Jt(u,p){var _,v=u.F;if(v)for(_=[];v;v=v.F)_.push(v);if(u=u.M,v=p.type||p,"string"==typeof p)p=new Bt(p,u);else if(p instanceof Bt)p.target=p.target||u;else{var L=p;N(p=new Bt(v,u),L)}if(L=!0,_)for(var G=_.length-1;0<=G;G--){var ee=p.g=_[G];L=ul(ee,v,!0,p)&&L}if(L=ul(ee=p.g=u,v,!0,p)&&L,L=ul(ee,v,!1,p)&&L,_)for(G=0;G<_.length;G++)L=ul(ee=p.g=_[G],v,!1,p)&&L}function ul(u,p,_,v){if(!(p=u.i.g[String(p)]))return!0;p=p.concat();for(var L=!0,G=0;G<p.length;++G){var ee=p[G];if(ee&&!ee.da&&ee.capture==_){var $e=ee.listener,Vt=ee.ha||ee.src;ee.fa&&Yd(u.i,ee),L=!1!==$e.call(Vt,v)&&L}}return L&&!v.defaultPrevented}function im(u,p,_){if("function"==typeof u)_&&(u=R(u,_));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=R(u.handleEvent,u)}return 2147483647<Number(p)?-1:d.setTimeout(u,p||0)}function sm(u){u.g=im(()=>{u.g=null,u.i&&(u.i=!1,sm(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}W(qt,pi),qt.prototype[hu]=!0,qt.prototype.removeEventListener=function(u,p,_,v){nm(this,u,p,_,v)},qt.prototype.N=function(){if(qt.aa.N.call(this),this.i){var p,u=this.i;for(p in u.g){for(var _=u.g[p],v=0;v<_.length;v++)ol(_[v]);delete u.g[p],u.h--}}this.F=null},qt.prototype.K=function(u,p,_,v){return this.i.add(String(u),p,!1,_,v)},qt.prototype.L=function(u,p,_,v){return this.i.add(String(u),p,!0,_,v)};class My extends pi{constructor(p,_){super(),this.m=p,this.l=_,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:sm(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function du(u){pi.call(this),this.h=u,this.g={}}W(du,pi);var om=[];function am(u){Ie(u.g,function(p,_){this.g.hasOwnProperty(_)&&nf(p)},u),u.g={}}du.prototype.N=function(){du.aa.N.call(this),am(this)},du.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var af=d.JSON.stringify,Fy=d.JSON.parse,Uy=class{stringify(u){return d.JSON.stringify(u,void 0)}parse(u){return d.JSON.parse(u,void 0)}};function uf(){}function cm(){}uf.prototype.h=null;var fu={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cf(){Bt.call(this,"d")}function lf(){Bt.call(this,"c")}W(cf,Bt),W(lf,Bt);var ms={},lm=null;function cl(){return lm=lm||new qt}function hm(u){Bt.call(this,ms.La,u)}function pu(u){const p=cl();Jt(p,new hm(p))}function dm(u,p){Bt.call(this,ms.STAT_EVENT,u),this.stat=p}function Yt(u){const p=cl();Jt(p,new dm(p,u))}function fm(u,p){Bt.call(this,ms.Ma,u),this.size=p}function mu(u,p){if("function"!=typeof u)throw Error("Fn must not be null and must be a function");return d.setTimeout(function(){u()},p)}function gu(){this.g=!0}function zo(u,p,_,v){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+function zy(u,p){if(!u.g)return p;if(!p)return null;try{var _=JSON.parse(p);if(_)for(u=0;u<_.length;u++)if(Array.isArray(_[u])){var v=_[u];if(!(2>v.length)){var L=v[1];if(Array.isArray(L)&&!(1>L.length)){var G=L[0];if("noop"!=G&&"stop"!=G&&"close"!=G)for(var ee=1;ee<L.length;ee++)L[ee]=""}}}return af(_)}catch{return p}}(u,_)+(v?" "+v:"")})}ms.La="serverreachability",W(hm,Bt),ms.STAT_EVENT="statevent",W(dm,Bt),ms.Ma="timingevent",W(fm,Bt),gu.prototype.xa=function(){this.g=!1},gu.prototype.info=function(){};var hf,ll={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},pm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function hl(){}function mi(u,p,_,v){this.j=u,this.i=p,this.l=_,this.R=v||1,this.U=new du(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new mm}function mm(){this.i=null,this.g="",this.h=!1}W(hl,uf),hl.prototype.g=function(){return new XMLHttpRequest},hl.prototype.i=function(){return{}},hf=new hl;var gm={},df={};function ff(u,p,_){u.L=1,u.v=ml(Ur(p)),u.m=_,u.P=!0,_m(u,null)}function _m(u,p){u.F=Date.now(),dl(u),u.A=Ur(u.v);var _=u.A,v=u.R;Array.isArray(v)||(v=[String(v)]),Vm(_.i,"t",v),u.C=0,_=u.j.J,u.h=new mm,u.g=Qm(u.j,_?p:null,!u.m),0<u.O&&(u.M=new My(R(u.Y,u,u.g),u.O)),p=u.U,_=u.g,v=u.ca;var L="readystatechange";Array.isArray(L)||(L&&(om[0]=L.toString()),L=om);for(var G=0;G<L.length;G++){var ee=Xp(_,L[G],v||p.handleEvent,!1,p.h||p);if(!ee)break;p.g[ee.key]=ee}p=u.H?E(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),pu(),function By(u,p,_,v,L,G){u.info(function(){if(u.g)if(G)for(var ee="",$e=G.split("&"),Vt=0;Vt<$e.length;Vt++){var De=$e[Vt].split("=");if(1<De.length){var Gt=De[0];De=De[1];var zt=Gt.split("_");ee=2<=zt.length&&"type"==zt[1]?ee+(Gt+"=")+De+"&":ee+(Gt+"=redacted&")}}else ee=null;else ee=G;return"XMLHTTP REQ ("+v+") [attempt "+L+"]: "+p+"\n"+_+"\n"+ee})}(u.i,u.u,u.A,u.l,u.R,u.m)}function ym(u){return!!u.g&&"GET"==u.u&&2!=u.L&&u.j.Ca}function jy(u,p){var _=u.C,v=p.indexOf("\n",_);return-1==v?df:(_=Number(p.substring(_,v)),isNaN(_)?gm:(v+=1)+_>p.length?df:(p=p.slice(v,v+_),u.C=v+_,p))}function dl(u){u.S=Date.now()+u.I,Im(u,u.I)}function Im(u,p){if(null!=u.B)throw Error("WatchDog timer not null");u.B=mu(R(u.ba,u),p)}function pf(u){u.B&&(d.clearTimeout(u.B),u.B=null)}function _u(u){0==u.j.G||u.J||Wm(u.j,u)}function gs(u){pf(u);var p=u.M;p&&"function"==typeof p.ma&&p.ma(),u.M=null,am(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function mf(u,p){try{var _=u.j;if(0!=_.G&&(_.g==u||gf(_.h,u)))if(!u.K&&gf(_.h,u)&&3==_.G){try{var v=_.Da.g.parse(p)}catch{v=null}if(Array.isArray(v)&&3==v.length){var L=v;if(0==L[0]){e:if(!_.u){if(_.g){if(!(_.g.F+3e3<u.F))break e;vl(_),yl(_)}vf(_),Yt(18)}}else _.za=L[1],0<_.za-_.T&&37500>L[2]&&_.F&&0==_.v&&!_.C&&(_.C=mu(R(_.Za,_),6e3));if(1>=Em(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else ys(_,11)}else if((u.K||_.g==u)&&vl(_),!le(p))for(L=_.Da.g.parse(p),p=0;p<L.length;p++){let De=L[p];if(_.T=De[0],De=De[1],2==_.G)if("c"==De[0]){_.K=De[1],_.ia=De[2];const Gt=De[3];null!=Gt&&(_.la=Gt,_.j.info("VER="+_.la));const zt=De[4];null!=zt&&(_.Aa=zt,_.j.info("SVER="+_.Aa));const Ko=De[5];null!=Ko&&"number"==typeof Ko&&0<Ko&&(_.L=v=1.5*Ko,_.j.info("backChannelRequestTimeoutMs_="+v)),v=_;const Bn=u.g;if(Bn){const El=Bn.g?Bn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(El){var G=v.h;G.g||-1==El.indexOf("spdy")&&-1==El.indexOf("quic")&&-1==El.indexOf("h2")||(G.j=G.l,G.g=new Set,G.h&&(_f(G,G.h),G.h=null))}if(v.D){const Ef=Bn.g?Bn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ef&&(v.ya=Ef,tt(v.I,v.D,Ef))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-u.F,_.j.info("Handshake RTT: "+_.R+"ms"));var ee=u;if((v=_).qa=Zm(v,v.J?v.ia:null,v.W),ee.K){Am(v.h,ee);var $e=ee,Vt=v.L;Vt&&($e.I=Vt),$e.B&&(pf($e),dl($e)),v.g=ee}else zm(v);0<_.i.length&&Il(_)}else"stop"!=De[0]&&"close"!=De[0]||ys(_,7);else 3==_.G&&("stop"==De[0]||"close"==De[0]?"stop"==De[0]?ys(_,7):If(_):"noop"!=De[0]&&_.l&&_.l.ta(De),_.v=0)}pu()}catch{}}function vm(u){this.l=u||10,u=d.PerformanceNavigationTiming?0<(u=d.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(d.chrome&&d.chrome.loadTimes&&d.chrome.loadTimes()&&d.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Tm(u){return!!u.h||!!u.g&&u.g.size>=u.j}function Em(u){return u.h?1:u.g?u.g.size:0}function gf(u,p){return u.h?u.h==p:!!u.g&&u.g.has(p)}function _f(u,p){u.g?u.g.add(p):u.h=p}function Am(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}function wm(u){if(null!=u.h)return u.i.concat(u.h.D);if(null!=u.g&&0!==u.g.size){let p=u.i;for(const _ of u.g.values())p=p.concat(_.D);return p}return Q(u.i)}function Rm(u,p){if(u.forEach&&"function"==typeof u.forEach)u.forEach(p,void 0);else if(f(u)||"string"==typeof u)Array.prototype.forEach.call(u,p,void 0);else for(var _=function $y(u){if(u.na&&"function"==typeof u.na)return u.na();if(!u.V||"function"!=typeof u.V){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||"string"==typeof u){var p=[];u=u.length;for(var _=0;_<u;_++)p.push(_);return p}p=[],_=0;for(const v in u)p[_++]=v;return p}}}(u),v=function Ky(u){if(u.V&&"function"==typeof u.V)return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if("string"==typeof u)return u.split("");if(f(u)){for(var p=[],_=u.length,v=0;v<_;v++)p.push(u[v]);return p}for(v in p=[],_=0,u)p[_++]=u[v];return p}(u),L=v.length,G=0;G<L;G++)p.call(void 0,v[G],_&&_[G],u)}mi.prototype.ca=function(u){u=u.target;const p=this.M;p&&3==Br(u)?p.j():this.Y(u)},mi.prototype.Y=function(u){try{if(u==this.g)e:{const zt=Br(this.g);var p=this.g.Ba();if(this.g.Z(),!(3>zt)&&(3!=zt||this.g&&(this.h.h||this.g.oa()||Fm(this.g)))){this.J||4!=zt||7==p||pu(),pf(this);var _=this.g.Z();this.X=_;t:if(ym(this)){var v=Fm(this.g);u="";var L=v.length,G=4==Br(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){gs(this),_u(this);var ee="";break t}this.h.i=new d.TextDecoder}for(p=0;p<L;p++)this.h.h=!0,u+=this.h.i.decode(v[p],{stream:!(G&&p==L-1)});v.length=0,this.h.g+=u,this.C=0,ee=this.h.g}else ee=this.g.oa();if(this.o=200==_,function qy(u,p,_,v,L,G,ee){u.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+L+"]: "+p+"\n"+_+"\n"+G+" "+ee})}(this.i,this.u,this.A,this.l,this.R,zt,_),this.o){if(this.T&&!this.K){t:{if(this.g){var $e,Vt=this.g;if(($e=Vt.g?Vt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!le($e)){var De=$e;break t}}De=null}if(!(_=De)){this.o=!1,this.s=3,Yt(12),gs(this),_u(this);break e}zo(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mf(this,_)}if(this.P){let Bn;for(_=!0;!this.J&&this.C<ee.length;){if(Bn=jy(this,ee),Bn==df){4==zt&&(this.s=4,Yt(14),_=!1),zo(this.i,this.l,null,"[Incomplete Response]");break}if(Bn==gm){this.s=4,Yt(15),zo(this.i,this.l,ee,"[Invalid Chunk]"),_=!1;break}zo(this.i,this.l,Bn,null),mf(this,Bn)}if(ym(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=zt||0!=ee.length||this.h.h||(this.s=1,Yt(16),_=!1),this.o=this.o&&_,_){if(0<ee.length&&!this.W){this.W=!0;var Gt=this.j;Gt.g==this&&Gt.ba&&!Gt.M&&(Gt.j.info("Great, no buffering proxy detected. Bytes received: "+ee.length),Tf(Gt),Gt.M=!0,Yt(11))}}else zo(this.i,this.l,ee,"[Invalid Chunked Response]"),gs(this),_u(this)}else zo(this.i,this.l,ee,null),mf(this,ee);4==zt&&gs(this),this.o&&!this.J&&(4==zt?Wm(this.j,this):(this.o=!1,dl(this)))}else(function aI(u){const p={};u=(u.g&&2<=Br(u)&&u.g.getAllResponseHeaders()||"").split("\r\n");for(let v=0;v<u.length;v++){if(le(u[v]))continue;var _=D(u[v]);const L=_[0];if("string"!=typeof(_=_[1]))continue;_=_.trim();const G=p[L]||[];p[L]=G,G.push(_)}!function k(u,p){for(const _ in u)p.call(void 0,u[_],_,u)}(p,function(v){return v.join(", ")})})(this.g),400==_&&0<ee.indexOf("Unknown SID")?(this.s=3,Yt(12)):(this.s=0,Yt(13)),gs(this),_u(this)}}}catch{}},mi.prototype.cancel=function(){this.J=!0,gs(this)},mi.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(function Gy(u,p){u.info(function(){return"TIMEOUT: "+p})}(this.i,this.A),2!=this.L&&(pu(),Yt(17)),gs(this),this.s=2,_u(this)):Im(this,this.S-u)},vm.prototype.cancel=function(){if(this.i=wm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const u of this.g.values())u.cancel();this.g.clear()}};var Pm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _s(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof _s){this.h=u.h,fl(this,u.j),this.o=u.o,this.g=u.g,pl(this,u.s),this.l=u.l;var p=u.i,_=new vu;_.i=p.i,p.g&&(_.g=new Map(p.g),_.h=p.h),Sm(this,_),this.m=u.m}else u&&(p=String(u).match(Pm))?(this.h=!1,fl(this,p[1]||"",!0),this.o=yu(p[2]||""),this.g=yu(p[3]||"",!0),pl(this,p[4]),this.l=yu(p[5]||"",!0),Sm(this,p[6]||"",!0),this.m=yu(p[7]||"")):(this.h=!1,this.i=new vu(null,this.h))}function Ur(u){return new _s(u)}function fl(u,p,_){u.j=_?yu(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function pl(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Sm(u,p,_){p instanceof vu?(u.i=p,function eI(u,p){p&&!u.j&&(gi(u),u.i=null,u.g.forEach(function(_,v){var L=v.toLowerCase();v!=L&&(Cm(this,v),Vm(this,L,_))},u)),u.j=p}(u.i,u.h)):(_||(p=Iu(p,Yy)),u.i=new vu(p,u.h))}function tt(u,p,_){u.i.set(p,_)}function ml(u){return tt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function yu(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Iu(u,p,_){return"string"==typeof u?(u=encodeURI(u).replace(p,Qy),_&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Qy(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}_s.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Iu(p,bm,!0),":");var _=this.g;return(_||"file"==p)&&(u.push("//"),(p=this.o)&&u.push(Iu(p,bm,!0),"@"),u.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(_=this.s)&&u.push(":",String(_))),(_=this.l)&&(this.g&&"/"!=_.charAt(0)&&u.push("/"),u.push(Iu(_,"/"==_.charAt(0)?Jy:Hy,!0))),(_=this.i.toString())&&u.push("?",_),(_=this.m)&&u.push("#",Iu(_,Xy)),u.join("")};var u,bm=/[#\/\?@]/g,Hy=/[#\?:]/g,Jy=/[#\?]/g,Yy=/[#\?@]/g,Xy=/#/g;function vu(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function gi(u){u.g||(u.g=new Map,u.h=0,u.i&&function Zy(u,p){if(u){u=u.split("&");for(var _=0;_<u.length;_++){var v=u[_].indexOf("="),L=null;if(0<=v){var G=u[_].substring(0,v);L=u[_].substring(v+1)}else G=u[_];p(G,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}(u.i,function(p,_){u.add(decodeURIComponent(p.replace(/\+/g," ")),_)}))}function Cm(u,p){gi(u),p=jo(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function xm(u,p){return gi(u),p=jo(u,p),u.g.has(p)}function Vm(u,p,_){Cm(u,p),0<_.length&&(u.i=null,u.g.set(jo(u,p),Q(_)),u.h+=_.length)}function jo(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function _i(u,p,_,v,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),v(_)}catch{}}function rI(){this.g=new Uy}function iI(u,p,_){const v=_||"";try{Rm(u,function(L,G){let ee=L;m(L)&&(ee=af(L)),p.push(v+G+"="+encodeURIComponent(ee))})}catch(L){throw p.push(v+"type="+encodeURIComponent("_badmap")),L}}function Tu(u){this.l=u.Ub||null,this.j=u.eb||!1}function gl(u,p){qt.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function km(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}function Eu(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Au(u)}function Au(u){u.onreadystatechange&&u.onreadystatechange.call(u)}function Nm(u){let p="";return Ie(u,function(_,v){p+=v,p+=":",p+=_,p+="\r\n"}),p}function yf(u,p,_){e:{for(v in _){var v=!1;break e}v=!0}v||(_=Nm(_),"string"==typeof u?null!=_&&encodeURIComponent(String(_)):tt(u,p,_))}function dt(u){qt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=vu.prototype).add=function(u,p){gi(this),this.i=null,u=jo(this,u);var _=this.g.get(u);return _||this.g.set(u,_=[]),_.push(p),this.h+=1,this},r.forEach=function(u,p){gi(this),this.g.forEach(function(_,v){_.forEach(function(L){u.call(p,L,v,this)},this)},this)},r.na=function(){gi(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),_=[];for(let v=0;v<p.length;v++){const L=u[v];for(let G=0;G<L.length;G++)_.push(p[v])}return _},r.V=function(u){gi(this);let p=[];if("string"==typeof u)xm(this,u)&&(p=p.concat(this.g.get(jo(this,u))));else{u=Array.from(this.g.values());for(let _=0;_<u.length;_++)p=p.concat(u[_])}return p},r.set=function(u,p){return gi(this),this.i=null,xm(this,u=jo(this,u))&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},r.get=function(u,p){return u&&0<(u=this.V(u)).length?String(u[0]):p},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var _=0;_<p.length;_++){var v=p[_];const G=encodeURIComponent(String(v)),ee=this.V(v);for(v=0;v<ee.length;v++){var L=G;""!==ee[v]&&(L+="="+encodeURIComponent(String(ee[v]))),u.push(L)}}return this.i=u.join("&")},W(Tu,uf),Tu.prototype.g=function(){return new gl(this.l,this.j)},Tu.prototype.i=(u={},function(){return u}),W(gl,qt),(r=gl.prototype).open=function(u,p){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Au(this)},r.send=function(u){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||d).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Eu(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Au(this)),this.g&&(this.readyState=3,Au(this),this.g)))if("arraybuffer"===this.responseType)u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof d.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;km(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Eu(this):Au(this),3==this.readyState&&km(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,Eu(this))},r.Qa=function(u){this.g&&(this.response=u,Eu(this))},r.ga=function(){this.g&&Eu(this)},r.setRequestHeader=function(u,p){this.u.append(u,p)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var _=p.next();!_.done;)u.push((_=_.value)[0]+": "+_[1]),_=p.next();return u.join("\r\n")},Object.defineProperty(gl.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(u){this.m=u?"include":"same-origin"}}),W(dt,qt);var sI=/^https?$/i,oI=["POST","PUT"];function Dm(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Om(u),_l(u)}function Om(u){u.A||(u.A=!0,Jt(u,"complete"),Jt(u,"error"))}function Lm(u){if(u.h&&typeof c<"u"&&(!u.v[1]||4!=Br(u)||2!=u.Z()))if(u.u&&4==Br(u))im(u.Ea,0,u);else if(Jt(u,"readystatechange"),4==Br(u)){u.h=!1;try{const ee=u.Z();e:switch(ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var _;if(!(_=p)){var v;if(v=0===ee){var L=String(u.D).match(Pm)[1]||null;!L&&d.self&&d.self.location&&(L=d.self.location.protocol.slice(0,-1)),v=!sI.test(L?L.toLowerCase():"")}_=v}if(_)Jt(u,"complete"),Jt(u,"success");else{u.m=6;try{var G=2<Br(u)?u.g.statusText:""}catch{G=""}u.l=G+" ["+u.Z()+"]",Om(u)}}finally{_l(u)}}}function _l(u,p){if(u.g){Mm(u);const _=u.g,v=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Jt(u,"ready");try{_.onreadystatechange=v}catch{}}}function Mm(u){u.I&&(d.clearTimeout(u.I),u.I=null)}function Br(u){return u.g?u.g.readyState:0}function Fm(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function wu(u,p,_){return _&&_.internalChannelParams&&_.internalChannelParams[u]||p}function Um(u){this.Aa=0,this.i=[],this.j=new gu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=wu("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=wu("baseRetryDelayMs",5e3,u),this.cb=wu("retryDelaySeedMs",1e4,u),this.Wa=wu("forwardChannelMaxRetries",2,u),this.wa=wu("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new vm(u&&u.concurrentRequestLimit),this.Da=new rI,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function If(u){if(Bm(u),3==u.G){var p=u.U++,_=Ur(u.I);if(tt(_,"SID",u.K),tt(_,"RID",p),tt(_,"TYPE","terminate"),Ru(u,_),(p=new mi(u,u.j,p)).L=2,p.v=ml(Ur(_)),_=!1,d.navigator&&d.navigator.sendBeacon)try{_=d.navigator.sendBeacon(p.v.toString(),"")}catch{}!_&&d.Image&&((new Image).src=p.v,_=!0),_||(p.g=Qm(p.j,null),p.g.ea(p.v)),p.F=Date.now(),dl(p)}$m(u)}function yl(u){u.g&&(Tf(u),u.g.cancel(),u.g=null)}function Bm(u){yl(u),u.u&&(d.clearTimeout(u.u),u.u=null),vl(u),u.h.cancel(),u.s&&("number"==typeof u.s&&d.clearTimeout(u.s),u.s=null)}function Il(u){if(!Tm(u.h)&&!u.s){u.s=!0;var p=u.Ga;uu||Yp(),cu||(uu(),cu=!0),Jd.add(p,u),u.B=0}}function qm(u,p){var _;_=p?p.l:u.U++;const v=Ur(u.I);tt(v,"SID",u.K),tt(v,"RID",_),tt(v,"AID",u.T),Ru(u,v),u.m&&u.o&&yf(v,u.m,u.o),_=new mi(u,u.j,_,u.B+1),null===u.m&&(_.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Gm(u,_,1e3),_.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),_f(u.h,_),ff(_,v,p)}function Ru(u,p){u.H&&Ie(u.H,function(_,v){tt(p,v,_)}),u.l&&Rm({},function(_,v){tt(p,v,_)})}function Gm(u,p,_){_=Math.min(u.i.length,_);var v=u.l?R(u.l.Na,u.l,u):null;e:{var L=u.i;let G=-1;for(;;){const ee=["count="+_];-1==G?0<_?(G=L[0].g,ee.push("ofs="+G)):G=0:ee.push("ofs="+G);let $e=!0;for(let Vt=0;Vt<_;Vt++){let De=L[Vt].g;const Gt=L[Vt].map;if(De-=G,0>De)G=Math.max(0,L[Vt].g-100),$e=!1;else try{iI(Gt,ee,"req"+De+"_")}catch{v&&v(Gt)}}if($e){v=ee.join("&");break e}}}return u=u.i.splice(0,_),p.D=u,v}function zm(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;uu||Yp(),cu||(uu(),cu=!0),Jd.add(p,u),u.v=0}}function vf(u){return!(u.g||u.u||3<=u.v||(u.Y++,u.u=mu(R(u.Fa,u),Km(u,u.v)),u.v++,0))}function Tf(u){null!=u.A&&(d.clearTimeout(u.A),u.A=null)}function jm(u){u.g=new mi(u,u.j,"rpc",u.Y),null===u.m&&(u.g.H=u.o),u.g.O=0;var p=Ur(u.qa);tt(p,"RID","rpc"),tt(p,"SID",u.K),tt(p,"AID",u.T),tt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&tt(p,"TO",u.ja),tt(p,"TYPE","xmlhttp"),Ru(u,p),u.m&&u.o&&yf(p,u.m,u.o),u.L&&(u.g.I=u.L);var _=u.g;u=u.ia,_.L=1,_.v=ml(Ur(p)),_.m=null,_.P=!0,_m(_,u)}function vl(u){null!=u.C&&(d.clearTimeout(u.C),u.C=null)}function Wm(u,p){var _=null;if(u.g==p){vl(u),Tf(u),u.g=null;var v=2}else{if(!gf(u.h,p))return;_=p.D,Am(u.h,p),v=1}if(0!=u.G)if(p.o)if(1==v){_=p.m?p.m.length:0,p=Date.now()-p.F;var L=u.B;Jt(v=cl(),new fm(v,_)),Il(u)}else zm(u);else if(3==(L=p.s)||0==L&&0<p.X||!(1==v&&function uI(u,p){return!(Em(u.h)>=u.h.j-(u.s?1:0)||(u.s?(u.i=p.D.concat(u.i),0):1==u.G||2==u.G||u.B>=(u.Va?0:u.Wa)||(u.s=mu(R(u.Ga,u,p),Km(u,u.B)),u.B++,0)))}(u,p)||2==v&&vf(u)))switch(_&&0<_.length&&(p=u.h,p.i=p.i.concat(_)),L){case 1:ys(u,5);break;case 4:ys(u,10);break;case 3:ys(u,6);break;default:ys(u,2)}}function Km(u,p){let _=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(_*=2),_*p}function ys(u,p){if(u.j.info("Error code "+p),2==p){var _=R(u.fb,u),v=u.Xa;const L=!v;v=new _s(v||"//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||fl(v,"https"),ml(v),L?function tI(u,p){const _=new gu;if(d.Image){const v=new Image;v.onload=O(_i,_,"TestLoadImage: loaded",!0,p,v),v.onerror=O(_i,_,"TestLoadImage: error",!1,p,v),v.onabort=O(_i,_,"TestLoadImage: abort",!1,p,v),v.ontimeout=O(_i,_,"TestLoadImage: timeout",!1,p,v),d.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=u}else p(!1)}(v.toString(),_):function nI(u,p){new gu;const v=new AbortController,L=setTimeout(()=>{v.abort(),_i(0,0,!1,p)},1e4);fetch(u,{signal:v.signal}).then(G=>{clearTimeout(L),_i(0,0,!!G.ok,p)}).catch(()=>{clearTimeout(L),_i(0,0,!1,p)})}(v.toString(),_)}else Yt(2);u.G=0,u.l&&u.l.sa(p),$m(u),Bm(u)}function $m(u){if(u.G=0,u.ka=[],u.l){const p=wm(u.h);(0!=p.length||0!=u.i.length)&&(Z(u.ka,p),Z(u.ka,u.i),u.h.i.length=0,Q(u.i),u.i.length=0),u.l.ra()}}function Zm(u,p,_){var v=_ instanceof _s?Ur(_):new _s(_);if(""!=v.g)p&&(v.g=p+"."+v.g),pl(v,v.s);else{var L=d.location;v=L.protocol,p=p?p+"."+L.hostname:L.hostname,L=+L.port;var G=new _s(null);v&&fl(G,v),p&&(G.g=p),L&&pl(G,L),_&&(G.l=_),v=G}return p=u.ya,(_=u.D)&&p&&tt(v,_,p),tt(v,"VER",u.la),Ru(u,v),v}function Qm(u,p,_){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return(p=new dt(u.Ca&&!u.pa?new Tu({eb:_}):u.pa)).Ha(u.J),p}function Hm(){}function Tl(){}function hn(u,p){qt.call(this),this.g=new Um(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!le(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!le(p)&&(this.g.D=p,null!==(u=this.h)&&p in u&&p in(u=this.h)&&delete u[p]),this.j=new Wo(this)}function Jm(u){cf.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const _ in p){u=_;break e}u=void 0}(this.i=u)&&(u=this.i,p=null!==p&&u in p?p[u]:void 0),this.data=p}else this.data=u}function Ym(){lf.call(this),this.status=1}function Wo(u){this.g=u}(r=dt.prototype).Ha=function(u){this.J=u},r.ea=function(u,p,_,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():hf.g(),this.v=function um(u){return u.h||(u.h=u.i())}(this.o?this.o:hf),this.g.onreadystatechange=R(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(G){return void Dm(this,G)}if(u=_||"",_=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var L in v)_.set(L,v[L]);else{if("function"!=typeof v.keys||"function"!=typeof v.get)throw Error("Unknown input type for opt_headers: "+String(v));for(const G of v.keys())_.set(G,v.get(G))}v=Array.from(_.keys()).find(G=>"content-type"==G.toLowerCase()),L=d.FormData&&u instanceof d.FormData,!(0<=Array.prototype.indexOf.call(oI,p,void 0))||v||L||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,ee]of _)this.g.setRequestHeader(G,ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Mm(this),this.u=!0,this.g.send(u),this.u=!1}catch(G){Dm(this,G)}},r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Jt(this,"complete"),Jt(this,"abort"),_l(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_l(this,!0)),dt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Lm(this):this.bb())},r.bb=function(){Lm(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Br(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&0==p.indexOf(u)&&(p=p.substring(u.length)),Fy(p)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Um.prototype).la=8,r.G=1,r.connect=function(u,p,_,v){Yt(0),this.W=u,this.H=p||{},_&&void 0!==v&&(this.H.OSID=_,this.H.OAID=v),this.F=this.X,this.I=Zm(this,null,this.W),Il(this)},r.Ga=function(u){if(this.s)if(this.s=null,1==this.G){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const L=new mi(this,this.j,u);let G=this.o;if(this.S&&(G?(G=E(G),N(G,this.S)):G=this.S),null!==this.m||this.O||(L.H=G,G=null),this.P)e:{for(var p=0,_=0;_<this.i.length;_++){var v=this.i[_];if(void 0===(v="__data__"in v.map&&"string"==typeof(v=v.map.__data__)?v.length:void 0))break;if(4096<(p+=v)){p=_;break e}if(4096===p||_===this.i.length-1){p=_+1;break e}}p=1e3}else p=1e3;p=Gm(this,L,p),tt(_=Ur(this.I),"RID",u),tt(_,"CVER",22),this.D&&tt(_,"X-HTTP-Session-Id",this.D),Ru(this,_),G&&(this.O?p="headers="+encodeURIComponent(String(Nm(G)))+"&"+p:this.m&&yf(_,this.m,G)),_f(this.h,L),this.Ua&&tt(_,"TYPE","init"),this.P?(tt(_,"$req",p),tt(_,"SID","null"),L.T=!0,ff(L,_,null)):ff(L,_,p),this.G=2}}else 3==this.G&&(u?qm(this,u):0==this.i.length||Tm(this.h)||qm(this))},r.Fa=function(){if(this.u=null,jm(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=mu(R(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Yt(10),yl(this),jm(this))},r.Za=function(){null!=this.C&&(this.C=null,yl(this),vf(this),Yt(19))},r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Yt(2)):(this.j.info("Failed to ping google.com"),Yt(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Hm.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Tl.prototype.g=function(u,p){return new hn(u,p)},W(hn,qt),hn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hn.prototype.close=function(){If(this.g)},hn.prototype.o=function(u){var p=this.g;if("string"==typeof u){var _={};_.__data__=u,u=_}else this.u&&((_={}).__data__=af(u),u=_);p.i.push(new class{constructor(u,p){this.g=u,this.map=p}}(p.Ya++,u)),3==p.G&&Il(p)},hn.prototype.N=function(){this.g.l=null,delete this.j,If(this.g),delete this.g,hn.aa.N.call(this)},W(Jm,cf),W(Ym,lf),W(Wo,Hm),Wo.prototype.ua=function(){Jt(this.g,"a")},Wo.prototype.ta=function(u){Jt(this.g,new Jm(u))},Wo.prototype.sa=function(u){Jt(this.g,new Ym)},Wo.prototype.ra=function(){Jt(this.g,"b")},Tl.prototype.createWebChannel=Tl.prototype.g,hn.prototype.send=hn.prototype.o,hn.prototype.open=hn.prototype.m,hn.prototype.close=hn.prototype.close,Se=Ue.createWebChannelTransport=function(){return new Tl},Dt=Ue.getStatEventTarget=function(){return cl()},fn=Ue.Event=ms,ft=Ue.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ll.NO_ERROR=0,ll.TIMEOUT=8,ll.HTTP_ERROR=6,_t=Ue.ErrorCode=ll,pm.COMPLETE="complete",Kt=Ue.EventType=pm,cm.EventType=fu,fu.OPEN="a",fu.CLOSE="b",fu.ERROR="c",fu.MESSAGE="d",qt.prototype.listen=qt.prototype.K,Et=Ue.WebChannel=cm,Ct=Ue.FetchXmlHttpFactory=Tu,dt.prototype.listenOnce=dt.prototype.L,dt.prototype.getLastError=dt.prototype.Ka,dt.prototype.getLastErrorCode=dt.prototype.Ba,dt.prototype.getStatus=dt.prototype.Z,dt.prototype.getResponseJson=dt.prototype.Oa,dt.prototype.getResponseText=dt.prototype.oa,dt.prototype.send=dt.prototype.ea,dt.prototype.setWithCredentials=dt.prototype.Ha,sn=Ue.XhrIo=dt}).apply(typeof Wt<"u"?Wt:typeof self<"u"?self:typeof window<"u"?window:{});const be="@firebase/firestore";class Le{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Le.UNAUTHENTICATED=new Le(null),Le.GOOGLE_CREDENTIALS=new Le("google-credentials-uid"),Le.FIRST_PARTY=new Le("first-party-uid"),Le.MOCK_USER=new Le("mock-user");let on="10.13.0";const Ot=new Pe.Yd("@firebase/firestore");function pt(){return Ot.logLevel}function K(r,...e){if(Ot.logLevel<=Pe.in.DEBUG){const t=e.map(xe);Ot.debug(`Firestore (${on}): ${r}`,...t)}}function Ge(r,...e){if(Ot.logLevel<=Pe.in.ERROR){const t=e.map(xe);Ot.error(`Firestore (${on}): ${r}`,...t)}}function ot(r,...e){if(Ot.logLevel<=Pe.in.WARN){const t=e.map(xe);Ot.warn(`Firestore (${on}): ${r}`,...t)}}function xe(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function Y(r="Unexpected state"){const e=`FIRESTORE (${on}) INTERNAL ASSERTION FAILED: `+r;throw Ge(e),new Error(e)}function ne(r,e){r||Y()}function J(r,e){return r}const U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class j extends ge.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Be{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ii{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Le.UNAUTHENTICATED))}shutdown(){}}class Ti{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class _r{constructor(e){this.t=e,this.currentUser=Le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let c=new Be;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new Be,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const m=c;e.enqueueRetryable((0,q.Z)(function*(){yield m.promise,yield s(n.currentUser)}))},f=m=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new Be)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ne("string"==typeof n.accessToken),new Ii(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ne(null===e||"string"==typeof e),new Le(e)}}class vs{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Le.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Gr{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new vs(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Le.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qn{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Cn{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const c=s.token!==this.R;return this.R=s.token,K("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ne("string"==typeof t.token),this.R=t.token,new qn(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ei(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class zr{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Ei(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function he(r,e){return r<e?-1:r>e?1:0}function pn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Ke(r){return r+"\0"}class Ve{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new j(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new j(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new j(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new j(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ve.fromMillis(Date.now())}static fromDate(e){return Ve.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ve(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?he(this.nanoseconds,e.nanoseconds):he(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ue{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ue(e)}static min(){return new ue(new Ve(0,0))}static max(){return new ue(new Ve(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class yr{constructor(e,t,n){void 0===t?t=0:t>e.length&&Y(),void 0===n?n=e.length-t:n>e.length-t&&Y(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===yr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yr?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),c=t.get(i);if(s<c)return-1;if(s>c)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class fe extends yr{construct(e,t,n){return new fe(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new j(U.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new fe(t)}static emptyPath(){return new fe([])}}const un=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ke extends yr{construct(e,t,n){return new ke(e,t,n)}static isValidIdentifier(e){return un.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ke(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new j(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let c=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new j(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new j(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,i+=2}else"`"===d?(c=!c,i++):"."!==d||c?(n+=d,i++):(s(),i++)}if(s(),c)throw new j(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ke(t)}static emptyPath(){return new ke([])}}class X{constructor(e){this.path=e}static fromPath(e){return new X(fe.fromString(e))}static fromName(e){return new X(fe.fromString(e).popFirst(5))}static empty(){return new X(fe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===fe.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return fe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new X(new fe(e.slice()))}}class mn{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Ir(r){return r.fields.find(e=>2===e.kind)}function gn(r){return r.fields.filter(e=>2!==e.kind)}mn.UNKNOWN_ID=-1;class cn{constructor(e,t){this.fieldPath=e,this.kind=t}}class B{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new B(0,z.min())}}function x(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ue.fromTimestamp(1e9===n?new Ve(t+1,0):new Ve(t,n));return new z(i,X.empty(),e)}function P(r){return new z(r.readTime,r.key,-1)}class z{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new z(ue.min(),X.empty(),-1)}static max(){return new z(ue.max(),X.empty(),-1)}}function te(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=X.comparator(r.documentKey,e.documentKey),0!==t?t:he(r.largestBatchId,e.largestBatchId))}const de="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ce{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Te(r){return He.apply(this,arguments)}function He(){return(He=(0,q.Z)(function*(r){if(r.code!==U.FAILED_PRECONDITION||r.message!==de)throw r;K("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,n)=>{t(e)})}static reject(e){return new V((t,n)=>{n(e)})}static waitFor(e){return new V((t,n)=>{let i=0,s=0,c=!1;e.forEach(d=>{++i,d.next(()=>{++s,c&&s===i&&t()},f=>n(f))}),c=!0,s===i&&t()})}static or(e){let t=V.resolve(!1);for(const n of e)t=t.next(i=>i?V.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new V((n,i)=>{const s=e.length,c=new Array(s);let d=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(y=>{c[m]=y,++d,d===s&&n(c)},y=>i(y))}})}static doWhile(e,t){return new V((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class At{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Be,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new jr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=Ho(n.target.error);this.V.reject(new jr(e,i))}}static open(e,t,n,i){try{return new At(t,e.transaction(i,n))}catch(s){throw new jr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(K("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Su(t)}}class _e{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===_e.S((0,ge.z$)())&&Ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return K("SimpleDb","Removing database:",e),Gn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ge.hl)())return!1;if(_e.v())return!0;const e=(0,ge.z$)(),t=_e.S(e),n=0<t&&t<10,i=Xt(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,q.Z)(function*(){return t.db||(K("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=c=>{n(c.target.result)},s.onblocked=()=>{i(new jr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=c=>{const d=c.target.error;i("VersionError"===d.name?new j(U.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new j(U.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new jr(e,d))},s.onupgradeneeded=c=>{K("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',c.oldVersion),t.p.O(c.target.result,s.transaction,c.oldVersion,t.version).next(()=>{K("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,q.Z)(function*(){const c="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.M(e);const f=At.open(s.db,e,c?"readonly":"readwrite",n),m=i(f).next(y=>(f.g(),y)).catch(y=>(f.abort(y),V.reject(y))).toPromise();return m.catch(()=>{}),yield f.m,m}catch(f){const m=f,y="FirebaseError"!==m.name&&d<3;if(K("SimpleDb","Transaction failed with error:",m.message,"Retrying:",y),s.close(),!y)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Xt(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class Ai{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Gn(this.B.delete())}}class jr extends j{constructor(e,t){super(U.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function _n(r){return"IndexedDbTransactionError"===r.name}class Su{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(K("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(K("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Gn(n)}add(e){return K("SimpleDb","ADD",this.store.name,e,e),Gn(this.store.add(e))}get(e){return Gn(this.store.get(e)).next(t=>(void 0===t&&(t=null),K("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return K("SimpleDb","DELETE",this.store.name,e),Gn(this.store.delete(e))}count(){return K("SimpleDb","COUNT",this.store.name),Gn(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new V((c,d)=>{s.onerror=f=>{d(f.target.error)},s.onsuccess=f=>{c(f.target.result)}})}{const s=this.cursor(n),c=[];return this.W(s,(d,f)=>{c.push(f)}).next(()=>c)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new V((i,s)=>{n.onerror=c=>{s(c.target.error)},n.onsuccess=c=>{i(c.target.result)}})}j(e,t){K("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,c,d)=>d.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new V((n,i)=>{t.onerror=s=>{const c=Ho(s.target.error);i(c)},t.onsuccess=s=>{const c=s.target.result;c?e(c.primaryKey,c.value).next(d=>{d?c.continue():n()}):n()}})}W(e,t){const n=[];return new V((i,s)=>{e.onerror=c=>{s(c.target.error)},e.onsuccess=c=>{const d=c.target.result;if(!d)return void i();const f=new Ai(d),m=t(d.primaryKey,d.value,f);if(m instanceof V){const y=m.catch(T=>(f.done(),V.reject(T)));n.push(y)}f.isDone?i():null===f.K?d.continue():d.continue(f.K)}}).next(()=>V.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Gn(r){return new V((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=Ho(n.target.error);t(i)}})}let wi=!1;function Ho(r){const e=_e.S((0,ge.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new j("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wi||(wi=!0,setTimeout(()=>{throw n},0)),n}}return r}class Al{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;K("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,q.Z)(function*(){t.task=null;try{K("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){_n(n)?K("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Te(n)}yield t.X(6e4)}))}}class wl{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,q.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return V.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(c=>{if(null!==c&&!n.has(c))return K("IndexBackfiller",`Processing collection: ${c}`),this.ne(e,c,i).next(d=>{i-=d,n.add(c)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const c=s.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next(()=>this.re(i,s)).next(d=>(K("IndexBackfiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>c.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const c=P(s);te(c,n)>0&&(n=c)}),new z(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Lt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Wr(r){return null==r}function Ri(r){return 0===r&&1/r==-1/0}function bu(r){return"number"==typeof r&&Number.isInteger(r)&&!Ri(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function yt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Cu(e)),e=Rl(r.get(t),e);return Cu(e)}function Rl(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Cu(r){return r+"\x01\x01"}function yn(r){const e=r.length;if(ne(e>=2),2===e)return ne("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),fe.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const c=r.indexOf("\x01",s);switch((c<0||c>t)&&Y(),r.charAt(c+1)){case"\x01":const d=r.substring(s,c);let f;0===i.length?f=d:(i+=d,f=i,i=""),n.push(f);break;case"\x10":i+=r.substring(s,c),i+="\0";break;case"\x11":i+=r.substring(s,c+1);break;default:Y()}s=c+2}return new fe(n)}const Je=["userId","batchId"];function Pi(r,e){return[r,yt(e)]}function Kr(r,e,t){return[r,yt(e),t]}const Pl={},Jo=["prefixPath","collectionGroup","readTime","documentId"],Sl=["prefixPath","collectionGroup","documentId"],bl=["collectionGroup","readTime","prefixPath","documentId"],Cl=["canonicalId","targetId"],xu=["targetId","path"],xl=["path","targetId"],Vl=["collectionId","parent"],Vu=["indexId","uid"],ku=["uid","sequenceNumber"],Yo=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Si=["indexId","uid","orderedDocumentKey"],Xo=["userId","collectionPath","documentId"],kl=["userId","collectionPath","largestBatchId"],ea=["userId","collectionGroup","largestBatchId"],Nu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Nl=[...Nu,"documentOverlays"],ta=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],na=ta,ra=[...na,"indexConfiguration","indexState","indexEntries"],Du=ra,Dl=[...ra,"globals"];class zn extends Ce{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ht(r,e){const t=J(r);return _e.F(t._e,e)}function Ts(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function jn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ou(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Me{constructor(e,t){this.comparator=e,this.root=t||mt.EMPTY}insert(e,t){return new Me(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(e){return new Me(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new As(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new As(this.root,e,this.comparator,!1)}getReverseIterator(){return new As(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new As(this.root,e,this.comparator,!0)}}class As{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mt{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??mt.RED,this.left=i??mt.EMPTY,this.right=s??mt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new mt(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return mt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return mt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,mt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,mt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Y();const e=this.left.check();if(e!==this.right.check())throw Y();return e+(this.isRed()?0:1)}}mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1,mt.EMPTY=new class{constructor(){this.size=0}get key(){throw Y()}get value(){throw Y()}get color(){throw Y()}get left(){throw Y()}get right(){throw Y()}copy(e,t,n,i,s){return this}insert(e,t,n){return new mt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fe{constructor(e){this.comparator=e,this.data=new Me(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ws(this.data.getIterator())}getIteratorFrom(e){return new ws(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Fe)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Fe(this.comparator);return t.data=e,t}}class ws{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function xn(r){return r.hasNext()?r.getNext():void 0}class wt{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new wt([])}unionWith(e){let t=new Fe(ke.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new wt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Lu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Lu("Invalid base64 string: "+s):s}}(e);return new nt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let c=0;c<i.length;++c)s+=String.fromCharCode(i[c]);return s}(e);return new nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return he(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nt.EMPTY_BYTE_STRING=new nt("");const sa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vn(r){if(ne(!!r),"string"==typeof r){let e=0;const t=sa.exec(r);if(ne(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ze(r.seconds),nanos:ze(r.nanos)}}function ze(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function kn(r){return"string"==typeof r?nt.fromBase64String(r):nt.fromUint8Array(r)}function $r(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Rs(r){const e=r.mapValue.fields.__previous_value__;return $r(e)?Rs(e):e}function vr(r){const e=Vn(r.mapValue.fields.__local_write_time__.timestampValue);return new Ve(e.seconds,e.nanos)}class Ol{constructor(e,t,n,i,s,c,d,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=c,this.autoDetectLongPolling=d,this.longPollingOptions=f,this.useFetchStreams=m}}class In{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new In("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof In&&e.projectId===this.projectId&&e.database===this.database}}const en={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},tn={nullValue:"NULL_VALUE"};function vn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?$r(r)?4:Cs(r)?9007199254740991:Zn(r)?10:11:Y()}function Tn(r,e){if(r===e)return!0;const t=vn(r);if(t!==vn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return vr(r).isEqual(vr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const c=Vn(i.timestampValue),d=Vn(s.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,kn(r.bytesValue).isEqual(kn(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ze(i.geoPointValue.latitude)===ze(s.geoPointValue.latitude)&&ze(i.geoPointValue.longitude)===ze(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ze(i.integerValue)===ze(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const c=ze(i.doubleValue),d=ze(s.doubleValue);return c===d?Ri(c)===Ri(d):isNaN(c)&&isNaN(d)}return!1}(r,e);case 9:return pn(r.arrayValue.values||[],e.arrayValue.values||[],Tn);case 10:case 11:return function(i,s){const c=i.mapValue.fields||{},d=s.mapValue.fields||{};if(Ts(c)!==Ts(d))return!1;for(const f in c)if(c.hasOwnProperty(f)&&(void 0===d[f]||!Tn(c[f],d[f])))return!1;return!0}(r,e);default:return Y()}var s}function Mt(r,e){return void 0!==(r.values||[]).find(t=>Tn(t,e))}function Wn(r,e){if(r===e)return 0;const t=vn(r),n=vn(e);if(t!==n)return he(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return he(r.booleanValue,e.booleanValue);case 2:return function(s,c){const d=ze(s.integerValue||s.doubleValue),f=ze(c.integerValue||c.doubleValue);return d<f?-1:d>f?1:d===f?0:isNaN(d)?isNaN(f)?0:-1:1}(r,e);case 3:return Ps(r.timestampValue,e.timestampValue);case 4:return Ps(vr(r),vr(e));case 5:return he(r.stringValue,e.stringValue);case 6:return function(s,c){const d=kn(s),f=kn(c);return d.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(s,c){const d=s.split("/"),f=c.split("/");for(let m=0;m<d.length&&m<f.length;m++){const y=he(d[m],f[m]);if(0!==y)return y}return he(d.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,c){const d=he(ze(s.latitude),ze(c.latitude));return 0!==d?d:he(ze(s.longitude),ze(c.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Mu(r.arrayValue,e.arrayValue);case 10:return function(s,c){var d,f,m,y;const O=null===(d=(s.fields||{}).value)||void 0===d?void 0:d.arrayValue,W=null===(f=(c.fields||{}).value)||void 0===f?void 0:f.arrayValue,Q=he((null===(m=O?.values)||void 0===m?void 0:m.length)||0,(null===(y=W?.values)||void 0===y?void 0:y.length)||0);return 0!==Q?Q:Mu(O,W)}(r.mapValue,e.mapValue);case 11:return function(s,c){if(s===en.mapValue&&c===en.mapValue)return 0;if(s===en.mapValue)return 1;if(c===en.mapValue)return-1;const d=s.fields||{},f=Object.keys(d),m=c.fields||{},y=Object.keys(m);f.sort(),y.sort();for(let T=0;T<f.length&&T<y.length;++T){const R=he(f[T],y[T]);if(0!==R)return R;const O=Wn(d[f[T]],m[y[T]]);if(0!==O)return O}return he(f.length,y.length)}(r.mapValue,e.mapValue);default:throw Y()}}function Ps(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return he(r,e);const t=Vn(r),n=Vn(e),i=he(t.seconds,n.seconds);return 0!==i?i:he(t.nanos,n.nanos)}function Mu(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Wn(t[i],n[i]);if(s)return s}return he(t.length,n.length)}function Kn(r){return oa(r)}function oa(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Vn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?kn(r.bytesValue).toBase64():"referenceValue"in r?X.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=oa(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const c of n)s?s=!1:i+=",",i+=`${c}:${oa(t.fields[c])}`;return i+"}"}(r.mapValue):Y()}function Tr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function aa(r){return!!r&&"integerValue"in r}function Er(r){return!!r&&"arrayValue"in r}function $n(r){return!!r&&"nullValue"in r}function Fu(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ss(r){return!!r&&"mapValue"in r}function Zn(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function bs(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return jn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=bs(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=bs(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Cs(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const En={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Qr(r){return"nullValue"in r?tn:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Tr(In.empty(),X.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Zn(r)?En:{mapValue:{}}:Y()}function bi(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Tr(In.empty(),X.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?En:"mapValue"in r?Zn(r)?{mapValue:{}}:en:Y()}function Uu(r,e){const t=Wn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Bu(r,e){const t=Wn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class vt{constructor(e){this.value=e}static empty(){return new vt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ss(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bs(t)}setAll(e){let t=ke.emptyPath(),n={},i=[];e.forEach((c,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,n,i),n={},i=[],t=d.popLast()}c?n[d.lastSegment()]=bs(c):i.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Ss(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ss(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){jn(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new vt(bs(this.value))}}function qu(r){const e=[];return jn(r.fields,(t,n)=>{const i=new ke([t]);if(Ss(n)){const s=qu(n.mapValue).fields;if(0===s.length)e.push(i);else for(const c of s)e.push(i.child(c))}else e.push(i)}),new wt(e)}class Ne{constructor(e,t,n,i,s,c,d){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=c,this.documentState=d}static newInvalidDocument(e){return new Ne(e,0,ue.min(),ue.min(),ue.min(),vt.empty(),0)}static newFoundDocument(e,t,n,i){return new Ne(e,1,t,ue.min(),n,i,0)}static newNoDocument(e,t){return new Ne(e,2,t,ue.min(),ue.min(),vt.empty(),0)}static newUnknownDocument(e,t){return new Ne(e,3,t,ue.min(),ue.min(),vt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Qn{constructor(e,t){this.position=e,this.inclusive=t}}function Ci(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],c=r.position[i];if(n=s.field.isKeyField()?X.comparator(X.fromName(c.referenceValue),t.key):Wn(c,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Gu(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Tn(r.position[t],e.position[t]))return!1;return!0}class Hr{constructor(e,t="asc"){this.field=e,this.dir=t}}function ua(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class $t{}class Ee extends $t{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ds(e,t,n):"array-contains"===t?new ju(e,n):"in"===t?new Ls(e,n):"not-in"===t?new Ms(e,n):"array-contains-any"===t?new da(e,n):new Ee(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ha(e,n):new zu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Wn(t,this.value)):null!==t&&vn(this.value)===vn(t)&&this.matchesComparison(Wn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Y()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Oe extends $t{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Oe(e,t)}matches(e){return Hn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Hn(r){return"and"===r.op}function Jr(r){return"or"===r.op}function xs(r){return ca(r)&&Hn(r)}function ca(r){for(const e of r.filters)if(e instanceof Oe)return!1;return!0}function la(r){if(r instanceof Ee)return r.field.canonicalString()+r.op.toString()+Kn(r.value);if(xs(r))return r.filters.map(e=>la(e)).join(",");{const e=r.filters.map(t=>la(t)).join(",");return`${r.op}(${e})`}}function Vs(r,e){return r instanceof Ee?(n=r,(i=e)instanceof Ee&&n.op===i.op&&n.field.isEqual(i.field)&&Tn(n.value,i.value)):r instanceof Oe?function(n,i){return i instanceof Oe&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,c,d)=>s&&Vs(c,i.filters[d]),!0)}(r,e):void Y();var n,i}function ks(r,e){const t=r.filters.concat(e);return Oe.create(t,r.op)}function Ns(r){return r instanceof Ee?`${(t=r).field.canonicalString()} ${t.op} ${Kn(t.value)}`:r instanceof Oe?function(t){return t.op.toString()+" {"+t.getFilters().map(Ns).join(" ,")+"}"}(r):"Filter";var t}class Ds extends Ee{constructor(e,t,n){super(e,t,n),this.key=X.fromName(n.referenceValue)}matches(e){const t=X.comparator(e.key,this.key);return this.matchesComparison(t)}}class ha extends Ee{constructor(e,t){super(e,"in",t),this.keys=Os(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class zu extends Ee{constructor(e,t){super(e,"not-in",t),this.keys=Os(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Os(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>X.fromName(n.referenceValue))}class ju extends Ee{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Er(t)&&Mt(t.arrayValue,this.value)}}class Ls extends Ee{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Mt(this.value.arrayValue,t)}}class Ms extends Ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(Mt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Mt(this.value.arrayValue,t)}}class da extends Ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Er(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Mt(this.value.arrayValue,n))}}class Wu{constructor(e,t=null,n=[],i=[],s=null,c=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=c,this.endAt=d,this.ue=null}}function xi(r,e=null,t=[],n=[],i=null,s=null,c=null){return new Wu(r,e,t,n,i,s,c)}function Jn(r){const e=J(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>la(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),Wr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Kn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Kn(n)).join(",")),e.ue=t}return e.ue}function Ar(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!ua(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Vs(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Gu(r.startAt,e.startAt)&&Gu(r.endAt,e.endAt)}function Fs(r){return X.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function Yr(r,e){return r.filters.filter(t=>t instanceof Ee&&t.field.isEqual(e))}function Ku(r,e,t){let n=tn,i=!0;for(const s of Yr(r,e)){let c=tn,d=!0;switch(s.op){case"<":case"<=":c=Qr(s.value);break;case"==":case"in":case">=":c=s.value;break;case">":c=s.value,d=!1;break;case"!=":case"not-in":c=tn}Uu({value:n,inclusive:i},{value:c,inclusive:d})<0&&(n=c,i=d)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const c=t.position[s];Uu({value:n,inclusive:i},{value:c,inclusive:t.inclusive})<0&&(n=c,i=t.inclusive);break}return{value:n,inclusive:i}}function Us(r,e,t){let n=en,i=!0;for(const s of Yr(r,e)){let c=en,d=!0;switch(s.op){case">=":case">":c=bi(s.value),d=!1;break;case"==":case"in":case"<=":c=s.value;break;case"<":c=s.value,d=!1;break;case"!=":case"not-in":c=en}Bu({value:n,inclusive:i},{value:c,inclusive:d})>0&&(n=c,i=d)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const c=t.position[s];Bu({value:n,inclusive:i},{value:c,inclusive:t.inclusive})>0&&(n=c,i=t.inclusive);break}return{value:n,inclusive:i}}class Zt{constructor(e,t=null,n=[],i=[],s=null,c="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=c,this.startAt=d,this.endAt=f,this.ce=null,this.le=null,this.he=null}}function Bs(r,e,t,n,i,s,c,d){return new Zt(r,e,t,n,i,s,c,d)}function Yn(r){return new Zt(r)}function Vi(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function ki(r){return null!==r.collectionGroup}function Xn(r){const e=J(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let d=new Fe(ke.comparator);return c.filters.forEach(f=>{f.getFlattenedFilters().forEach(m=>{m.isInequality()&&(d=d.add(m.field))})}),d})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Hr(s,n))}),t.has(ke.keyField().canonicalString())||e.ce.push(new Hr(ke.keyField(),n))}return e.ce}function Rt(r){const e=J(r);return e.le||(e.le=function $u(r,e){if("F"===r.limitType)return xi(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Hr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Qn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Qn(r.startAt.position,r.startAt.inclusive):null;return xi(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Xn(r))),e.le}function Ni(r,e){const t=r.filters.concat([e]);return new Zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Gs(r,e,t){return new Zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function wr(r,e){return Ar(Rt(r),Rt(e))&&r.limitType===e.limitType}function fa(r){return`${Jn(Rt(r))}|lt:${r.limitType}`}function er(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Ns(i)).join(", ")}]`),Wr(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(c=i).field.canonicalString()} (${c.dir})`;var c}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Kn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Kn(i)).join(",")),`Target(${n})`}(Rt(r))}; limitType=${r.limitType})`}function Di(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):X.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Xn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(c,d,f){const m=Ci(c,d,f);return c.inclusive?m<=0:m<0}(n.startAt,Xn(n),i)||n.endAt&&!function(c,d,f){const m=Ci(c,d,f);return c.inclusive?m>=0:m>0}(n.endAt,Xn(n),i)));var n,i}function zs(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Zu(r){return(e,t)=>{let n=!1;for(const i of Xn(r)){const s=pa(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function pa(r,e,t){const n=r.field.isKeyField()?X.comparator(e.key,t.key):function(s,c,d){const f=c.data.field(s),m=d.data.field(s);return null!==f&&null!==m?Wn(f,m):Y()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Y()}}class Nn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){jn(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return Ou(this.inner)}size(){return this.innerSize}}const Ll=new Me(X.comparator);function Pt(){return Ll}const Qu=new Me(X.comparator);function Oi(...r){let e=Qu;for(const t of r)e=e.insert(t.key,t);return e}function js(r){let e=Qu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function An(){return Li()}function Ws(){return Li()}function Li(){return new Nn(r=>r.toString(),(r,e)=>r.isEqual(e))}const ma=new Me(X.comparator),Ml=new Fe(X.comparator);function me(...r){let e=Ml;for(const t of r)e=e.add(t);return e}const Fl=new Fe(he);function Mi(){return Fl}function ga(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ri(e)?"-0":e}}function Ks(r){return{integerValue:""+r}}function Hu(r,e){return bu(e)?Ks(e):ga(r,e)}class Xr{constructor(){this._=void 0}}function Ul(r,e,t){return r instanceof tr?function(i,s){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&$r(s)&&(s=Rs(s)),s&&(c.fields.__previous_value__=s),{mapValue:c}}(t,e):r instanceof Rr?Pr(r,e):r instanceof nr?Ju(r,e):function(i,s){const c=_a(i,s),d=Yu(c)+Yu(i.Pe);return aa(c)&&aa(i.Pe)?Ks(d):ga(i.serializer,d)}(r,e)}function Bl(r,e,t){return r instanceof Rr?Pr(r,e):r instanceof nr?Ju(r,e):t}function _a(r,e){return r instanceof ei?aa(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class tr extends Xr{}class Rr extends Xr{constructor(e){super(),this.elements=e}}function Pr(r,e){const t=Xu(e);for(const n of r.elements)t.some(i=>Tn(i,n))||t.push(n);return{arrayValue:{values:t}}}class nr extends Xr{constructor(e){super(),this.elements=e}}function Ju(r,e){let t=Xu(e);for(const n of r.elements)t=t.filter(i=>!Tn(i,n));return{arrayValue:{values:t}}}class ei extends Xr{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Yu(r){return ze(r.integerValue||r.doubleValue)}function Xu(r){return Er(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Fi{constructor(e,t){this.field=e,this.transform=t}}class wf{constructor(e,t){this.version=e,this.transformResults=t}}class Ye{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ye}static exists(e){return new Ye(void 0,e)}static updateTime(e){return new Ye(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ti(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class $s{}function ec(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new ni(r.key,Ye.none()):new Ui(r.key,r.data,Ye.none());{const t=r.data,n=vt.empty();let i=new Fe(ke.comparator);for(let s of e.fields)if(!i.has(s)){let c=t.field(s);null===c&&s.length>1&&(s=s.popLast(),c=t.field(s)),null===c?n.delete(s):n.set(s,c),i=i.add(s)}return new rr(r.key,n,new wt(i.toArray()),Ye.none())}}function Rf(r,e,t){r instanceof Ui?function(i,s,c){const d=i.value.clone(),f=ir(i.fieldTransforms,s,c.transformResults);d.setAll(f),s.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(r,e,t):r instanceof rr?function(i,s,c){if(!ti(i.precondition,s))return void s.convertToUnknownDocument(c.version);const d=ir(i.fieldTransforms,s,c.transformResults),f=s.data;f.setAll(Qs(i)),f.setAll(d),s.convertToFoundDocument(c.version,f).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Zs(r,e,t,n){return r instanceof Ui?function(s,c,d,f){if(!ti(s.precondition,c))return d;const m=s.value.clone(),y=Hs(s.fieldTransforms,f,c);return m.setAll(y),c.convertToFoundDocument(c.version,m).setHasLocalMutations(),null}(r,e,t,n):r instanceof rr?function(s,c,d,f){if(!ti(s.precondition,c))return d;const m=Hs(s.fieldTransforms,f,c),y=c.data;return y.setAll(Qs(s)),y.setAll(m),c.convertToFoundDocument(c.version,y).setHasLocalMutations(),null===d?null:d.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(T=>T.field))}(r,e,t,n):(d=t,ti(r.precondition,c=e)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):d);var c,d}function Pf(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=_a(n.transform,i||null);null!=s&&(null===t&&(t=vt.empty()),t.set(n.field,s))}return t||null}function ql(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&pn(n,i,(s,c)=>function Af(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Rr&&i instanceof Rr||n instanceof nr&&i instanceof nr?pn(n.elements,i.elements,Tn):n instanceof ei&&i instanceof ei?Tn(n.Pe,i.Pe):n instanceof tr&&i instanceof tr);var n,i}(s,c))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Ui extends $s{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class rr extends $s{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Qs(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function ir(r,e,t){const n=new Map;ne(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],c=s.transform,d=e.data.field(s.field);n.set(s.field,Bl(c,d,t[i]))}return n}function Hs(r,e,t){const n=new Map;for(const i of r){const s=i.transform,c=t.data.field(i.field);n.set(i.field,Ul(s,c,e))}return n}class ni extends $s{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ya extends $s{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ia{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Rf(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Zs(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Zs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ws();return this.mutations.forEach(i=>{const s=e.get(i.key),c=s.overlayedDocument;let d=this.applyToLocalView(c,s.mutatedFields);d=t.has(i.key)?null:d;const f=ec(c,d);null!==f&&n.set(i.key,f),c.isValidDocument()||c.convertToNoDocument(ue.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),me())}isEqual(e){return this.batchId===e.batchId&&pn(this.mutations,e.mutations,(t,n)=>ql(t,n))&&pn(this.baseMutations,e.baseMutations,(t,n)=>ql(t,n))}}class tc{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){ne(e.mutations.length===n.length);let i=ma;const s=e.mutations;for(let c=0;c<s.length;c++)i=i.insert(s[c].key,n[c].version);return new tc(e,t,n,i)}}class va{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ta{constructor(e,t){this.count=e,this.unchangedNames=t}}var rt,Re;function Bi(r){switch(r){default:return Y();case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0}}function Ea(r){if(void 0===r)return Ge("GRPC error has no .code"),U.UNKNOWN;switch(r){case rt.OK:return U.OK;case rt.CANCELLED:return U.CANCELLED;case rt.UNKNOWN:return U.UNKNOWN;case rt.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case rt.INTERNAL:return U.INTERNAL;case rt.UNAVAILABLE:return U.UNAVAILABLE;case rt.UNAUTHENTICATED:return U.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case rt.NOT_FOUND:return U.NOT_FOUND;case rt.ALREADY_EXISTS:return U.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return U.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case rt.ABORTED:return U.ABORTED;case rt.OUT_OF_RANGE:return U.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return U.UNIMPLEMENTED;case rt.DATA_LOSS:return U.DATA_LOSS;default:return Y()}}(Re=rt||(rt={}))[Re.OK=0]="OK",Re[Re.CANCELLED=1]="CANCELLED",Re[Re.UNKNOWN=2]="UNKNOWN",Re[Re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Re[Re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Re[Re.NOT_FOUND=5]="NOT_FOUND",Re[Re.ALREADY_EXISTS=6]="ALREADY_EXISTS",Re[Re.PERMISSION_DENIED=7]="PERMISSION_DENIED",Re[Re.UNAUTHENTICATED=16]="UNAUTHENTICATED",Re[Re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Re[Re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Re[Re.ABORTED=10]="ABORTED",Re[Re.OUT_OF_RANGE=11]="OUT_OF_RANGE",Re[Re.UNIMPLEMENTED=12]="UNIMPLEMENTED",Re[Re.INTERNAL=13]="INTERNAL",Re[Re.UNAVAILABLE=14]="UNAVAILABLE",Re[Re.DATA_LOSS=15]="DATA_LOSS";function rc(){return new TextEncoder}const Sf=new st([4294967295,4294967295],0);function Aa(r){const e=rc().encode(r),t=new gt;return t.update(e),new Uint8Array(t.digest())}function Gl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new st([t,n],0),new st([i,s],0)]}class qi{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Gi(`Invalid padding: ${t}`);if(n<0)throw new Gi(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Gi(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Gi(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=st.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(st.fromNumber(n)));return 1===i.compare(Sf)&&(i=new st([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Aa(e),[n,i]=Gl(t);for(let s=0;s<this.hashCount;s++){const c=this.Ee(n,i,s);if(!this.de(c))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),c=new qi(s,i,t);return n.forEach(d=>c.insert(d)),c}insert(e){if(0===this.Ie)return;const t=Aa(e),[n,i]=Gl(t);for(let s=0;s<this.hashCount;s++){const c=this.Ee(n,i,s);this.Ae(c)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Gi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class zi{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Dn.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new zi(ue.min(),i,new Me(he),Pt(),me())}}class Dn{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Dn(n,t,me(),me(),me())}}class Ys{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class at{constructor(e,t){this.targetId=e,this.me=t}}class ic{constructor(e,t,n=nt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Xs{constructor(){this.fe=0,this.ge=sc(),this.pe=nt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=me(),t=me(),n=me();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Y()}}),new Dn(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=sc()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ne(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class zl{constructor(e){this.Le=e,this.Be=new Map,this.ke=Pt(),this.qe=eo(),this.Qe=new Me(he)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Y()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Fs(s))if(0===n){const c=new X(s.path);this.Ue(t,c,Ne.newNoDocument(c,ue.min()))}else ne(1===n);else{const c=this.Ye(t);if(c!==n){const d=this.Ze(e),f=d?this.Xe(d,e,c):1;0!==f&&(this.je(t),this.Qe=this.Qe.insert(t,2===f?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let c,d;try{c=kn(n).toUint8Array()}catch(f){if(f instanceof Lu)return ot("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{d=new qi(c,i,s)}catch(f){return ot(f instanceof Gi?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return 0===d.Ie?null:d}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const c=this.Le.tt(),d=`projects/${c.projectId}/databases/${c.database}/documents/${s.path.canonicalString()}`;e.mightContain(d)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,c)=>{const d=this.Je(c);if(d){if(s.current&&Fs(d.target)){const f=new X(d.target.path);null!==this.ke.get(f)||this.it(c,f)||this.Ue(c,f,Ne.newNoDocument(f,e))}s.be&&(t.set(c,s.ve()),s.Ce())}});let n=me();this.qe.forEach((s,c)=>{let d=!0;c.forEachWhile(f=>{const m=this.Je(f);return!m||"TargetPurposeLimboResolution"===m.purpose||(d=!1,!1)}),d&&(n=n.add(s))}),this.ke.forEach((s,c)=>c.setReadTime(e));const i=new zi(e,t,this.Qe,this.ke,n);return this.ke=Pt(),this.qe=eo(),this.Qe=new Me(he),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Xs,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Fe(he),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||K("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xs),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function eo(){return new Me(X.comparator)}function sc(){return new Me(X.comparator)}const jl={asc:"ASCENDING",desc:"DESCENDING"},oc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Wl={and:"AND",or:"OR"};class to{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function no(r,e){return r.useProto3Json||Wr(e)?e:{value:e}}function wn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ji(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Kl(r,e){return wn(r,e.toTimestamp())}function Xe(r){return ne(!!r),ue.fromTimestamp(function(t){const n=Vn(t);return new Ve(n.seconds,n.nanos)}(r))}function ro(r,e){return Wi(r,e).canonicalString()}function Wi(r,e){const t=(i=r,new fe(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function ac(r){const e=fe.fromString(r);return ne(ao(e)),e}function Sr(r,e){return ro(r.databaseId,e.path)}function ln(r,e){const t=ac(e);if(t.get(1)!==r.databaseId.projectId)throw new j(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new j(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new X(wa(t))}function uc(r,e){return ro(r.databaseId,e)}function cc(r){const e=ac(r);return 4===e.length?fe.emptyPath():wa(e)}function lc(r){return new fe(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function wa(r){return ne(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function hc(r,e,t){return{name:Sr(r,e),fields:t.value.mapValue.fields}}function dc(r,e,t){const n=ln(r,e.name),i=Xe(e.updateTime),s=e.createTime?Xe(e.createTime):ue.min(),c=new vt({mapValue:{fields:e.fields}}),d=Ne.newFoundDocument(n,i,s,c);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function Ki(r,e){let t;if(e instanceof Ui)t={update:hc(r,e.key,e.value)};else if(e instanceof ni)t={delete:Sr(r,e.key)};else if(e instanceof rr)t={update:hc(r,e.key,e.data),updateMask:Xl(e.fieldMask)};else{if(!(e instanceof ya))return Y();t={verify:Sr(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,c){const d=c.transform;if(d instanceof tr)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Rr)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof nr)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof ei)return{fieldPath:c.field.canonicalString(),increment:d.Pe};throw Y()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Kl(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:Y()),t;var s}function ri(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Ye.updateTime(Xe(s.updateTime)):void 0!==s.exists?Ye.exists(s.exists):Ye.none():Ye.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(c,d){let f=null;"setToServerValue"in d?(ne("REQUEST_TIME"===d.setToServerValue),f=new tr):"appendMissingElements"in d?f=new Rr(d.appendMissingElements.values||[]):"removeAllFromArray"in d?f=new nr(d.removeAllFromArray.values||[]):"increment"in d?f=new ei(c,d.increment):Y();const m=ke.fromServerFormat(d.fieldPath);return new Fi(m,f)}(r,i)):[];var s;if(e.update){const i=ln(r,e.update.name),s=new vt({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=new wt((e.updateMask.fieldPaths||[]).map(y=>ke.fromServerFormat(y)));return new rr(i,s,c,t,n)}return new Ui(i,s,t,n)}if(e.delete){const i=ln(r,e.delete);return new ni(i,t)}if(e.verify){const i=ln(r,e.verify);return new ya(i,t)}return Y()}function fc(r,e){return{documents:[uc(r,e.path)]}}function io(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=uc(r,i);const s=function(m){if(0!==m.length)return oo(Oe.create(m,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const c=function(m){if(0!==m.length)return m.map(y=>{return{field:sr((R=y).field),direction:Jl(R.dir)};var R})}(e.orderBy);c&&(t.structuredQuery.orderBy=c);const d=no(r,e.limit);return null!==d&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt={before:(m=e.startAt).inclusive,values:m.position}),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:t,parent:i};var m}function pc(r){let e=cc(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){ne(1===n);const y=t.from[0];y.allDescendants?i=y.collectionId:e=e.child(y.collectionId)}let s=[];t.where&&(s=function(T){const R=mc(T);return R instanceof Oe&&xs(R)?R.getFilters():[R]}(t.where));let c=[];t.orderBy&&(c=t.orderBy.map(R=>{return new Hr(ii((W=R).field),function(Z){switch(Z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(W.direction));var W}));let d=null;t.limit&&(d=function(T){let R;return R="object"==typeof T?T.value:T,Wr(R)?null:R}(t.limit));let f=null;var T;t.startAt&&(f=new Qn((T=t.startAt).values||[],!!T.before));let m=null;return t.endAt&&(m=function(T){return new Qn(T.values||[],!T.before)}(t.endAt)),Bs(e,i,c,s,d,"F",f,m)}function mc(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=ii(t.unaryFilter.field);return Ee.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=ii(t.unaryFilter.field);return Ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ii(t.unaryFilter.field);return Ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=ii(t.unaryFilter.field);return Ee.create(c,"!=",{nullValue:"NULL_VALUE"});default:return Y()}}(r):void 0!==r.fieldFilter?Ee.create(ii((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Y()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Oe.create(t.compositeFilter.filters.map(n=>mc(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Y()}}(t.compositeFilter.op))}(r):Y();var t}function Jl(r){return jl[r]}function gc(r){return oc[r]}function Yl(r){return Wl[r]}function sr(r){return{fieldPath:r.canonicalString()}}function ii(r){return ke.fromServerFormat(r.fieldPath)}function oo(r){return r instanceof Ee?function(t){if("=="===t.op){if(Fu(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NAN"}};if($n(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Fu(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NOT_NAN"}};if($n(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sr(t.field),op:gc(t.op),value:t.value}}}(r):r instanceof Oe?function(t){const n=t.getFilters().map(i=>oo(i));return 1===n.length?n[0]:{compositeFilter:{op:Yl(t.op),filters:n}}}(r):Y()}function Xl(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ao(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class On{constructor(e,t,n,i,s=ue.min(),c=ue.min(),d=nt.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=d,this.expectedCount=f}withSequenceNumber(e){return new On(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class uo{constructor(e){this.ct=e}}function co(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:br(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Sr(s=r.ct,(c=e).key),fields:c.data.value.mapValue.fields,updateTime:wn(s,c.version.toTimestamp()),createTime:wn(s,c.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Ln(e.version)};else{if(!e.isUnknownDocument())return Y();n.unknownDocument={path:t.path.toArray(),version:Ln(e.version)}}var s,c;return n}function br(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Ln(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Cr(r){const e=new Ve(r.seconds,r.nanoseconds);return ue.fromTimestamp(e)}function Mn(r,e){const t=(e.baseMutations||[]).map(s=>ri(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>ri(r.ct,s)),i=Ve.fromMillis(e.localWriteTimeMs);return new Ia(e.batchId,i,t,n)}function $i(r){const e=Cr(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Cr(r.lastLimboFreeSnapshotVersion):ue.min();let n;return n=void 0!==r.query.documents?(ne(1===(s=r.query).documents.length),Rt(Yn(cc(s.documents[0])))):function(s){return Rt(pc(s))}(r.query),new On(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,nt.fromBase64String(r.resumeToken));var s}function or(r,e){const t=Ln(e.snapshotVersion),n=Ln(e.lastLimboFreeSnapshotVersion);let i;i=Fs(e.target)?fc(r.ct,e.target):io(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Jn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Zi(r){const e=pc({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Gs(e,e.limit,"L"):e}function Ra(r,e){return new va(e.largestBatchId,ri(r.ct,e.overlayMutation))}function _c(r,e){const t=e.path.lastSegment();return[r,yt(e.path.popLast()),t]}function yc(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Ln(n.readTime),documentKey:yt(n.documentKey.path),largestBatchId:n.largestBatchId}}class Pa{getBundleMetadata(e,t){return Sa(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Cr(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Sa(e).put({bundleId:(i=t).id,createTime:Ln(Xe(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Ic(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:Zi(s.bundledQuery),readTime:Cr(s.readTime)};var s})}saveNamedQuery(e,t){return Ic(e).put({name:(i=t).name,readTime:Ln(Xe(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Sa(r){return ht(r,"bundles")}function Ic(r){return ht(r,"namedQueries")}class lo{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new lo(e,t.uid||"")}getOverlay(e,t){return xr(e).get(_c(this.userId,t)).next(n=>n?Ra(this.serializer,n):null)}getOverlays(e,t){const n=An();return V.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,c)=>{const d=new va(t,c);i.push(this.ht(e,d))}),V.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(c=>i.add(yt(c.getCollectionPath())));const s=[];return i.forEach(c=>{const d=IDBKeyRange.bound([this.userId,c,n],[this.userId,c,n+1],!1,!0);s.push(xr(e).j("collectionPathOverlayIndex",d))}),V.waitFor(s)}getOverlaysForCollection(e,t,n){const i=An(),s=yt(t),c=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return xr(e).U("collectionPathOverlayIndex",c).next(d=>{for(const f of d){const m=Ra(this.serializer,f);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=An();let c;const d=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xr(e).J({index:"collectionGroupOverlayIndex",range:d},(f,m,y)=>{const T=Ra(this.serializer,m);s.size()<i||T.largestBatchId===c?(s.set(T.getKey(),T),c=T.largestBatchId):y.done()}).next(()=>s)}ht(e,t){return xr(e).put(function(i,s,c){const[d,f,m]=_c(s,c.mutation.key);return{userId:s,collectionPath:f,documentId:m,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:Ki(i.ct,c.mutation)}}(this.serializer,this.userId,t))}}function xr(r){return ht(r,"documentOverlays")}class th{Pt(e){return ht(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t?.value;return n?nt.fromUint8Array(n):nt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Fn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ze(e.integerValue));else if("doubleValue"in e){const n=ze(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Ri(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Vn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(kn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Cs(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Zn(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Y()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const c="value",d=(null===(i=null===(n=s[c].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(ze(d)),this.Vt(c,t),this.Tt(s[c],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),X.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function nh(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function ho(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const c=nh(255&n[s]);if(i+=c,8!==c)break}return i}(r);return Math.ceil(e/8)}Fn.vt=new Fn;class ba{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=ho(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=ho(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,s,!1),new Uint8Array(c.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class rh{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class Qi{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Hi{constructor(){this.jt=new ba,this.Ht=new rh(this.jt),this.Jt=new Qi(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class Vr{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Vr(this.indexId,this.documentKey,this.arrayValue,n)}}function Rn(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=fo(r.arrayValue,e.arrayValue),0!==t?t:(t=fo(r.directionalValue,e.directionalValue),0!==t?t:X.comparator(r.documentKey,e.documentKey)))}function fo(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class po{constructor(e){this.Xt=new Fe((t,n)=>ke.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(ne(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Ir(e);if(void 0!==t&&!this.sn(t))return!1;const n=gn(e);let i=new Set,s=0,c=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const d=this.Xt.getIterator().getNext();if(!i.has(d.field.canonicalString())){const f=n[s];if(!this.on(d,f)||!this._n(this.en[c++],f))return!1}++s}for(;s<n.length;++s)if(c>=this.en.length||!this._n(this.en[c++],n[s]))return!1;return!0}an(){if(this.nn)return null;let e=new Fe(ke.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new cn(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new cn(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new cn(n.field,"asc"===n.dir?0:1)));return new mn(mn.UNKNOWN_ID,this.collectionId,t,B.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function vc(r){var e,t;if(ne(r instanceof Ee||r instanceof Oe),r instanceof Ee){if(r instanceof Ls){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Ee.create(r.field,"==",s)))||[];return Oe.create(i,"or")}return r}const n=r.filters.map(i=>vc(i));return Oe.create(n,r.op)}function Tc(r){if(0===r.getFilters().length)return[];const e=Ca(vc(r));return ne(Ec(e)),mo(e)||go(e)?[e]:e.getFilters()}function mo(r){return r instanceof Ee}function go(r){return r instanceof Oe&&xs(r)}function Ec(r){return mo(r)||go(r)||function(t){if(t instanceof Oe&&Jr(t)){for(const n of t.getFilters())if(!mo(n)&&!go(n))return!1;return!0}return!1}(r)}function Ca(r){if(ne(r instanceof Ee||r instanceof Oe),r instanceof Ee)return r;if(1===r.filters.length)return Ca(r.filters[0]);const e=r.filters.map(n=>Ca(n));let t=Oe.create(e,r.op);return t=_o(t),Ec(t)?t:(ne(t instanceof Oe),ne(Hn(t)),ne(t.filters.length>1),t.filters.reduce((n,i)=>Ji(n,i)))}function Ji(r,e){let t;return ne(r instanceof Ee||r instanceof Oe),ne(e instanceof Ee||e instanceof Oe),t=r instanceof Ee?e instanceof Ee?Oe.create([r,e],"and"):Ac(r,e):e instanceof Ee?Ac(e,r):function(i,s){if(ne(i.filters.length>0&&s.filters.length>0),Hn(i)&&Hn(s))return ks(i,s.getFilters());const c=Jr(i)?i:s,d=Jr(i)?s:i,f=c.filters.map(m=>Ji(m,d));return Oe.create(f,"or")}(r,e),_o(t)}function Ac(r,e){if(Hn(e))return ks(e,r.getFilters());{const t=e.filters.map(n=>Ji(r,n));return Oe.create(t,"or")}}function _o(r){if(ne(r instanceof Ee||r instanceof Oe),r instanceof Ee)return r;const e=r.getFilters();if(1===e.length)return _o(e[0]);if(ca(r))return r;const t=e.map(i=>_o(i)),n=[];return t.forEach(i=>{i instanceof Ee?n.push(i):i instanceof Oe&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:Oe.create(n,r.op)}class xa{constructor(){this.un=new Va}addToCollectionParentIndex(e,t){return this.un.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(z.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(z.min())}updateCollectionGroup(e,t,n){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class Va{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Fe(fe.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Fe(fe.comparator)).toArray()}}const yo=new Uint8Array(0);class ka{constructor(e,t){this.databaseId=t,this.cn=new Va,this.ln=new Nn(n=>Jn(n),(n,i)=>Ar(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:n,parent:yt(i)};return wc(e).put(s)}return V.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Ke(t),""],!1,!0);return wc(e).U(i).next(s=>{for(const c of s){if(c.collectionId!==t)break;n.push(yn(c.parent))}return n})}addFieldIndex(e,t){const n=kr(e),i={indexId:(d=t).indexId,collectionGroup:d.collectionGroup,fields:d.fields.map(f=>[f.fieldPath.canonicalString(),f.kind])};var d;delete i.indexId;const s=n.add(i);if(t.indexState){const c=ur(e);return s.next(d=>{c.put(yc(d,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=kr(e),i=ur(e),s=ar(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=kr(e),n=ar(e),i=ur(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return V.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new po(n).an();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=ar(e);let i=!0;const s=new Map;return V.forEach(this.hn(t),c=>this.Pn(e,c).next(d=>{i&&(i=!!d),s.set(c,d)})).next(()=>{if(i){let c=me();const d=[];return V.forEach(s,(f,m)=>{var oe;K("IndexedDbIndexManager",`Using index ${oe=f,`id=${oe.indexId}|cg=${oe.collectionGroup}|f=${oe.fields.map(pe=>`${pe.fieldPath}:${pe.kind}`).join(",")}`} to execute ${Jn(t)}`);const y=function(oe,pe){const we=Ir(pe);if(void 0===we)return null;for(const Ie of Yr(oe,we.fieldPath))switch(Ie.op){case"array-contains-any":return Ie.value.arrayValue.values||[];case"array-contains":return[Ie.value]}return null}(m,f),T=function(oe,pe){const we=new Map;for(const Ie of gn(pe))for(const k of Yr(oe,Ie.fieldPath))switch(k.op){case"==":case"in":we.set(Ie.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return we.set(Ie.fieldPath.canonicalString(),k.value),Array.from(we.values())}return null}(m,f),R=function(oe,pe){const we=[];let Ie=!0;for(const k of gn(pe)){const E=0===k.kind?Ku(oe,k.fieldPath,oe.startAt):Us(oe,k.fieldPath,oe.startAt);we.push(E.value),Ie&&(Ie=E.inclusive)}return new Qn(we,Ie)}(m,f),O=function(oe,pe){const we=[];let Ie=!0;for(const k of gn(pe)){const E=0===k.kind?Us(oe,k.fieldPath,oe.endAt):Ku(oe,k.fieldPath,oe.endAt);we.push(E.value),Ie&&(Ie=E.inclusive)}return new Qn(we,Ie)}(m,f),W=this.In(f,m,R),Q=this.In(f,m,O),Z=this.Tn(f,m,T),se=this.En(f.indexId,y,W,R.inclusive,Q,O.inclusive,Z);return V.forEach(se,le=>n.G(le,t.limit).next(oe=>{oe.forEach(pe=>{const we=X.fromSegments(pe.documentKey);c.has(we)||(c=c.add(we),d.push(we))})}))}).next(()=>d)}return V.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Tc(Oe.create(e.filters,"and")).map(n=>xi(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,c,d){const f=(null!=t?t.length:1)*Math.max(n.length,s.length),m=f/(null!=t?t.length:1),y=[];for(let T=0;T<f;++T){const R=t?this.dn(t[T/m]):yo,O=this.An(e,R,n[T%m],i),W=this.Rn(e,R,s[T%m],c),Q=d.map(Z=>this.An(e,R,Z,!0));y.push(...this.createRange(O,W,Q))}return y}An(e,t,n,i){const s=new Vr(e,X.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new Vr(e,X.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new po(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let c=null;for(const d of s)n.rn(d)&&(!c||d.fields.length>c.fields.length)&&(c=d);return c})}getIndexType(e,t){let n=2;const i=this.hn(t);return V.forEach(i,s=>this.Pn(e,s).next(c=>{c?0!==n&&c.fields.length<function(f){let m=new Fe(ke.comparator),y=!1;for(const T of f.filters)for(const R of T.getFlattenedFilters())R.field.isKeyField()||("array-contains"===R.op||"array-contains-any"===R.op?y=!0:m=m.add(R.field));for(const T of f.orderBy)T.field.isKeyField()||(m=m.add(T.field));return m.size+(y?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new Hi;for(const i of gn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const c=n.Yt(i.kind);Fn.vt.It(s,c)}return n.zt()}dn(e){const t=new Hi;return Fn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new Hi;return Fn.vt.It(Tr(this.databaseId,t),n.Yt(function(s){const c=gn(s);return 0===c.length?0:c[c.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new Hi);let s=0;for(const c of gn(e)){const d=n[s++];for(const f of i)if(this.fn(t,c.fieldPath)&&Er(d))i=this.gn(i,c,d);else{const m=f.Yt(c.kind);Fn.vt.It(d,m)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const c of n.arrayValue.values||[])for(const d of i){const f=new Hi;f.seed(d.zt()),Fn.vt.It(c,f.Yt(t.kind)),s.push(f)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof Ee&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=kr(e),i=ur(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const c=[];return V.forEach(s,d=>i.get([d.indexId,this.uid]).next(f=>{c.push(function(y,T){const R=T?new B(T.sequenceNumber,new z(Cr(T.readTime),new X(yn(T.documentKey)),T.largestBatchId)):B.empty(),O=y.fields.map(([W,Q])=>new cn(ke.fromServerFormat(W),Q));return new mn(y.indexId,y.collectionGroup,O,R)}(d,f))})).next(()=>c)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:he(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=kr(e),s=ur(e);return this.yn(e).next(c=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>V.forEach(d,f=>s.put(yc(f.indexId,this.uid,c,n)))))}updateIndexEntries(e,t){const n=new Map;return V.forEach(t,(i,s)=>{const c=n.get(i.collectionGroup);return(c?V.resolve(c):this.getFieldIndexes(e,i.collectionGroup)).next(d=>(n.set(i.collectionGroup,d),V.forEach(d,f=>this.wn(e,i,f).next(m=>{const y=this.Sn(s,f);return m.isEqual(y)?V.resolve():this.bn(e,s,f,m,y)}))))})}Dn(e,t,n,i){return ar(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return ar(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=ar(e);let s=new Fe(Rn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(c,d)=>{s=s.add(new Vr(n.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}Sn(e,t){let n=new Fe(Rn);const i=this.Vn(t,e);if(null==i)return n;const s=Ir(t);if(null!=s){const c=e.data.field(s.fieldPath);if(Er(c))for(const d of c.arrayValue.values||[])n=n.add(new Vr(t.indexId,e.key,this.dn(d),i))}else n=n.add(new Vr(t.indexId,e.key,yo,i));return n}bn(e,t,n,i,s){K("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const c=[];return function(f,m,y,T,R){const O=f.getIterator(),W=m.getIterator();let Q=xn(O),Z=xn(W);for(;Q||Z;){let se=!1,le=!1;if(Q&&Z){const oe=y(Q,Z);oe<0?le=!0:oe>0&&(se=!0)}else null!=Q?le=!0:se=!0;se?(T(Z),Z=xn(W)):le?(R(Q),Q=xn(O)):(Q=xn(O),Z=xn(W))}}(i,s,Rn,d=>{c.push(this.Dn(e,t,n,d))},d=>{c.push(this.vn(e,t,n,d))}),V.waitFor(c)}yn(e){let t=1;return ur(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((c,d)=>Rn(c,d)).filter((c,d,f)=>!d||0!==Rn(c,f[d-1]));const i=[];i.push(e);for(const c of n){const d=Rn(c,e),f=Rn(c,t);if(0===d)i[0]=e.Zt();else if(d>0&&f<0)i.push(c),i.push(c.Zt());else if(f>0)break}i.push(t);const s=[];for(let c=0;c<i.length;c+=2){if(this.Cn(i[c],i[c+1]))return[];s.push(IDBKeyRange.bound([i[c].indexId,this.uid,i[c].arrayValue,i[c].directionalValue,yo,[]],[i[c+1].indexId,this.uid,i[c+1].arrayValue,i[c+1].directionalValue,yo,[]]))}return s}Cn(e,t){return Rn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Na)}getMinOffset(e,t){return V.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||Y())).next(Na)}}function wc(r){return ht(r,"collectionParents")}function ar(r){return ht(r,"indexEntries")}function kr(r){return ht(r,"indexConfiguration")}function ur(r){return ht(r,"indexState")}function Na(r){ne(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;te(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new z(e.readTime,e.documentKey,t)}const Io={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class St{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new St(e,St.DEFAULT_COLLECTION_PERCENTILE,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Da(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],c=IDBKeyRange.only(t.batchId);let d=0;const f=n.J({range:c},(y,T,R)=>(d++,R.delete()));s.push(f.next(()=>{ne(1===d)}));const m=[];for(const y of t.mutations){const T=Kr(e,y.key.path,t.batchId);s.push(i.delete(T)),m.push(y.key)}return V.waitFor(s).next(()=>m)}function Yi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw Y();e=r.noDocument}return JSON.stringify(e).length}St.DEFAULT_COLLECTION_PERCENTILE=10,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,St.DEFAULT=new St(41943040,St.DEFAULT_COLLECTION_PERCENTILE,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),St.DISABLED=new St(-1,0,0);class Xi{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){ne(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Xi(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Un(e).J({index:"userMutationsIndex",range:n},(i,s,c)=>{t=!1,c.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=cr(e),c=Un(e);return c.add({}).next(d=>{ne("number"==typeof d);const f=new Ia(d,t,n,i),m=function(O,W,Q){const Z=Q.baseMutations.map(le=>Ki(O.ct,le)),se=Q.mutations.map(le=>Ki(O.ct,le));return{userId:W,batchId:Q.batchId,localWriteTimeMs:Q.localWriteTime.toMillis(),baseMutations:Z,mutations:se}}(this.serializer,this.userId,f),y=[];let T=new Fe((R,O)=>he(R.canonicalString(),O.canonicalString()));for(const R of i){const O=Kr(this.userId,R.key.path,d);T=T.add(R.key.path.popLast()),y.push(c.put(m)),y.push(s.put(O,Pl))}return T.forEach(R=>{y.push(this.indexManager.addToCollectionParentIndex(e,R))}),e.addOnCommittedListener(()=>{this.Fn[d]=f.keys()}),V.waitFor(y).next(()=>f)})}lookupMutationBatch(e,t){return Un(e).get(t).next(n=>n?(ne(n.userId===this.userId),Mn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?V.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Un(e).J({index:"userMutationsIndex",range:i},(c,d,f)=>{d.userId===this.userId&&(ne(d.batchId>=n),s=Mn(this.serializer,d)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Un(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,c)=>{n=s.batchId,c.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Un(e).U("userMutationsIndex",t).next(n=>n.map(i=>Mn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Pi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return cr(e).J({range:i},(c,d,f)=>{const[m,y,T]=c,R=yn(y);if(m===this.userId&&t.path.isEqual(R))return Un(e).get(T).next(O=>{if(!O)throw Y();ne(O.userId===this.userId),s.push(Mn(this.serializer,O))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fe(he);const i=[];return t.forEach(s=>{const c=Pi(this.userId,s.path),d=IDBKeyRange.lowerBound(c),f=cr(e).J({range:d},(m,y,T)=>{const[R,O,W]=m,Q=yn(O);R===this.userId&&s.path.isEqual(Q)?n=n.add(W):T.done()});i.push(f)}),V.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Pi(this.userId,n),c=IDBKeyRange.lowerBound(s);let d=new Fe(he);return cr(e).J({range:c},(f,m,y)=>{const[T,R,O]=f,W=yn(R);T===this.userId&&n.isPrefixOf(W)?W.length===i&&(d=d.add(O)):y.done()}).next(()=>this.xn(e,d))}xn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Un(e).get(s).next(c=>{if(null===c)throw Y();ne(c.userId===this.userId),n.push(Mn(this.serializer,c))}))}),V.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Da(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),V.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return V.resolve();const n=IDBKeyRange.lowerBound([this.userId]),i=[];return cr(e).J({range:n},(s,c,d)=>{if(s[0]===this.userId){const f=yn(s[1]);i.push(f)}else d.done()}).next(()=>{ne(0===i.length)})})}containsKey(e,t){return Rc(e,this.userId,t)}Nn(e){return Pc(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Rc(r,e,t){const n=Pi(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let c=!1;return cr(r).J({range:s,H:!0},(d,f,m)=>{const[y,T,R]=d;y===e&&T===i&&(c=!0),m.done()}).next(()=>c)}function Un(r){return ht(r,"mutations")}function cr(r){return ht(r,"documentMutations")}function Pc(r){return ht(r,"mutationQueues")}class Nr{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Nr(0)}static kn(){return new Nr(-1)}}class ih{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new Nr(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>ue.fromTimestamp(new Ve(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(ne(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return lr(e).J((c,d)=>{const f=$i(d);f.sequenceNumber<=t&&null===n.get(f.targetId)&&(i++,s.push(this.removeTargetData(e,f)))}).next(()=>V.waitFor(s)).next(()=>i)}forEachTarget(e,t){return lr(e).J((n,i)=>{const s=$i(i);t(s)})}qn(e){return Sc(e).get("targetGlobalKey").next(t=>(ne(null!==t),t))}Qn(e,t){return Sc(e).put("targetGlobalKey",t)}Kn(e,t){return lr(e).put(or(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Jn(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return lr(e).J({range:i,index:"queryTargetsIndex"},(c,d,f)=>{const m=$i(d);Ar(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=hr(e);return t.forEach(c=>{const d=yt(c.path);i.push(s.put({targetId:n,path:d})),i.push(this.referenceDelegate.addReference(e,n,c))}),V.waitFor(i)}removeMatchingKeys(e,t,n){const i=hr(e);return V.forEach(t,s=>{const c=yt(s.path);return V.waitFor([i.delete([n,c]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=hr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=hr(e);let s=me();return i.J({range:n,H:!0},(c,d,f)=>{const m=yn(c[1]),y=new X(m);s=s.add(y)}).next(()=>s)}containsKey(e,t){const n=yt(t.path),i=IDBKeyRange.bound([n],[Ke(n)],!1,!0);let s=0;return hr(e).J({index:"documentTargetsIndex",H:!0,range:i},([c,d],f,m)=>{0!==c&&(s++,m.done())}).next(()=>s>0)}ot(e,t){return lr(e).get(t).next(n=>n?$i(n):null)}}function lr(r){return ht(r,"targets")}function Sc(r){return ht(r,"targetGlobal")}function hr(r){return ht(r,"targetDocuments")}function Oa([r,e],[t,n]){const i=he(r,t);return 0===i?he(e,n):i}class sh{constructor(e){this.Un=e,this.buffer=new Fe(Oa),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Oa(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class es{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;K("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,q.Z)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){_n(n)?K("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Te(n)}yield t.Hn(3e5)}))}}class oh{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return V.resolve(Lt.oe);const n=new sh(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(Io)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Io):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,c,d,f,m;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),i=this.params.maximumSequenceNumbersToCollect):i=T,c=Date.now(),this.nthSequenceNumber(e,i))).next(T=>(n=T,d=Date.now(),this.removeTargets(e,n,t))).next(T=>(s=T,f=Date.now(),this.removeOrphanedDocuments(e,n))).next(T=>(m=Date.now(),pt()<=Pe.in.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${c-y}ms\n\tDetermined least recently used ${i} in `+(d-c)+`ms\n\tRemoved ${s} targets in `+(f-d)+`ms\n\tRemoved ${T} documents in `+(m-f)+`ms\nTotal Duration: ${m-y}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:T})))}}class ah{constructor(e,t){this.db=e,this.garbageCollector=function bc(r,e){return new oh(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return vo(e,n)}removeReference(e,t,n){return vo(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return vo(e,t)}nr(e,t){return function(i,s){let c=!1;return Pc(i).Y(d=>Rc(i,d,s).next(f=>(f&&(c=!0),V.resolve(!f)))).next(()=>c)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(c,d)=>{if(d<=t){const f=this.nr(e,c).next(m=>{if(!m)return s++,n.getEntry(e,c).next(()=>(n.removeEntry(c,ue.min()),hr(e).delete([0,yt(c.path)])))});i.push(f)}}).next(()=>V.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return vo(e,t)}tr(e,t){const n=hr(e);let i,s=Lt.oe;return n.J({index:"documentTargetsIndex"},([c,d],{path:f,sequenceNumber:m})=>{0===c?(s!==Lt.oe&&t(new X(yn(i)),s),s=m,i=f):s=Lt.oe}).next(()=>{s!==Lt.oe&&t(new X(yn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vo(r,e){return hr(r).put((i=r.currentSequenceNumber,{targetId:0,path:yt(e.path),sequenceNumber:i}));var i}class Cc{constructor(){this.changes=new Nn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?V.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uh{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Dr(e).put(n)}removeEntry(e,t,n){return Dr(e).delete(function(s,c){const d=s.path.toArray();return[d.slice(0,d.length-2),d[d.length-2],br(c),d[d.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Ne.newInvalidDocument(t);return Dr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ts(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:Ne.newInvalidDocument(t)};return Dr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ts(t))},(i,s)=>{n={document:this.ir(t,s),size:Yi(s)}}).next(()=>n)}getEntries(e,t){let n=Pt();return this._r(e,t,(i,s)=>{const c=this.ir(i,s);n=n.insert(i,c)}).next(()=>n)}ar(e,t){let n=Pt(),i=new Me(X.comparator);return this._r(e,t,(s,c)=>{const d=this.ir(s,c);n=n.insert(s,d),i=i.insert(s,Yi(c))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return V.resolve();let i=new Fe(kc);t.forEach(f=>i=i.add(f));const s=IDBKeyRange.bound(ts(i.first()),ts(i.last())),c=i.getIterator();let d=c.getNext();return Dr(e).J({index:"documentKeyIndex",range:s},(f,m,y)=>{const T=X.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;d&&kc(d,T)<0;)n(d,null),d=c.getNext();d&&d.isEqual(T)&&(n(d,m),d=c.hasNext()?c.getNext():null),d?y.$(ts(d)):y.done()}).next(()=>{for(;d;)n(d,null),d=c.hasNext()?c.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const c=t.path,d=[c.popLast().toArray(),c.lastSegment(),br(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],f=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Dr(e).U(IDBKeyRange.bound(d,f,!0)).next(m=>{s?.incrementDocumentReadCount(m.length);let y=Pt();for(const T of m){const R=this.ir(X.fromSegments(T.prefixPath.concat(T.collectionGroup,T.documentId)),T);R.isFoundDocument()&&(Di(t,R)||i.has(R.key))&&(y=y.insert(R.key,R))}return y})}getAllFromCollectionGroup(e,t,n,i){let s=Pt();const c=Vc(t,n),d=Vc(t,z.max());return Dr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(c,d,!0)},(f,m,y)=>{const T=this.ir(X.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(T.key,T),s.size===i&&y.done()}).next(()=>s)}newChangeBuffer(e){return new ch(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return To(e).get("remoteDocumentGlobalKey").next(t=>(ne(!!t),t))}rr(e,t){return To(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function eh(r,e){let t;if(e.document)t=dc(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=X.fromSegments(e.noDocument.path),i=Cr(e.noDocument.readTime);t=Ne.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Y();{const n=X.fromSegments(e.unknownDocument.path),i=Cr(e.unknownDocument.version);t=Ne.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Ve(i[0],i[1]);return ue.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(ue.min()))return n}return Ne.newInvalidDocument(e)}}function xc(r){return new uh(r)}class ch extends Cc{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Nn(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new Fe((s,c)=>he(s.canonicalString(),c.canonicalString()));return this.changes.forEach((s,c)=>{const d=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,d.readTime)),c.isValidDocument()){const f=co(this.cr.serializer,c);i=i.add(s.path.popLast());const m=Yi(f);n+=m-d.size,t.push(this.cr.addEntry(e,s,f))}else if(n-=d.size,this.trackRemovals){const f=co(this.cr.serializer,c.convertToNoDocument(ue.min()));t.push(this.cr.addEntry(e,s,f))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),V.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,c)=>{this.lr.set(s,{size:c,readTime:n.get(s).readTime})}),n))}}function To(r){return ht(r,"remoteDocumentGlobal")}function Dr(r){return ht(r,"remoteDocumentsV14")}function ts(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Vc(r,e){const t=e.documentKey.path.toArray();return[r,br(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function kc(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=he(t[s],n[s]),i)return i;return i=he(t.length,n.length),i||(i=he(t[t.length-2],n[n.length-2]),i||he(t[t.length-1],n[n.length-1]))}class lh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class La{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Zs(n.mutation,i,wt.empty(),Ve.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,me()).next(()=>n))}getLocalViewOfDocuments(e,t,n=me()){const i=An();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let c=Oi();return s.forEach((d,f)=>{c=c.insert(d,f.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){const n=An();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,me()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((c,d)=>{t.set(c,d)})})}computeViews(e,t,n,i){let s=Pt();const c=Li(),d=Li();return t.forEach((f,m)=>{const y=n.get(m.key);i.has(m.key)&&(void 0===y||y.mutation instanceof rr)?s=s.insert(m.key,m):void 0!==y?(c.set(m.key,y.mutation.getFieldMask()),Zs(y.mutation,m,y.mutation.getFieldMask(),Ve.now())):c.set(m.key,wt.empty())}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,y)=>c.set(m,y)),t.forEach((m,y)=>{var T;return d.set(m,new lh(y,null!==(T=c.get(m))&&void 0!==T?T:null))}),d))}recalculateAndSaveOverlays(e,t){const n=Li();let i=new Me((c,d)=>c-d),s=me();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(const d of c)d.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let y=n.get(f)||wt.empty();y=d.applyToLocalView(m,y),n.set(f,y);const T=(i.get(d.batchId)||me()).add(f);i=i.insert(d.batchId,T)})}).next(()=>{const c=[],d=i.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,y=f.value,T=Ws();y.forEach(R=>{if(!s.has(R)){const O=ec(t.get(R),n.get(R));null!==O&&T.set(R,O),s=s.add(R)}}),c.push(this.documentOverlayCache.saveOverlays(e,m,T))}return V.waitFor(c)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return X.isDocumentKey((c=t).path)&&null===c.collectionGroup&&0===c.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ki(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var c}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const c=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):V.resolve(An());let d=-1,f=s;return c.next(m=>V.forEach(m,(y,T)=>(d<T.largestBatchId&&(d=T.largestBatchId),s.get(y)?V.resolve():this.remoteDocumentCache.getEntry(e,y).next(R=>{f=f.insert(y,R)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,me())).next(y=>({batchId:d,changes:js(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new X(t)).next(n=>{let i=Oi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let c=Oi();return this.indexManager.getCollectionParents(e,s).next(d=>V.forEach(d,f=>{const m=(T=t,R=f.child(s),new Zt(R,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt));var T,R;return this.getDocumentsMatchingCollectionQuery(e,m,n,i).next(y=>{y.forEach((T,R)=>{c=c.insert(T,R)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(c=>(s=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(c=>{s.forEach((f,m)=>{const y=m.getKey();null===c.get(y)&&(c=c.insert(y,Ne.newInvalidDocument(y)))});let d=Oi();return c.forEach((f,m)=>{const y=s.get(f);void 0!==y&&Zs(y.mutation,m,wt.empty(),Ve.now()),Di(t,m)&&(d=d.insert(f,m))}),d})}}class hh{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return V.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:Xe(i.createTime)}),V.resolve();var i}getNamedQuery(e,t){return V.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:Zi(i.bundledQuery),readTime:Xe(i.readTime)}),V.resolve();var i}}class dh{constructor(){this.overlays=new Me(X.comparator),this.Ir=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const n=An();return V.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),V.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),V.resolve()}getOverlaysForCollection(e,t,n){const i=An(),s=t.length+1,c=new X(t.child("")),d=this.overlays.getIteratorFrom(c);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>n&&i.set(f.getKey(),f)}return V.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Me((m,y)=>m-y);const c=this.overlays.getIterator();for(;c.hasNext();){const m=c.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let y=s.get(m.largestBatchId);null===y&&(y=An(),s=s.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const d=An(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,y)=>d.set(m,y)),!(d.size()>=i)););return V.resolve(d)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const c=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(n.key,new va(t,n));let s=this.Ir.get(t);void 0===s&&(s=me(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class fh{constructor(){this.sessionToken=nt.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}class Ma{constructor(){this.Tr=new Fe(It.Er),this.dr=new Fe(It.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new It(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new It(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new X(new fe([])),n=new It(t,e),i=new It(t,e+1),s=[];return this.dr.forEachInRange([n,i],c=>{this.Vr(c),s.push(c.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new X(new fe([])),n=new It(t,e),i=new It(t,e+1);let s=me();return this.dr.forEachInRange([n,i],c=>{s=s.add(c.key)}),s}containsKey(e){const t=new It(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class It{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return X.comparator(e.key,t.key)||he(e.wr,t.wr)}static Ar(e,t){return he(e.wr,t.wr)||X.comparator(e.key,t.key)}}class Fa{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Fe(It.Er)}checkEmpty(e){return V.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++;const c=new Ia(s,t,n,i);this.mutationQueue.push(c);for(const d of i)this.br=this.br.add(new It(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return V.resolve(c)}lookupMutationBatch(e,t){return V.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),s=i<0?0:i;return V.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new It(t,0),i=new It(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],c=>{const d=this.Dr(c.wr);s.push(d)}),V.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fe(he);return t.forEach(i=>{const s=new It(i,0),c=new It(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,c],d=>{n=n.add(d.wr)})}),V.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;X.isDocumentKey(s)||(s=s.child(""));const c=new It(new X(s),0);let d=new Fe(he);return this.br.forEachWhile(f=>{const m=f.key.path;return!!n.isPrefixOf(m)&&(m.length===i&&(d=d.add(f.wr)),!0)},c),V.resolve(this.Cr(d))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){ne(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return V.forEach(t.mutations,i=>{const s=new It(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new It(t,0),i=this.br.firstAfterOrEqual(n);return V.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return V.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ua{constructor(e){this.Mr=e,this.docs=new Me(X.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,c=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:c}),this.size+=c-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return V.resolve(n?n.document.mutableCopy():Ne.newInvalidDocument(t))}getEntries(e,t){let n=Pt();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Ne.newInvalidDocument(i))}),V.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Pt();const c=t.path,d=new X(c.child("")),f=this.docs.getIteratorFrom(d);for(;f.hasNext();){const{key:m,value:{document:y}}=f.getNext();if(!c.isPrefixOf(m.path))break;m.path.length>c.length+1||te(P(y),n)<=0||(i.has(y.key)||Di(t,y))&&(s=s.insert(y.key,y.mutableCopy()))}return V.resolve(s)}getAllFromCollectionGroup(e,t,n,i){Y()}Or(e,t){return V.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new ph(this)}getSize(e){return V.resolve(this.size)}}class ph extends Cc{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),V.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Ba{constructor(e){this.persistence=e,this.Nr=new Nn(t=>Jn(t),Ar),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ma,this.targetCount=0,this.kr=Nr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),V.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Nr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Kn(t),V.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach((c,d)=>{d.sequenceNumber<=t&&null===n.get(d.targetId)&&(this.Nr.delete(c),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),V.waitFor(s).next(()=>i)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return V.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),V.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(c=>{s.push(i.markPotentiallyOrphaned(e,c))}),V.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return V.resolve(n)}containsKey(e,t){return V.resolve(this.Br.containsKey(t))}}class qa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Lt(0),this.Kr=!1,this.Kr=!0,this.$r=new fh,this.referenceDelegate=e(this),this.Ur=new Ba(this),this.indexManager=new xa,this.remoteDocumentCache=new Ua(n=>this.referenceDelegate.Wr(n)),this.serializer=new uo(t),this.Gr=new hh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Fa(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){K("MemoryPersistence","Starting transaction:",e);const i=new Nc(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return V.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Nc extends Ce{constructor(e){super(),this.currentSequenceNumber=e}}class Eo{constructor(e){this.persistence=e,this.Jr=new Ma,this.Yr=null}static Zr(e){return new Eo(e)}get Xr(){if(this.Yr)return this.Yr;throw Y()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),V.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),V.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.Xr,n=>{const i=X.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,ue.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return V.or([()=>V.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class mh{constructor(e){this.serializer=e}O(e,t,n,i){const s=new At("createOrUpgrade",t);var f;n<1&&i>=1&&(e.createObjectStore("owner"),(f=e).createObjectStore("mutationQueues",{keyPath:"userId"}),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Je,{unique:!0}),f.createObjectStore("documentMutations"),gh(e),function(f){f.createObjectStore("remoteDocuments")}(e));let c=V.resolve();return n<3&&i>=3&&(0!==n&&(function(f){f.deleteObjectStore("targetDocuments"),f.deleteObjectStore("targets"),f.deleteObjectStore("targetGlobal")}(e),gh(e)),c=c.next(()=>function(f){const m=f.store("targetGlobal"),y={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ue.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",y)}(s))),n<4&&i>=4&&(0!==n&&(c=c.next(()=>function(f,m){return m.store("mutations").U().next(y=>{f.deleteObjectStore("mutations"),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Je,{unique:!0});const T=m.store("mutations"),R=y.map(O=>T.put(O));return V.waitFor(R)})}(e,s))),c=c.next(()=>{!function(f){f.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(c=c.next(()=>this.ni(s))),n<6&&i>=6&&(c=c.next(()=>(function(f){f.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(c=c.next(()=>this.ii(s))),n<8&&i>=8&&(c=c.next(()=>this.si(e,s))),n<9&&i>=9&&(c=c.next(()=>{!function(f){f.objectStoreNames.contains("remoteDocumentChanges")&&f.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(c=c.next(()=>this.oi(s))),n<11&&i>=11&&(c=c.next(()=>{(function(f){f.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(f){f.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(c=c.next(()=>{!function(f){const m=f.createObjectStore("documentOverlays",{keyPath:Xo});m.createIndex("collectionPathOverlayIndex",kl,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",ea,{unique:!1})}(e)})),n<13&&i>=13&&(c=c.next(()=>function(f){const m=f.createObjectStore("remoteDocumentsV14",{keyPath:Jo});m.createIndex("documentKeyIndex",Sl),m.createIndex("collectionGroupIndex",bl)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(c=c.next(()=>this.ai(e,s))),n<15&&i>=15&&(c=c.next(()=>function(f){f.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),f.createObjectStore("indexState",{keyPath:Vu}).createIndex("sequenceNumberIndex",ku,{unique:!1}),f.createObjectStore("indexEntries",{keyPath:Yo}).createIndex("documentKeyIndex",Si,{unique:!1})}(e))),n<16&&i>=16&&(c=c.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(c=c.next(()=>{!function(f){f.createObjectStore("globals",{keyPath:"name"})}(e)})),c}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Yi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>V.forEach(i,s=>{const c=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",c).next(d=>V.forEach(d,f=>{ne(f.userId===s.userId);const m=Mn(this.serializer,f);return Da(e,s.userId,m).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((c,d)=>{const f=new fe(c),m=[0,yt(f)];s.push(t.get(m).next(y=>y?V.resolve():t.put({targetId:0,path:yt(f),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>V.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Vl});const n=t.store("collectionParents"),i=new Va,s=c=>{if(i.add(c)){const d=c.lastSegment(),f=c.popLast();return n.put({collectionId:d,parent:yt(f)})}};return t.store("remoteDocuments").J({H:!0},(c,d)=>{const f=new fe(c);return s(f.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([c,d,f],m)=>{const y=yn(d);return s(y.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const s=$i(i),c=or(this.serializer,s);return t.put(c)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,c)=>{const d=t.store("remoteDocumentsV14"),f=(T=c,T.document?new X(fe.fromString(T.document.name).popFirst(5)):T.noDocument?X.fromSegments(T.noDocument.path):T.unknownDocument?X.fromSegments(T.unknownDocument.path):Y()).path.toArray(),m={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};var T;i.push(d.put(m))}).next(()=>V.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=xc(this.serializer),s=new qa(Eo.Zr,this.serializer.ct);return n.U().next(c=>{const d=new Map;return c.forEach(f=>{var m;let y=null!==(m=d.get(f.userId))&&void 0!==m?m:me();Mn(this.serializer,f).keys().forEach(T=>y=y.add(T)),d.set(f.userId,y)}),V.forEach(d,(f,m)=>{const y=new Le(m),T=lo.lt(this.serializer,y),R=s.getIndexManager(y),O=Xi.lt(y,this.serializer,R,s.referenceDelegate);return new La(i,O,T,R).recalculateAndSaveOverlaysForDocumentKeys(new zn(t,Lt.oe),f).next()})})}}function gh(r){r.createObjectStore("targetDocuments",{keyPath:xu}).createIndex("documentTargetsIndex",xl,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Cl,{unique:!0}),r.createObjectStore("targetGlobal")}const ns="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ao{constructor(e,t,n,i,s,c,d,f,m,y,T=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=c,this.document=d,this.ci=m,this.li=y,this.hi=T,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=R=>Promise.resolve(),!Ao.D())throw new j(U.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ah(this,i),this.Ai=t+"main",this.serializer=new uo(f),this.Ri=new _e(this.Ai,this.hi,new mh(this.serializer)),this.$r=new th,this.Ur=new ih(this.referenceDelegate,this.serializer),this.remoteDocumentCache=xc(this.serializer),this.Gr=new Pa,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===y&&Ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new j(U.FAILED_PRECONDITION,ns);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Lt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,q.Z)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,q.Z)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,q.Z)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>rs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(_n(e))return K("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return dr(e).get("owner").next(t=>V.resolve(this.vi(t)))}Ci(e){return rs(e).delete(this.clientId)}Fi(){var e=this;return(0,q.Z)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ht(n,"clientMetadata");return i.U().next(s=>{const c=e.xi(s,18e5),d=s.filter(f=>-1===c.indexOf(f));return V.forEach(d,f=>i.delete(f.clientId)).next(()=>d)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?V.resolve(!0):dr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new j(U.FAILED_PRECONDITION,ns);return!1}}return!(!this.networkEnabled||!this.inForeground)||rs(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&K("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,q.Z)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new zn(t,Lt.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>rs(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Xi.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ka(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lo.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){K("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(f=this.hi)?Dl:16===f?Du:15===f?ra:14===f?na:13===f?ta:12===f?Nl:11===f?Nu:void Y();var f;let c;return this.Ri.runTransaction(e,i,s,d=>(c=new zn(d,this.Qr?this.Qr.next():Lt.oe),"readwrite-primary"===t?this.wi(c).next(f=>!!f||this.Si(c)).next(f=>{if(!f)throw Ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new j(U.FAILED_PRECONDITION,de);return n(c)}).next(f=>this.Di(c).next(()=>f)):this.Ki(c).next(()=>n(c)))).then(d=>(c.raiseOnCommittedEvent(),d))}Ki(e){return dr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new j(U.FAILED_PRECONDITION,ns)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return dr(e).put("owner",t)}static D(){return _e.D()}bi(e){const t=dr(e);return t.get("owner").next(n=>this.vi(n)?(K("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):V.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Ge(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,ge.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return K("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Ge("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Ge("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function dr(r){return ht(r,"owner")}function rs(r){return ht(r,"clientMetadata")}function wo(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Ga{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=me(),i=me();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ga(e,t.fromCache,n,i)}}class _h{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Dc{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,ge.G6)()?8:Xt((0,ge.z$)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next(c=>{s.result=c}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(c=>{s.result=c})}).next(()=>{if(s.result)return;const c=new _h;return this.Xi(e,t,c).next(d=>{if(s.result=d,this.zi)return this.es(e,t,c,d.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(pt()<=Pe.in.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",er(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),V.resolve()):(pt()<=Pe.in.DEBUG&&K("QueryEngine","Query:",er(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(pt()<=Pe.in.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",er(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rt(t))):V.resolve())}Yi(e,t){if(Vi(t))return V.resolve(null);let n=Rt(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Gs(t,null,"F"),n=Rt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const c=me(...s);return this.Ji.getDocuments(e,c).next(d=>this.indexManager.getMinOffset(e,n).next(f=>{const m=this.ts(t,d);return this.ns(t,m,c,f.readTime)?this.Yi(e,Gs(t,null,"F")):this.rs(e,m,t,f)}))})))}Zi(e,t,n,i){return Vi(t)||i.isEqual(ue.min())?V.resolve(null):this.Ji.getDocuments(e,n).next(s=>{const c=this.ts(t,s);return this.ns(t,c,n,i)?V.resolve(null):(pt()<=Pe.in.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),er(t)),this.rs(e,c,t,x(i,-1)).next(d=>d))})}ts(e,t){let n=new Fe(Zu(e));return t.forEach((i,s)=>{Di(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return pt()<=Pe.in.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",er(t)),this.Ji.getDocumentsMatchingQuery(e,t,z.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(c=>{s=s.insert(c.key,c)}),s))}}class yh{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Me(he),this._s=new Nn(s=>Jn(s),Ar),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new La(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Oc(r,e,t,n){return new yh(r,e,t,n)}function za(r,e){return ja.apply(this,arguments)}function ja(){return(ja=(0,q.Z)(function*(r,e){const t=J(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const c=[],d=[];let f=me();for(const m of i){c.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}for(const m of s){d.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}return t.localDocuments.getDocuments(n,f).next(m=>({hs:m,removedBatchIds:c,addedBatchIds:d}))})})})).apply(this,arguments)}function Lc(r){const e=J(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function o(r,e,t){let n=me(),i=me();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let c=Pt();return t.forEach((d,f)=>{const m=s.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),f.isNoDocument()&&f.version.isEqual(ue.min())?(e.removeEntry(d,f.readTime),c=c.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),c=c.insert(d,f)):K("LocalStore","Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)}),{Ps:c,Is:i}})}function a(r,e){const t=J(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function h(r,e){const t=J(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,V.resolve(i)):t.Ur.allocateTargetId(n).next(c=>(i=new On(e,c,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function g(r,e,t){return I.apply(this,arguments)}function I(){return(I=(0,q.Z)(function*(r,e,t){const n=J(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,c=>n.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!_n(c))throw c;K("LocalStore",`Failed to update sequence numbers for target ${e}: ${c}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function b(r,e,t){const n=J(r);let i=ue.min(),s=me();return n.persistence.runTransaction("Execute query","readwrite",c=>function(f,m,y){const T=J(f),R=T._s.get(y);return void 0!==R?V.resolve(T.os.get(R)):T.Ur.getTargetData(m,y)}(n,c,Rt(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(c,d.targetId).next(f=>{s=f})}).next(()=>n.ss.getDocumentsMatchingQuery(c,e,t?i:ue.min(),t?s:me())).next(d=>(ie(n,zs(e),d),{documents:d,Ts:s})))}function F(r,e){const t=J(r),n=J(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(c=>c?c.target:null))}function $(r,e){const t=J(r),n=t.us.get(e)||ue.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,x(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ie(t,e,i),i))}function ie(r,e,t){let n=r.us.get(e)||ue.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function ve(){return(ve=(0,q.Z)(function*(r,e,t,n){const i=J(r);let s=me(),c=Pt();for(const m of t){const y=e.Es(m.metadata.name);m.document&&(s=s.add(y));const T=e.ds(m);T.setReadTime(e.As(m.metadata.readTime)),c=c.insert(y,T)}const d=i.cs.newChangeBuffer({trackRemovals:!0}),f=yield h(i,(y=n,Rt(Yn(fe.fromString(`__bundle__/docs/${y}`)))));var y;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>o(m,d,c).next(y=>(d.apply(m),y)).next(y=>i.Ur.removeMatchingKeysForTargetId(m,f.targetId).next(()=>i.Ur.addMatchingKeys(m,s,f.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,y.Ps,y.Is)).next(()=>y.Ps)))})).apply(this,arguments)}function Ft(r,e){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,q.Z)(function*(r,e,t=me()){const n=yield h(r,Rt(Zi(e.bundledQuery))),i=J(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const c=Xe(e.readTime);if(n.snapshotVersion.compareTo(c)>=0)return i.Gr.saveNamedQuery(s,e);const d=n.withResumeToken(nt.EMPTY_BYTE_STRING,c);return i.os=i.os.insert(d.targetId,d),i.Ur.updateTargetData(s,d).next(()=>i.Ur.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Ur.addMatchingKeys(s,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})})).apply(this,arguments)}function is(r,e){return`firestore_clients_${r}_${e}`}function Wa(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function ss(r,e){return`firestore_targets_${r}_${e}`}class os{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let s,c="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return c&&i.error&&(c="string"==typeof i.error.message&&"string"==typeof i.error.code,c&&(s=new j(i.error.code,i.error.message))),c?new os(e,t,i.state,s):(Ge("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class oi{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new j(n.error.code,n.error.message))),s?new oi(e,n.state,i):(Ge("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ai{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Mi();for(let c=0;i&&c<n.activeTargetIds.length;++c)i=bu(n.activeTargetIds[c]),s=s.add(n.activeTargetIds[c]);return i?new ai(e,s):(Ge("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ro{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ro(t.clientId,t.onlineState):(Ge("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Po{constructor(){this.activeTargetIds=Mi()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class as{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Me(he),this.started=!1,this.bs=[];const c=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=is(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new Po),this.Cs=new RegExp(`^firestore_clients_${c}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${c}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${c}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(f){return`firestore_bundle_loaded_v2_${f}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,q.Z)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const s=e.getItem(is(e.persistenceKey,i));if(s){const c=ai.Rs(i,s);c&&(e.Ss=e.Ss.insert(c.clientId,c))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(ss(this.persistenceKey,e));if(n){const i=oi.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ss(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return K("SharedClientState","READ",e,t),t}setItem(e,t){K("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){K("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(K("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void Ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,q.Z)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(c){let d=Lt.oe;if(null!=c)try{const f=JSON.parse(c);ne("number"==typeof f),d=f}catch(f){Ge("SharedClientState","Failed to read sequence number from WebStorage",f)}return d}(n.newValue);i!==Lt.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.eo(s)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new os(this.currentUser,e,t,n),s=Wa(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=Wa(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=ss(this.persistenceKey,e),s=new oi(e,t,n);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return ai.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return os.Rs(new Le(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return oi.Rs(i,t)}Ls(e){return Ro.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,q.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);K("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),c=[],d=[];return s.forEach(f=>{i.has(f)||c.push(f)}),i.forEach(f=>{s.has(f)||d.push(f)}),this.syncEngine.io(c,d).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Mi();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Ka{constructor(){this.so=new Po,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Po,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ih{_o(e){}shutdown(){}}class So{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){K("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){K("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let bo=null;function vh(){return null===bo?bo=268435456+Math.round(2147483648*Math.random()):bo++,"0x"+bo.toString(16)}const Xm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eg{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Ut="WebChannelConnection";class tg extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,c){const d=vh(),f=this.xo(t,n.toUriEncodedString());K("RestConnection",`Sending RPC '${t}' ${d}:`,f,i);const m={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(m,s,c),this.No(t,f,m,i).then(y=>(K("RestConnection",`Received RPC '${t}' ${d}: `,y),y),y=>{throw ot("RestConnection",`RPC '${t}' ${d} failed with error: `,y,"url: ",f,"request:",i),y})}Lo(t,n,i,s,c,d){return this.Mo(t,n,i,s,c)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+on,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,c)=>t[c]=s),i&&i.headers.forEach((s,c)=>t[c]=s)}xo(t,n){return`${this.Do}/v1/${n}:${Xm[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=vh();return new Promise((c,d)=>{const f=new sn;f.setWithCredentials(!0),f.listenOnce(Kt.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case _t.NO_ERROR:const y=f.getResponseJson();K(Ut,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(y)),c(y);break;case _t.TIMEOUT:K(Ut,`RPC '${e}' ${s} timed out`),d(new j(U.DEADLINE_EXCEEDED,"Request time out"));break;case _t.HTTP_ERROR:const T=f.getStatus();if(K(Ut,`RPC '${e}' ${s} failed with status:`,T,"response text:",f.getResponseText()),T>0){let R=f.getResponseJson();Array.isArray(R)&&(R=R[0]);const O=R?.error;if(O&&O.status&&O.message){const W=function(Z){const se=Z.toLowerCase().replace(/_/g,"-");return Object.values(U).indexOf(se)>=0?se:U.UNKNOWN}(O.status);d(new j(W,O.message))}else d(new j(U.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new j(U.UNAVAILABLE,"Connection failed."));break;default:Y()}}finally{K(Ut,`RPC '${e}' ${s} completed.`)}});const m=JSON.stringify(i);K(Ut,`RPC '${e}' ${s} sending request:`,i),f.send(t,"POST",m,n,15)})}Bo(e,t,n){const i=vh(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=Se(),d=Dt(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.xmlHttpFactory=new Ct({})),this.Oo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const y=s.join("");K(Ut,`Creating RPC '${e}' stream ${i}: ${y}`,f);const T=c.createWebChannel(y,f);let R=!1,O=!1;const W=new eg({Io:Z=>{O?K(Ut,`Not sending because RPC '${e}' stream ${i} is closed:`,Z):(R||(K(Ut,`Opening RPC '${e}' stream ${i} transport.`),T.open(),R=!0),K(Ut,`RPC '${e}' stream ${i} sending:`,Z),T.send(Z))},To:()=>T.close()}),Q=(Z,se,le)=>{Z.listen(se,oe=>{try{le(oe)}catch(pe){setTimeout(()=>{throw pe},0)}})};return Q(T,Et.EventType.OPEN,()=>{O||(K(Ut,`RPC '${e}' stream ${i} transport opened.`),W.yo())}),Q(T,Et.EventType.CLOSE,()=>{O||(O=!0,K(Ut,`RPC '${e}' stream ${i} transport closed`),W.So())}),Q(T,Et.EventType.ERROR,Z=>{O||(O=!0,ot(Ut,`RPC '${e}' stream ${i} transport errored:`,Z),W.So(new j(U.UNAVAILABLE,"The operation could not be completed")))}),Q(T,Et.EventType.MESSAGE,Z=>{var se;if(!O){const le=Z.data[0];ne(!!le);const pe=le.error||(null===(se=le[0])||void 0===se?void 0:se.error);if(pe){K(Ut,`RPC '${e}' stream ${i} received error:`,pe);const we=pe.status;let Ie=function(C){const N=rt[C];if(void 0!==N)return Ea(N)}(we),k=pe.message;void 0===Ie&&(Ie=U.INTERNAL,k="Unknown error status: "+we+" with message "+pe.message),O=!0,W.So(new j(Ie,k)),T.close()}else K(Ut,`RPC '${e}' stream ${i} received:`,le),W.bo(le)}}),Q(d,fn.STAT_EVENT,Z=>{Z.stat===ft.PROXY?K(Ut,`RPC '${e}' stream ${i} detected buffering proxy`):Z.stat===ft.NOPROXY&&K(Ut,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{W.wo()},0),W}}function Cf(){return typeof window<"u"?window:null}function Mc(){return typeof document<"u"?document:null}function $a(r){return new to(r,!0)}class Th{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&K("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class xf{constructor(e,t,n,i,s,c,d,f){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Th(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,q.Z)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,q.Z)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,q.Z)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===U.RESOURCE_EXHAUSTED?(Ge(t.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===U.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new j(U.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,q.Z)(function*(){e.state=0,e.start()}))}I_(e){return K("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(K("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ng extends xf{constructor(e,t,n,i,s,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,c),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function Zl(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:Y(),i=e.targetChange.targetIds||[],s=function(m,y){return m.useProto3Json?(ne(void 0===y||"string"==typeof y),nt.fromBase64String(y||"")):(ne(void 0===y||y instanceof Buffer||y instanceof Uint8Array),nt.fromUint8Array(y||new Uint8Array))}(r,e.targetChange.resumeToken),c=e.targetChange.cause,d=c&&function(m){const y=void 0===m.code?U.UNKNOWN:Ea(m.code);return new j(y,m.message||"")}(c);t=new ic(n,i,s,d||null)}else if("documentChange"in e){const n=e.documentChange,i=ln(r,n.document.name),s=Xe(n.document.updateTime),c=n.document.createTime?Xe(n.document.createTime):ue.min(),d=new vt({mapValue:{fields:n.document.fields}}),f=Ne.newFoundDocument(i,s,c,d);t=new Ys(n.targetIds||[],n.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const n=e.documentDelete,i=ln(r,n.document),s=n.readTime?Xe(n.readTime):ue.min(),c=Ne.newNoDocument(i,s);t=new Ys([],n.removedTargetIds||[],c.key,c)}else if("documentRemove"in e){const n=e.documentRemove,i=ln(r,n.document);t=new Ys([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return Y();{const n=e.filter,{count:i=0,unchangedNames:s}=n,c=new Ta(i,s);t=new at(n.targetId,c)}}var m;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return ue.min();const c=s.targetChange;return c.targetIds&&c.targetIds.length?ue.min():c.readTime?Xe(c.readTime):ue.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=lc(this.serializer),t.addTarget=function(s,c){let d;const f=c.target;if(d=Fs(f)?{documents:fc(s,f)}:{query:io(s,f)._t},d.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){d.resumeToken=ji(s,c.resumeToken);const m=no(s,c.expectedCount);null!==m&&(d.expectedCount=m)}else if(c.snapshotVersion.compareTo(ue.min())>0){d.readTime=wn(s,c.snapshotVersion.toTimestamp());const m=no(s,c.expectedCount);null!==m&&(d.expectedCount=m)}return d}(this.serializer,e);const n=function Hl(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=lc(this.serializer),t.removeTarget=e,this.a_(t)}}class rg extends xf{constructor(e,t,n,i,s,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,c),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ne(!!e.streamToken),this.lastStreamToken=e.streamToken,ne(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){ne(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function Ql(r,e){return r&&r.length>0?(ne(void 0!==e),r.map(t=>function(i,s){let c=Xe(i.updateTime?i.updateTime:s);return c.isEqual(ue.min())&&(c=Xe(s)),new wf(c,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Xe(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=lc(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Ki(this.serializer,n))};this.a_(t)}}class ig extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new j(U.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,c])=>this.connection.Mo(e,Wi(t,n),i,s,c)).catch(s=>{throw"FirebaseError"===s.name?(s.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new j(U.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,d])=>this.connection.Lo(e,Wi(t,n),i,c,d,s)).catch(c=>{throw"FirebaseError"===c.name?(c.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new j(U.UNKNOWN,c.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class sg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ge(t),this.D_=!1):K("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class og{constructor(e,t,n,i,s){var c=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(d=>{n.enqueueAndForget((0,q.Z)(function*(){var f;ui(c)&&(K("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,q.Z)(function*(y){const T=J(y);T.L_.add(4),yield Co(T),T.q_.set("Unknown"),T.L_.delete(4),yield Za(T)}),function m(y){return f.apply(this,arguments)})(c))}))}),this.q_=new sg(n,i)}}function Za(r){return Eh.apply(this,arguments)}function Eh(){return(Eh=(0,q.Z)(function*(r){if(ui(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Co(r){return Ah.apply(this,arguments)}function Ah(){return(Ah=(0,q.Z)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Fc(r,e){const t=J(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ph(t)?Rh(t):ko(t).r_()&&wh(t,e))}function xo(r,e){const t=J(r),n=ko(t);t.N_.delete(e),n.r_()&&Vf(t,e),0===t.N_.size&&(n.r_()?n.o_():ui(t)&&t.q_.set("Unknown"))}function wh(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ue.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ko(r).A_(e)}function Vf(r,e){r.Q_.xe(e),ko(r).R_(e)}function Rh(r){r.Q_=new zl({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),ko(r).start(),r.q_.v_()}function Ph(r){return ui(r)&&!ko(r).n_()&&r.N_.size>0}function ui(r){return 0===J(r).L_.size}function kf(r){r.Q_=void 0}function ag(r){return Sh.apply(this,arguments)}function Sh(){return(Sh=(0,q.Z)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function ug(r){return bh.apply(this,arguments)}function bh(){return(bh=(0,q.Z)(function*(r){r.N_.forEach((e,t)=>{wh(r,e)})})).apply(this,arguments)}function cg(r,e){return Ch.apply(this,arguments)}function Ch(){return(Ch=(0,q.Z)(function*(r,e){kf(r),Ph(r)?(r.q_.M_(e),Rh(r)):r.q_.set("Unknown")})).apply(this,arguments)}function lg(r,e,t){return xh.apply(this,arguments)}function xh(){return xh=(0,q.Z)(function*(r,e,t){if(r.q_.set("Online"),e instanceof ic&&2===e.state&&e.cause)try{yield(n=(0,q.Z)(function*(s,c){const d=c.cause;for(const f of c.targetIds)s.N_.has(f)&&(yield s.remoteSyncer.rejectListen(f,d),s.N_.delete(f),s.Q_.removeTarget(f))}),function i(s,c){return n.apply(this,arguments)})(r,e)}catch(n){K("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Uc(r,n)}else if(e instanceof Ys?r.Q_.Ke(e):e instanceof at?r.Q_.He(e):r.Q_.We(e),!t.isEqual(ue.min()))try{const n=yield Lc(r.localStore);t.compareTo(n)>=0&&(yield function(s,c){const d=s.Q_.rt(c);return d.targetChanges.forEach((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const y=s.N_.get(m);y&&s.N_.set(m,y.withResumeToken(f.resumeToken,c))}}),d.targetMismatches.forEach((f,m)=>{const y=s.N_.get(f);if(!y)return;s.N_.set(f,y.withResumeToken(nt.EMPTY_BYTE_STRING,y.snapshotVersion)),Vf(s,f);const T=new On(y.target,f,m,y.sequenceNumber);wh(s,T)}),s.remoteSyncer.applyRemoteEvent(d)}(r,t))}catch(n){K("RemoteStore","Failed to raise snapshot:",n),yield Uc(r,n)}var n}),xh.apply(this,arguments)}function Uc(r,e,t){return Vh.apply(this,arguments)}function Vh(){return(Vh=(0,q.Z)(function*(r,e,t){if(!_n(e))throw e;r.L_.add(1),yield Co(r),r.q_.set("Offline"),t||(t=()=>Lc(r.localStore)),r.asyncQueue.enqueueRetryable((0,q.Z)(function*(){K("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Za(r)}))})).apply(this,arguments)}function Nf(r,e){return e().catch(t=>Uc(r,t,e))}function Vo(r){return kh.apply(this,arguments)}function kh(){return(kh=(0,q.Z)(function*(r){const e=J(r),t=ci(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;hg(e);)try{const i=yield a(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,dg(e,i)}catch(i){yield Uc(e,i)}Df(e)&&Of(e)})).apply(this,arguments)}function hg(r){return ui(r)&&r.O_.length<10}function dg(r,e){r.O_.push(e);const t=ci(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Df(r){return ui(r)&&!ci(r).n_()&&r.O_.length>0}function Of(r){ci(r).start()}function fg(r){return Nh.apply(this,arguments)}function Nh(){return(Nh=(0,q.Z)(function*(r){ci(r).p_()})).apply(this,arguments)}function pg(r){return Dh.apply(this,arguments)}function Dh(){return(Dh=(0,q.Z)(function*(r){const e=ci(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function mg(r,e,t){return Oh.apply(this,arguments)}function Oh(){return(Oh=(0,q.Z)(function*(r,e,t){const n=r.O_.shift(),i=tc.from(n,e,t);yield Nf(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Vo(r)})).apply(this,arguments)}function gg(r,e){return Lh.apply(this,arguments)}function Lh(){return Lh=(0,q.Z)(function*(r,e){var t;e&&ci(r).V_&&(yield(t=(0,q.Z)(function*(i,s){if(Bi(d=s.code)&&d!==U.ABORTED){const c=i.O_.shift();ci(i).s_(),yield Nf(i,()=>i.remoteSyncer.rejectFailedWrite(c.batchId,s)),yield Vo(i)}var d}),function n(i,s){return t.apply(this,arguments)})(r,e)),Df(r)&&Of(r)}),Lh.apply(this,arguments)}function Lf(r,e){return Mh.apply(this,arguments)}function Mh(){return(Mh=(0,q.Z)(function*(r,e){const t=J(r);t.asyncQueue.verifyOperationInProgress(),K("RemoteStore","RemoteStore received new credentials");const n=ui(t);t.L_.add(3),yield Co(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Za(t)})).apply(this,arguments)}function Fh(r,e){return Uh.apply(this,arguments)}function Uh(){return(Uh=(0,q.Z)(function*(r,e){const t=J(r);e?(t.L_.delete(2),yield Za(t)):e||(t.L_.add(2),yield Co(t),t.q_.set("Unknown"))})).apply(this,arguments)}function ko(r){return r.K_||(r.K_=function(t,n,i){const s=J(t);return s.w_(),new ng(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:ag.bind(null,r),Ro:ug.bind(null,r),mo:cg.bind(null,r),d_:lg.bind(null,r)}),r.B_.push(function(){var e=(0,q.Z)(function*(t){t?(r.K_.s_(),Ph(r)?Rh(r):r.q_.set("Unknown")):(yield r.K_.stop(),kf(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function ci(r){return r.U_||(r.U_=function(t,n,i){const s=J(t);return s.w_(),new rg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:fg.bind(null,r),mo:gg.bind(null,r),f_:pg.bind(null,r),g_:mg.bind(null,r)}),r.B_.push(function(){var e=(0,q.Z)(function*(t){t?(r.U_.s_(),yield Vo(r)):(yield r.U_.stop(),r.O_.length>0&&(K("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Bh{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Be,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const c=Date.now()+n,d=new Bh(e,t,c,i,s);return d.start(n),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new j(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function No(r,e){if(Ge("AsyncQueue",`${e}: ${r}`),_n(r))return new j(U.UNAVAILABLE,`${e}: ${r}`);throw r}class Do{constructor(e){this.comparator=e?(t,n)=>e(t,n)||X.comparator(t.key,n.key):(t,n)=>X.comparator(t.key,n.key),this.keyedMap=Oi(),this.sortedSet=new Me(this.comparator)}static emptySet(e){return new Do(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Do)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Do;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Mf{constructor(){this.W_=new Me(X.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Y():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Oo{constructor(e,t,n,i,s,c,d,f,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=c,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,i,s){const c=[];return t.forEach(d=>{c.push({type:0,doc:d})}),new Oo(e,t,Do.emptySet(t),c,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class _g{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class yg{constructor(){this.queries=Ff(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=J(t),s=i.queries;i.queries=Ff(),s.forEach((c,d)=>{for(const f of d.j_)f.onError(n)})}(this,new j(U.ABORTED,"Firestore shutting down"))}}function Ff(){return new Nn(r=>fa(r),wr)}function qh(r,e){return Gh.apply(this,arguments)}function Gh(){return(Gh=(0,q.Z)(function*(r,e){const t=J(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new _g,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(c){const d=No(c,`Initialization of query '${er(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Wh(t)})).apply(this,arguments)}function zh(r,e){return jh.apply(this,arguments)}function jh(){return(jh=(0,q.Z)(function*(r,e){const t=J(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const c=s.j_.indexOf(e);c>=0&&(s.j_.splice(c,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Ig(r,e){const t=J(r);let n=!1;for(const i of e){const c=t.queries.get(i.query);if(c){for(const d of c.j_)d.X_(i)&&(n=!0);c.z_=i}}n&&Wh(t)}function vg(r,e,t){const n=J(r),i=n.queries.get(e);if(i)for(const s of i.j_)s.onError(t);n.queries.delete(e)}function Wh(r){r.Y_.forEach(e=>{e.next()})}var Kh,Uf;(Uf=Kh||(Kh={})).ea="default",Uf.Cache="cache";class $h{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Oo(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Oo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Kh.Cache}}class Tg{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class Bf{constructor(e){this.serializer=e}Es(e){return ln(this.serializer,e)}ds(e){return e.metadata.exists?dc(this.serializer,e.document,!1):Ne.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Xe(e)}}class Eg{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=qf(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=fe.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new Bf(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Es(i.metadata.name);for(const c of i.metadata.queries){const d=(t.get(c)||me()).add(s);t.set(c,d)}}return t}complete(){var e=this;return(0,q.Z)(function*(){const t=yield function ce(r,e,t,n){return ve.apply(this,arguments)}(e.localStore,new Bf(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield Ft(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function qf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Gf{constructor(e){this.key=e}}class zf{constructor(e){this.key=e}}class jf{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=me(),this.mutatedKeys=me(),this.Aa=Zu(e),this.Ra=new Do(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Mf,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,c=i,d=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((y,T)=>{const R=i.get(y),O=Di(this.query,T)?T:null,W=!!R&&this.mutatedKeys.has(R.key),Q=!!O&&(O.hasLocalMutations||this.mutatedKeys.has(O.key)&&O.hasCommittedMutations);let Z=!1;R&&O?R.data.isEqual(O.data)?W!==Q&&(n.track({type:3,doc:O}),Z=!0):this.ga(R,O)||(n.track({type:2,doc:O}),Z=!0,(f&&this.Aa(O,f)>0||m&&this.Aa(O,m)<0)&&(d=!0)):!R&&O?(n.track({type:0,doc:O}),Z=!0):R&&!O&&(n.track({type:1,doc:R}),Z=!0,(f||m)&&(d=!0)),Z&&(O?(c=c.add(O),s=Q?s.add(y):s.delete(y)):(c=c.delete(y),s=s.delete(y)))}),null!==this.query.limit)for(;c.size>this.query.limit;){const y="F"===this.query.limitType?c.last():c.first();c=c.delete(y.key),s=s.delete(y.key),n.track({type:1,doc:y})}return{Ra:c,fa:n,ns:d,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const c=e.fa.G_();c.sort((y,T)=>function(O,W){const Q=Z=>{switch(Z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y()}};return Q(O)-Q(W)}(y.type,T.type)||this.Aa(y.doc,T.doc)),this.pa(n),i=null!=i&&i;const d=t&&!i?this.ya():[],f=0===this.da.size&&this.current&&!i?1:0,m=f!==this.Ea;return this.Ea=f,0!==c.length||m?{snapshot:new Oo(this.query,e.Ra,s,c,e.mutatedKeys,0===f,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:d}:{wa:d}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Mf,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=me(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new zf(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Gf(n))}),t}ba(e){this.Ta=e.Ts,this.da=me();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Oo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Ag{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class wg{constructor(e){this.key=e,this.va=!1}}class Rg{constructor(e,t,n,i,s,c){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=c,this.Ca={},this.Fa=new Nn(d=>fa(d),wr),this.Ma=new Map,this.xa=new Set,this.Oa=new Me(X.comparator),this.Na=new Map,this.La=new Ma,this.Ba={},this.ka=new Map,this.qa=Nr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Pg(r,e){return Zh.apply(this,arguments)}function Zh(){return(Zh=(0,q.Z)(function*(r,e,t=!0){const n=Bc(r);let i;const s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Wf(n,e,t,!0),i})).apply(this,arguments)}function Sg(r,e){return Qh.apply(this,arguments)}function Qh(){return(Qh=(0,q.Z)(function*(r,e){const t=Bc(r);yield Wf(t,e,!0,!1)})).apply(this,arguments)}function Wf(r,e,t,n){return Hh.apply(this,arguments)}function Hh(){return(Hh=(0,q.Z)(function*(r,e,t,n){const i=yield h(r.localStore,Rt(e)),s=i.targetId,c=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let d;return n&&(d=yield Jh(r,e,s,"current"===c,i.resumeToken)),r.isPrimaryClient&&t&&Fc(r.remoteStore,i),d})).apply(this,arguments)}function Jh(r,e,t,n,i){return Yh.apply(this,arguments)}function Yh(){return Yh=(0,q.Z)(function*(r,e,t,n,i){r.Ka=(T,R,O)=>{return(W=(0,q.Z)(function*(Z,se,le,oe){let pe=se.view.ma(le);pe.ns&&(pe=yield b(Z.localStore,se.query,!1).then(({documents:E})=>se.view.ma(E,pe)));const we=oe&&oe.targetChanges.get(se.targetId),Ie=oe&&null!=oe.targetMismatches.get(se.targetId),k=se.view.applyChanges(pe,Z.isPrimaryClient,we,Ie);return cd(Z,se.targetId,k.wa),k.snapshot}),function Q(Z,se,le,oe){return W.apply(this,arguments)})(r,T,R,O);var W};const s=yield b(r.localStore,e,!0),c=new jf(e,s.Ts),d=c.ma(s.documents),f=Dn.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),m=c.applyChanges(d,r.isPrimaryClient,f);cd(r,t,m.wa);const y=new Ag(e,t,c);return r.Fa.set(e,y),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),m.snapshot}),Yh.apply(this,arguments)}function bg(r,e,t){return Xh.apply(this,arguments)}function Xh(){return(Xh=(0,q.Z)(function*(r,e,t){const n=J(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(c=>!wr(c,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield g(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&xo(n.remoteStore,i.targetId),Lo(n,i.targetId)}).catch(Te))):(Lo(n,i.targetId),yield g(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Cg(r,e){return ed.apply(this,arguments)}function ed(){return(ed=(0,q.Z)(function*(r,e){const t=J(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),xo(t.remoteStore,n.targetId))})).apply(this,arguments)}function td(){return(td=(0,q.Z)(function*(r,e,t){const n=vd(r);try{const i=yield function(c,d){const f=J(c),m=Ve.now(),y=d.reduce((O,W)=>O.add(W.key),me());let T,R;return f.persistence.runTransaction("Locally write mutations","readwrite",O=>{let W=Pt(),Q=me();return f.cs.getEntries(O,y).next(Z=>{W=Z,W.forEach((se,le)=>{le.isValidDocument()||(Q=Q.add(se))})}).next(()=>f.localDocuments.getOverlayedDocuments(O,W)).next(Z=>{T=Z;const se=[];for(const le of d){const oe=Pf(le,T.get(le.key).overlayedDocument);null!=oe&&se.push(new rr(le.key,oe,qu(oe.value.mapValue),Ye.exists(!0)))}return f.mutationQueue.addMutationBatch(O,m,se,d)}).next(Z=>{R=Z;const se=Z.applyToLocalDocumentSet(T,Q);return f.documentOverlayCache.saveOverlays(O,Z.batchId,se)})}).then(()=>({batchId:R.batchId,changes:js(T)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(c,d,f){let m=c.Ba[c.currentUser.toKey()];m||(m=new Me(he)),m=m.insert(d,f),c.Ba[c.currentUser.toKey()]=m}(n,i.batchId,t),yield Or(n,i.changes),yield Vo(n.remoteStore)}catch(i){const s=No(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Kf(r,e){return nd.apply(this,arguments)}function nd(){return(nd=(0,q.Z)(function*(r,e){const t=J(r);try{const n=yield function l(r,e){const t=J(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const c=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const d=[];e.targetChanges.forEach((y,T)=>{const R=i.get(T);if(!R)return;d.push(t.Ur.removeMatchingKeys(s,y.removedDocuments,T).next(()=>t.Ur.addMatchingKeys(s,y.addedDocuments,T)));let O=R.withSequenceNumber(s.currentSequenceNumber);var Q,Z,se;null!==e.targetMismatches.get(T)?O=O.withResumeToken(nt.EMPTY_BYTE_STRING,ue.min()).withLastLimboFreeSnapshotVersion(ue.min()):y.resumeToken.approximateByteSize()>0&&(O=O.withResumeToken(y.resumeToken,n)),i=i.insert(T,O),Z=O,se=y,(0===(Q=R).resumeToken.approximateByteSize()||Z.snapshotVersion.toMicroseconds()-Q.snapshotVersion.toMicroseconds()>=3e8||se.addedDocuments.size+se.modifiedDocuments.size+se.removedDocuments.size>0)&&d.push(t.Ur.updateTargetData(s,O))});let f=Pt(),m=me();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,y))}),d.push(o(s,c,e.documentUpdates).next(y=>{f=y.Ps,m=y.Is})),!n.isEqual(ue.min())){const y=t.Ur.getLastRemoteSnapshotVersion(s).next(T=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));d.push(y)}return V.waitFor(d).next(()=>c.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.os=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const c=t.Na.get(s);c&&(ne(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?c.va=!0:i.modifiedDocuments.size>0?ne(c.va):i.removedDocuments.size>0&&(ne(c.va),c.va=!1))}),yield Or(t,n,e)}catch(n){yield Te(n)}})).apply(this,arguments)}function $f(r,e,t){const n=J(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((s,c)=>{const d=c.view.Z_(e);d.snapshot&&i.push(d.snapshot)}),function(c,d){const f=J(c);f.onlineState=d;let m=!1;f.queries.forEach((y,T)=>{for(const R of T.j_)R.Z_(d)&&(m=!0)}),m&&Wh(f)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Vg(r,e,t){return rd.apply(this,arguments)}function rd(){return(rd=(0,q.Z)(function*(r,e,t){const n=J(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),s=i&&i.key;if(s){let c=new Me(X.comparator);c=c.insert(s,Ne.newNoDocument(s,ue.min()));const d=me().add(s),f=new zi(ue.min(),new Map,new Me(he),c,d);yield Kf(n,f),n.Oa=n.Oa.remove(s),n.Na.delete(e),ld(n)}else yield g(n.localStore,e,!1).then(()=>Lo(n,e,t)).catch(Te)})).apply(this,arguments)}function kg(r,e){return id.apply(this,arguments)}function id(){return(id=(0,q.Z)(function*(r,e){const t=J(r),n=e.batch.batchId;try{const i=yield function bf(r,e){const t=J(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(d,f,m,y){const T=m.batch,R=T.keys();let O=V.resolve();return R.forEach(W=>{O=O.next(()=>y.getEntry(f,W)).next(Q=>{const Z=m.docVersions.get(W);ne(null!==Z),Q.version.compareTo(Z)<0&&(T.applyToRemoteDocument(Q,m),Q.isValidDocument()&&(Q.setReadTime(m.commitVersion),y.addEntry(Q)))})}),O.next(()=>d.mutationQueue.removeMutationBatch(f,T))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(d){let f=me();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(f=f.add(d.batch.mutations[m].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);ud(t,n,null),ad(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Or(t,i)}catch(i){yield Te(i)}})).apply(this,arguments)}function Ng(r,e,t){return sd.apply(this,arguments)}function sd(){return(sd=(0,q.Z)(function*(r,e,t){const n=J(r);try{const i=yield function(c,d){const f=J(c);return f.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let y;return f.mutationQueue.lookupMutationBatch(m,d).next(T=>(ne(null!==T),y=T.keys(),f.mutationQueue.removeMutationBatch(m,T))).next(()=>f.mutationQueue.performConsistencyCheck(m)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(m,y,d)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,y)).next(()=>f.localDocuments.getDocuments(m,y))})}(n.localStore,e);ud(n,e,t),ad(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Or(n,i)}catch(i){yield Te(i)}})).apply(this,arguments)}function od(){return(od=(0,q.Z)(function*(r,e){const t=J(r);ui(t.remoteStore)||K("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(c){const d=J(c);return d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",f=>d.mutationQueue.getHighestUnacknowledgedBatchId(f))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=No(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function ad(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function ud(r,e,t){const n=J(r);let i=n.Ba[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function Lo(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Zf(r,n)})}function Zf(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(xo(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),ld(r))}function cd(r,e,t){for(const n of t)n instanceof Gf?(r.La.addReference(n.key,e),Og(r,n)):n instanceof zf?(K("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Zf(r,n.key)):Y()}function Og(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(K("SyncEngine","New document in limbo: "+t),r.xa.add(n),ld(r))}function ld(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new X(fe.fromString(e)),n=r.qa.next();r.Na.set(n,new wg(t)),r.Oa=r.Oa.insert(t,n),Fc(r.remoteStore,new On(Rt(Yn(t.path)),n,"TargetPurposeLimboResolution",Lt.oe))}}function Or(r,e,t){return hd.apply(this,arguments)}function hd(){return hd=(0,q.Z)(function*(r,e,t){const n=J(r),i=[],s=[],c=[];var d;n.Fa.isEmpty()||(n.Fa.forEach((d,f)=>{c.push(n.Ka(f,e,t).then(m=>{var y;if((m||t)&&n.isPrimaryClient){const T=m?!m.fromCache:null===(y=t?.targetChanges.get(f.targetId))||void 0===y?void 0:y.current;n.sharedClientState.updateQueryState(f.targetId,T?"current":"not-current")}if(m){i.push(m);const T=Ga.Wi(f.targetId,m);s.push(T)}}))}),yield Promise.all(c),n.Ca.d_(i),yield(d=(0,q.Z)(function*(m,y){const T=J(m);try{yield T.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>V.forEach(y,O=>V.forEach(O.$i,W=>T.persistence.referenceDelegate.addReference(R,O.targetId,W)).next(()=>V.forEach(O.Ui,W=>T.persistence.referenceDelegate.removeReference(R,O.targetId,W)))))}catch(R){if(!_n(R))throw R;K("LocalStore","Failed to update sequence numbers: "+R)}for(const R of y){const O=R.targetId;if(!R.fromCache){const W=T.os.get(O),Z=W.withLastLimboFreeSnapshotVersion(W.snapshotVersion);T.os=T.os.insert(O,Z)}}}),function f(m,y){return d.apply(this,arguments)})(n.localStore,s))}),hd.apply(this,arguments)}function Lg(r,e){return dd.apply(this,arguments)}function dd(){return(dd=(0,q.Z)(function*(r,e){const t=J(r);if(!t.currentUser.isEqual(e)){K("SyncEngine","User change. New user:",e.toKey());const n=yield za(t.localStore,e);t.currentUser=e,(s=t).ka.forEach(d=>{d.forEach(f=>{f.reject(new j(U.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Or(t,n.hs)}var s})).apply(this,arguments)}function Mg(r,e){const t=J(r),n=t.Na.get(e);if(n&&n.va)return me().add(n.key);{let i=me();const s=t.Ma.get(e);if(!s)return i;for(const c of s){const d=t.Fa.get(c);i=i.unionWith(d.view.Va)}return i}}function Fg(r,e){return fd.apply(this,arguments)}function fd(){return(fd=(0,q.Z)(function*(r,e){const t=J(r),n=yield b(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&cd(t,e.targetId,i.wa),i})).apply(this,arguments)}function Ug(r,e){return pd.apply(this,arguments)}function pd(){return(pd=(0,q.Z)(function*(r,e){const t=J(r);return $(t.localStore,e).then(n=>Or(t,n))})).apply(this,arguments)}function Bg(r,e,t,n){return md.apply(this,arguments)}function md(){return(md=(0,q.Z)(function*(r,e,t,n){const i=J(r),s=yield function(d,f){const m=J(d),y=J(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",T=>y.Mn(T,f).next(R=>R?m.localDocuments.getDocuments(T,R):V.resolve(null)))}(i.localStore,e);var f;null!==s?("pending"===t?yield Vo(i.remoteStore):"acknowledged"===t||"rejected"===t?(ud(i,e,n||null),ad(i,e),f=e,J(J(i.localStore).mutationQueue).On(f)):Y(),yield Or(i,s)):K("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function gd(){return(gd=(0,q.Z)(function*(r,e){const t=J(r);if(Bc(t),vd(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Qf(t,n.toArray());t.Qa=!0,yield Fh(t.remoteStore,!0);for(const s of i)Fc(t.remoteStore,s)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((s,c)=>{t.sharedClientState.isLocalQueryTarget(c)?n.push(c):i=i.then(()=>(Lo(t,c),g(t.localStore,c,!0))),xo(t.remoteStore,c)}),yield i,yield Qf(t,n),function(c){const d=J(c);d.Na.forEach((f,m)=>{xo(d.remoteStore,m)}),d.La.pr(),d.Na=new Map,d.Oa=new Me(X.comparator)}(t),t.Qa=!1,yield Fh(t.remoteStore,!1)}})).apply(this,arguments)}function Qf(r,e,t){return _d.apply(this,arguments)}function _d(){return(_d=(0,q.Z)(function*(r,e,t){const n=J(r),i=[],s=[];for(const c of e){let d;const f=n.Ma.get(c);if(f&&0!==f.length){d=yield h(n.localStore,Rt(f[0]));for(const m of f){const y=n.Fa.get(m),T=yield Fg(n,y);T.snapshot&&s.push(T.snapshot)}}else{const m=yield F(n.localStore,c);d=yield h(n.localStore,m),yield Jh(n,Hf(m),c,!1,d.resumeToken)}i.push(d)}return n.Ca.d_(s),i})).apply(this,arguments)}function Hf(r){return Bs(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Gg(r){return t=J(r).localStore,J(J(t).persistence).Qi();var t}function zg(r,e,t,n){return yd.apply(this,arguments)}function yd(){return(yd=(0,q.Z)(function*(r,e,t,n){const i=J(r);if(i.Qa)return void K("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const c=yield $(i.localStore,zs(s[0])),d=zi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,nt.EMPTY_BYTE_STRING);yield Or(i,c,d);break}case"rejected":yield g(i.localStore,e,!0),Lo(i,e,n);break;default:Y()}})).apply(this,arguments)}function jg(r,e,t){return Id.apply(this,arguments)}function Id(){return(Id=(0,q.Z)(function*(r,e,t){const n=Bc(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){K("SyncEngine","Adding an already active target "+i);continue}const s=yield F(n.localStore,i),c=yield h(n.localStore,s);yield Jh(n,Hf(s),c.targetId,!1,c.resumeToken),Fc(n.remoteStore,c)}for(const i of t)n.Ma.has(i)&&(yield g(n.localStore,i,!1).then(()=>{xo(n.remoteStore,i),Lo(n,i)}).catch(Te))}})).apply(this,arguments)}function Bc(r){const e=J(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vg.bind(null,e),e.Ca.d_=Ig.bind(null,e.eventManager),e.Ca.$a=vg.bind(null,e.eventManager),e}function vd(r){const e=J(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ng.bind(null,e),e}class Qa{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,q.Z)(function*(){t.serializer=$a(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Oc(this.persistence,new Dc,e.initialUser,this.serializer)}createPersistence(e){return new qa(Eo.Zr,this.serializer)}createSharedClientState(e){return new Ka}terminate(){var e=this;return(0,q.Z)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Td extends Qa{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,q.Z)(function*(){yield t().call(n,e),yield n.Wa.initialize(n,e),yield vd(n.Wa.syncEngine),yield Vo(n.Wa.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Oc(this.persistence,new Dc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new es(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new wl(t,this.persistence);return new Al(e.asyncQueue,n)}createPersistence(e){const t=wo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?St.withCacheSize(this.cacheSizeBytes):St.DEFAULT;return new Ao(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Cf(),Mc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ka}}class Jf extends Td{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,q.Z)(function*(){yield t().call(n,e);const i=n.Wa.syncEngine;n.sharedClientState instanceof as&&(n.sharedClientState.syncEngine={no:Bg.bind(null,i),ro:zg.bind(null,i),io:jg.bind(null,i),Qi:Gg.bind(null,i),eo:Ug.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var s=(0,q.Z)(function*(c){yield function qg(r,e){return gd.apply(this,arguments)}(n.Wa.syncEngine,c),n.gcScheduler&&(c&&!n.gcScheduler.started?n.gcScheduler.start():c||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(c&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():c||n.indexBackfillerScheduler.stop())});return function(c){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Cf();if(!as.D(t))throw new j(U.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=wo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new as(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Mo{initialize(e,t){var n=this;return(0,q.Z)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>$f(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Lg.bind(null,n.syncEngine),yield Fh(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new yg}createDatastore(e){const t=$a(e.databaseInfo.databaseId),n=new tg(e.databaseInfo);return new ig(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,c=t=>$f(this.syncEngine,t,0),d=So.D()?new So:new Ih,new og(n,i,s,c,d);var n,i,s,c,d}createSyncEngine(e,t){return function(i,s,c,d,f,m,y){const T=new Rg(i,s,c,d,f,m);return y&&(T.Qa=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,q.Z)(function*(){var t,n,i;yield(i=(0,q.Z)(function*(c){const d=J(c);K("RemoteStore","RemoteStore shutting down."),d.L_.add(5),yield Co(d),d.k_.shutdown(),d.q_.set("Unknown")}),function s(c){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function Yf(r,e=10240){let t=0;return{read:()=>(0,q.Z)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,q.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class qc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Ge("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class $g{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Be,this.buffer=new Uint8Array,this.Ha=new TextDecoder("utf-8"),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){var e=this;return(0,q.Z)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,q.Z)(function*(){return yield e.getMetadata(),e.Ja()})()}Ja(){var e=this;return(0,q.Z)(function*(){const t=yield e.Ya();if(null===t)return null;const n=e.Ha.decode(t),i=Number(n);isNaN(i)&&e.Za(`length string (${n}) is not valid number`);const s=yield e.Xa(i);return new Tg(JSON.parse(s),t.length+i)})()}eu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Ya(){var e=this;return(0,q.Z)(function*(){for(;e.eu()<0&&!(yield e.tu()););if(0===e.buffer.length)return null;const t=e.eu();t<0&&e.Za("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Xa(e){var t=this;return(0,q.Z)(function*(){for(;t.buffer.length<e;)(yield t.tu())&&t.Za("Reached the end of bundle when more is expected.");const n=t.Ha.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){var e=this;return(0,q.Z)(function*(){const t=yield e.ja.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Zg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,q.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new j(U.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,q.Z)(function*(c,d){const f=J(c),m={documents:d.map(O=>Sr(f.serializer,O))},y=yield f.Lo("BatchGetDocuments",f.serializer.databaseId,fe.emptyPath(),m,d.length),T=new Map;y.forEach(O=>{const W=function $l(r,e){return"found"in e?function(n,i){ne(!!i.found);const s=ln(n,i.found.name),c=Xe(i.found.updateTime),d=i.found.createTime?Xe(i.found.createTime):ue.min(),f=new vt({mapValue:{fields:i.found.fields}});return Ne.newFoundDocument(s,c,d,f)}(r,e):"missing"in e?function(n,i){ne(!!i.missing),ne(!!i.readTime);const s=ln(n,i.missing),c=Xe(i.readTime);return Ne.newNoDocument(s,c)}(r,e):Y()}(f.serializer,O);T.set(W.key.toString(),W)});const R=[];return d.forEach(O=>{const W=T.get(O.toString());ne(!!W),R.push(W)}),R}),function s(c,d){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new ni(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,q.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=X.fromPath(i);e.mutations.push(new ya(s,e.precondition(s)))}),yield(n=(0,q.Z)(function*(s,c){const d=J(s),f={writes:c.map(m=>Ki(d.serializer,m))};yield d.Mo("Commit",d.serializer.databaseId,fe.emptyPath(),f)}),function i(s,c){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Y();t=ue.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new j(U.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ue.min())?Ye.exists(!1):Ye.updateTime(t):Ye.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ue.min()))throw new j(U.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ye.updateTime(t)}return Ye.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Qg{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.nu=n.maxAttempts,this.t_=new Th(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){var e=this;this.t_.Go((0,q.Z)(function*(){const t=new Zg(e.datastore),n=e.su(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ou(s)}))}).catch(i=>{e.ou(i)})}))}su(e){try{const t=this.updateFunction(e);return!Wr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Bi(t)}return!1}}class Hg{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Le.UNAUTHENTICATED,this.clientId=zr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var c=(0,q.Z)(function*(d){K("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(K("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new j(U.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Be;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,q.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=No(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Gc(r,e){return Ed.apply(this,arguments)}function Ed(){return Ed=(0,q.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),K("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,q.Z)(function*(s){n.isEqual(s)||(yield za(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Ed.apply(this,arguments)}function Ad(r,e){return wd.apply(this,arguments)}function wd(){return(wd=(0,q.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Rd(r);K("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Lf(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Lf(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Xf(r){return"FirebaseError"===r.name?r.code===U.FAILED_PRECONDITION||r.code===U.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Rd(r){return Pd.apply(this,arguments)}function Pd(){return(Pd=(0,q.Z)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){K("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Gc(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Xf(t))throw t;ot("Error using user provided cache. Falling back to memory cache: "+t),yield Gc(r,new Qa)}}else K("FirestoreClient","Using default OfflineComponentProvider"),yield Gc(r,new Qa);return r._offlineComponents})).apply(this,arguments)}function zc(r){return Sd.apply(this,arguments)}function Sd(){return(Sd=(0,q.Z)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(K("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ad(r,r._uninitializedComponentsProvider._online)):(K("FirestoreClient","Using default OnlineComponentProvider"),yield Ad(r,new Mo))),r._onlineComponents})).apply(this,arguments)}function ep(r){return Rd(r).then(e=>e.persistence)}function Fo(r){return Rd(r).then(e=>e.localStore)}function tp(r){return zc(r).then(e=>e.remoteStore)}function bd(r){return zc(r).then(e=>e.syncEngine)}function Uo(r){return Cd.apply(this,arguments)}function Cd(){return(Cd=(0,q.Z)(function*(r){const e=yield zc(r),t=e.eventManager;return t.onListen=Pg.bind(null,e.syncEngine),t.onUnlisten=bg.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Sg.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Cg.bind(null,e.syncEngine),t})).apply(this,arguments)}function rp(r,e,t={}){const n=new Be;return r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return function(s,c,d,f,m){const y=new qc({next:R=>{c.enqueueAndForget(()=>zh(s,T));const O=R.docs.has(d);!O&&R.fromCache?m.reject(new j(U.UNAVAILABLE,"Failed to get document because the client is offline.")):O&&R.fromCache&&f&&"server"===f.source?m.reject(new j(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(R)},error:R=>m.reject(R)}),T=new $h(Yn(d.path),y,{includeMetadataChanges:!0,_a:!0});return qh(s,T)}(yield Uo(r),r.asyncQueue,e,t,n)})),n.promise}function ip(r,e,t={}){const n=new Be;return r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return function(s,c,d,f,m){const y=new qc({next:R=>{c.enqueueAndForget(()=>zh(s,T)),R.fromCache&&"server"===f.source?m.reject(new j(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(R)},error:R=>m.reject(R)}),T=new $h(d,y,{includeMetadataChanges:!0,_a:!0});return qh(s,T)}(yield Uo(r),r.asyncQueue,e,t,n)})),n.promise}function sp(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const op=new Map;function xd(r,e,t){if(!t)throw new j(U.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function ap(r,e,t,n){if(!0===e&&!0===n)throw new j(U.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function up(r){if(!X.isDocumentKey(r))throw new j(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function cp(r){if(X.isDocumentKey(r))throw new j(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function jc(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":Y()}function Ae(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new j(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=jc(r);throw new j(U.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function lp(r,e){if(e<=0)throw new j(U.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class hp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new j(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new j(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ap("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new j(U.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new j(U.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new j(U.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ha{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new j(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new j(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hp(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new vi;switch(n.type){case"firstParty":return new Gr(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new j(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=op.get(t);n&&(K("ComponentProvider","Removing Datastore"),op.delete(t),n.terminate())}(this),Promise.resolve()}}class xt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new xt(this.firestore,e,this._query)}}class et{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new et(this.firestore,e,this._key)}}class fr extends xt{constructor(e,t,n){super(e,t,Yn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new et(this.firestore,null,new X(e))}withConverter(e){return new fr(this.firestore,e,this._path)}}function fp(r,e,...t){if(r=(0,ge.m9)(r),xd("collection","path",e),r instanceof Ha){const n=fe.fromString(e,...t);return cp(n),new fr(r,null,n)}{if(!(r instanceof et||r instanceof fr))throw new j(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(fe.fromString(e,...t));return cp(n),new fr(r.firestore,null,n)}}function Wc(r,e,...t){if(r=(0,ge.m9)(r),1===arguments.length&&(e=zr.newId()),xd("doc","path",e),r instanceof Ha){const n=fe.fromString(e,...t);return up(n),new et(r,null,new X(n))}{if(!(r instanceof et||r instanceof fr))throw new j(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(fe.fromString(e,...t));return up(n),new et(r.firestore,r instanceof fr?r.converter:null,new X(n))}}function pp(r,e){return r=(0,ge.m9)(r),e=(0,ge.m9)(e),(r instanceof et||r instanceof fr)&&(e instanceof et||e instanceof fr)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Vd(r,e){return r=(0,ge.m9)(r),e=(0,ge.m9)(e),r instanceof xt&&e instanceof xt&&r.firestore===e.firestore&&wr(r._query,e._query)&&r.converter===e.converter}class c_{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Th(this,"async_queue_retry"),this.Eu=()=>{const t=Mc();t&&K("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=Mc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=Mc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new Be;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,q.Z)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!_n(t))throw t;K("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,Ge("INTERNAL UNHANDLED ERROR: ",function(c){let d=c.message||"";return c.stack&&(d=c.stack.includes(c.message)?c.stack:c.message+"\n"+c.stack),d}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const i=Bh.createAndSchedule(this,e,t,n,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&Y()}verifyOperationInProgress(){}mu(){var e=this;return(0,q.Z)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function kd(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class l_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Be,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class je extends Ha{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new c_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||mp(this),this._firestoreClient.terminate()}}function it(r){return r._firestoreClient||mp(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function mp(r){var e,t,n;const i=r._freezeSettings(),s=(f=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Ol(r._databaseId,f,r._persistenceKey,(y=i).host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,sp(y.experimentalLongPollingOptions),y.useFetchStreams));var f,y;r._firestoreClient=new Hg(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function gp(r,e,t){const n=new Be;return r.asyncQueue.enqueue((0,q.Z)(function*(){try{yield Gc(r,t),yield Ad(r,e),n.resolve()}catch(i){const s=i;if(!Xf(s))throw s;ot("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function _p(r){if(r._initialized||r._terminated)throw new j(U.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class pr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pr(nt.fromBase64String(e))}catch(t){throw new j(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new pr(nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Lr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new j(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class us{constructor(e){this._methodName=e}}class Kc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new j(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new j(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return he(this._lat,e._lat)||he(this._long,e._long)}}class $c{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const T_=/^__.*__$/;class E_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ui(e,this.data,t,this.fieldTransforms)}}class yp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ip(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y()}}class Zc{constructor(e,t,n,i,s,c){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=c||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Zc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Jc(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(Ip(this.wu)&&T_.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class A_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||$a(e)}Nu(e,t,n,i=!1){return new Zc({wu:e,methodName:t,Ou:n,path:ke.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cs(r){const e=r._freezeSettings(),t=$a(r._databaseId);return new A_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Qc(r,e,t,n,i,s={}){const c=r.Nu(s.merge||s.mergeFields?2:0,e,t,i);Ud("Data must be an object, but it was:",c,n);const d=Ep(n,c);let f,m;if(s.merge)f=new wt(c.fieldMask),m=c.fieldTransforms;else if(s.mergeFields){const y=[];for(const T of s.mergeFields){const R=Xa(e,T,t);if(!c.contains(R))throw new j(U.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);wp(y,R)||y.push(R)}f=new wt(y),m=c.fieldTransforms.filter(T=>f.covers(T.field))}else f=null,m=c.fieldTransforms;return new E_(new vt(d),f,m)}class Ya extends us{_toFieldTransform(e){if(2!==e.wu)throw e.Mu(1===e.wu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ya}}function vp(r,e,t){return new Zc({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Nd extends us{_toFieldTransform(e){return new Fi(e.path,new tr)}isEqual(e){return e instanceof Nd}}class Dd extends us{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=vp(this,e,!0),n=this.Lu.map(s=>ls(s,t)),i=new Rr(n);return new Fi(e.path,i)}isEqual(e){return e instanceof Dd&&(0,ge.vZ)(this.Lu,e.Lu)}}class Od extends us{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=vp(this,e,!0),n=this.Lu.map(s=>ls(s,t)),i=new nr(n);return new Fi(e.path,i)}isEqual(e){return e instanceof Od&&(0,ge.vZ)(this.Lu,e.Lu)}}class Ld extends us{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=new ei(e.serializer,Hu(e.serializer,this.Bu));return new Fi(e.path,t)}isEqual(e){return e instanceof Ld&&this.Bu===e.Bu}}function Md(r,e,t,n){const i=r.Nu(1,e,t);Ud("Data must be an object, but it was:",i,n);const s=[],c=vt.empty();jn(n,(f,m)=>{const y=Hc(e,f,t);m=(0,ge.m9)(m);const T=i.Cu(y);if(m instanceof Ya)s.push(y);else{const R=ls(m,T);null!=R&&(s.push(y),c.set(y,R))}});const d=new wt(s);return new yp(c,d,i.fieldTransforms)}function Fd(r,e,t,n,i,s){const c=r.Nu(1,e,t),d=[Xa(e,n,t)],f=[i];if(s.length%2!=0)throw new j(U.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let R=0;R<s.length;R+=2)d.push(Xa(e,s[R])),f.push(s[R+1]);const m=[],y=vt.empty();for(let R=d.length-1;R>=0;--R)if(!wp(m,d[R])){const O=d[R];let W=f[R];W=(0,ge.m9)(W);const Q=c.Cu(O);if(W instanceof Ya)m.push(O);else{const Z=ls(W,Q);null!=Z&&(m.push(O),y.set(O,Z))}}const T=new wt(m);return new yp(y,T,c.fieldTransforms)}function Tp(r,e,t,n=!1){return ls(t,r.Nu(n?4:3,e))}function ls(r,e){if(Ap(r=(0,ge.m9)(r)))return Ud("Unsupported field value:",e,r),Ep(r,e);if(r instanceof us)return function(n,i){if(!Ip(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,i){const s=[];let c=0;for(const d of n){let f=ls(d,i.Fu(c));null==f&&(f={nullValue:"NULL_VALUE"}),s.push(f),c++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ge.m9)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Hu(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=Ve.fromDate(n);return{timestampValue:wn(i.serializer,s)}}if(n instanceof Ve){const s=new Ve(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:wn(i.serializer,s)}}if(n instanceof Kc)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof pr)return{bytesValue:ji(i.serializer,n._byteString)};if(n instanceof et){const s=i.databaseId,c=n.firestore._databaseId;if(!c.isEqual(s))throw i.Mu(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ro(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof $c)return d=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(f=>{if("number"!=typeof f)throw d.Mu("VectorValues must only contain numeric values.");return ga(d.serializer,f)})}}}}};var d;throw i.Mu(`Unsupported field value: ${jc(n)}`)}(r,e)}function Ep(r,e){const t={};return Ou(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jn(r,(n,i)=>{const s=ls(i,e.bu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function Ap(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ve||r instanceof Kc||r instanceof pr||r instanceof et||r instanceof us||r instanceof $c)}function Ud(r,e,t){if(!Ap(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=jc(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var i}function Xa(r,e,t){if((e=(0,ge.m9)(e))instanceof Lr)return e._internalPath;if("string"==typeof e)return Hc(r,e);throw Jc("Field path arguments must be of type string or ",r,!1,void 0,t)}const w_=new RegExp("[~\\*/\\[\\]]");function Hc(r,e,t){if(e.search(w_)>=0)throw Jc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Lr(...e.split("."))._internalPath}catch{throw Jc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Jc(r,e,t,n,i){const s=n&&!n.isEmpty(),c=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(s||c)&&(f+=" (found",s&&(f+=` in field ${n}`),c&&(f+=` in document ${i}`),f+=")"),new j(U.INVALID_ARGUMENT,d+r+f)}function wp(r,e){return r.some(t=>t.isEqual(e))}class eu{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new et(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new R_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Yc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class R_ extends eu{data(){return super.data()}}function Yc(r,e){return"string"==typeof e?Hc(r,e):e instanceof Lr?e._internalPath:e._delegate._internalPath}function Rp(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new j(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bd{}class tu extends Bd{}function li(r,e,...t){let n=[];e instanceof Bd&&n.push(e),n=n.concat(t),function(s){const c=s.filter(f=>f instanceof Bo).length,d=s.filter(f=>f instanceof nu).length;if(c>1||c>0&&d>0)throw new j(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class nu extends tu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new nu(e,t,n)}_apply(e){const t=this._parse(e);return Cp(e._query,t),new xt(e.firestore,e.converter,Ni(e._query,t))}_parse(e){const t=cs(e.firestore);return function(s,c,d,f,m,y,T){let R;if(m.isKeyField()){if("array-contains"===y||"array-contains-any"===y)throw new j(U.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if("in"===y||"not-in"===y){bp(T,y);const O=[];for(const W of T)O.push(Sp(f,s,W));R={arrayValue:{values:O}}}else R=Sp(f,s,T)}else"in"!==y&&"not-in"!==y&&"array-contains-any"!==y||bp(T,y),R=Tp(d,"where",T,"in"===y||"not-in"===y);return Ee.create(m,y,R)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Bo extends Bd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Bo(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Oe.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let c=i;const d=s.getFlattenedFilters();for(const f of d)Cp(c,f),c=Ni(c,f)}(e._query,t),new xt(e.firestore,e.converter,Ni(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class qd extends tu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new qd(e,t)}_apply(e){const t=function(i,s,c){if(null!==i.startAt)throw new j(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new j(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Hr(s,c)}(e._query,this._field,this._direction);return new xt(e.firestore,e.converter,function(i,s){const c=i.explicitOrderBy.concat([s]);return new Zt(i.path,i.collectionGroup,c,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Xc extends tu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Xc(e,t,n)}_apply(e){return new xt(e.firestore,e.converter,Gs(e._query,this._limit,this._limitType))}}class el extends tu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new el(e,t,n)}_apply(e){const t=Pp(e,this.type,this._docOrFields,this._inclusive);return new xt(e.firestore,e.converter,(s=t,new Zt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class tl extends tu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new tl(e,t,n)}_apply(e){const t=Pp(e,this.type,this._docOrFields,this._inclusive);return new xt(e.firestore,e.converter,(s=t,new Zt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Pp(r,e,t,n){if(t[0]=(0,ge.m9)(t[0]),t[0]instanceof eu)return function(s,c,d,f,m){if(!f)throw new j(U.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${d}().`);const y=[];for(const T of Xn(s))if(T.field.isKeyField())y.push(Tr(c,f.key));else{const R=f.data.field(T.field);if($r(R))throw new j(U.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+T.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===R){const O=T.field.canonicalString();throw new j(U.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${O}' (used as the orderBy) does not exist.`)}y.push(R)}return new Qn(y,m)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=cs(r.firestore);return function(c,d,f,m,y,T){const R=c.explicitOrderBy;if(y.length>R.length)throw new j(U.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const O=[];for(let W=0;W<y.length;W++){const Q=y[W];if(R[W].field.isKeyField()){if("string"!=typeof Q)throw new j(U.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof Q}`);if(!ki(c)&&-1!==Q.indexOf("/"))throw new j(U.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${Q}' contains a slash.`);const Z=c.path.child(fe.fromString(Q));if(!X.isDocumentKey(Z))throw new j(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${Z}' is not because it contains an odd number of segments.`);const se=new X(Z);O.push(Tr(d,se))}else{const Z=Tp(f,m,Q);O.push(Z)}}return new Qn(O,T)}(r._query,r.firestore._databaseId,i,e,t,n)}}function Sp(r,e,t){if("string"==typeof(t=(0,ge.m9)(t))){if(""===t)throw new j(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ki(e)&&-1!==t.indexOf("/"))throw new j(U.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(fe.fromString(t));if(!X.isDocumentKey(n))throw new j(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Tr(r,new X(n))}if(t instanceof et)return Tr(r,t._key);throw new j(U.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jc(t)}.`)}function bp(r,e){if(!Array.isArray(r)||0===r.length)throw new j(U.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Cp(r,e){const t=function(i,s){for(const c of i)for(const d of c.getFlattenedFilters())if(s.indexOf(d.op)>=0)return d.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new j(U.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Gd{convertValue(e,t="none"){switch(vn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ze(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Y()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return jn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(c=>ze(c.doubleValue));return new $c(s)}convertGeoPoint(e){return new Kc(ze(e.latitude),ze(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Rs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(vr(e));default:return null}}convertTimestamp(e){const t=Vn(e);return new Ve(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=fe.fromString(e);ne(ao(n));const i=new In(n.get(1),n.get(3)),s=new X(n.popFirst(5));return i.isEqual(t)||Ge(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function nl(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class D_ extends Gd{constructor(e){super(),this.firestore=e}convertBytes(e){return new pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new et(this.firestore,null,t)}}class hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mr extends eu{constructor(e,t,n,i,s,c){super(e,t,n,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ru(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Yc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ru extends Mr{data(e={}){return super.data(e)}}class hi{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new hs(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ru(this._firestore,this._userDataWriter,n.key,n,new hs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new j(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map(d=>({type:"added",doc:new ru(i._firestore,i._userDataWriter,d.doc.key,d.doc,new hs(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:c++}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(d=>s||3!==d.type).map(d=>{const f=new ru(i._firestore,i._userDataWriter,d.doc.key,d.doc,new hs(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,y=-1;return 0!==d.type&&(m=c.indexOf(d.doc.key),c=c.delete(d.doc.key)),1!==d.type&&(c=c.add(d.doc),y=c.indexOf(d.doc.key)),{type:L_(d.type),doc:f,oldIndex:m,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function L_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y()}}function Vp(r,e){return r instanceof Mr&&e instanceof Mr?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof hi&&e instanceof hi&&r._firestore===e._firestore&&Vd(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class di extends Gd{constructor(e){super(),this.firestore=e}convertBytes(e){return new pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new et(this.firestore,null,t)}}function kp(r,e,t){r=Ae(r,et);const n=Ae(r.firestore,je),i=nl(r.converter,e,t);return qo(n,[Qc(cs(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Ye.none())])}function Np(r,e,t,...n){r=Ae(r,et);const i=Ae(r.firestore,je),s=cs(i);let c;return c="string"==typeof(e=(0,ge.m9)(e))||e instanceof Lr?Fd(s,"updateDoc",r._key,e,t,n):Md(s,"updateDoc",r._key,e),qo(i,[c.toMutation(r._key,Ye.exists(!0))])}function Dp(r,...e){var t,n,i;r=(0,ge.m9)(r);let s={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof e[c]||kd(e[c])||(s=e[c],c++);const d={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(kd(e[c])){const T=e[c];e[c]=null===(t=T.next)||void 0===t?void 0:t.bind(T),e[c+1]=null===(n=T.error)||void 0===n?void 0:n.bind(T),e[c+2]=null===(i=T.complete)||void 0===i?void 0:i.bind(T)}let f,m,y;if(r instanceof et)m=Ae(r.firestore,je),y=Yn(r._key.path),f={next:T=>{e[c]&&e[c](zd(m,r,T))},error:e[c+1],complete:e[c+2]};else{const T=Ae(r,xt);m=Ae(T.firestore,je),y=T._query;const R=new di(m);f={next:O=>{e[c]&&e[c](new hi(m,R,T,O))},error:e[c+1],complete:e[c+2]},Rp(r._query)}return function(R,O,W,Q){const Z=new qc(Q),se=new $h(O,Z,W);return R.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return qh(yield Uo(R),se)})),()=>{Z.za(),R.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return zh(yield Uo(R),se)}))}}(it(m),y,d,f)}function qo(r,e){return function(n,i){const s=new Be;return n.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return function xg(r,e,t){return td.apply(this,arguments)}(yield bd(n),i,s)})),s.promise}(it(r),e)}function zd(r,e,t){const n=t.docs.get(e._key),i=new di(r);return new Mr(r,i,e._key,n,new hs(t.hasPendingWrites,t.fromCache),e.converter)}const ey={maxAttempts:5};class Op{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cs(e)}set(e,t,n){this._verifyNotCommitted();const i=fi(e,this._firestore),s=nl(i.converter,t,n),c=Qc(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(c.toMutation(i._key,Ye.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=fi(e,this._firestore);let c;return c="string"==typeof(t=(0,ge.m9)(t))||t instanceof Lr?Fd(this._dataReader,"WriteBatch.update",s._key,t,n,i):Md(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(c.toMutation(s._key,Ye.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=fi(e,this._firestore);return this._mutations=this._mutations.concat(new ni(t._key,Ye.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new j(U.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fi(r,e){if((r=(0,ge.m9)(r)).firestore!==e)throw new j(U.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class ty extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=cs(t)}get(t){const n=fi(t,this._firestore),i=new D_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return Y();const c=s[0];if(c.isFoundDocument())return new eu(this._firestore,i,c.key,c,n.converter);if(c.isNoDocument())return new eu(this._firestore,i,n._key,null,n.converter);throw Y()})}set(t,n,i){const s=fi(t,this._firestore),c=nl(s.converter,n,i),d=Qc(this._dataReader,"Transaction.set",s._key,c,null!==s.converter,i);return this._transaction.set(s._key,d),this}update(t,n,i,...s){const c=fi(t,this._firestore);let d;return d="string"==typeof(n=(0,ge.m9)(n))||n instanceof Lr?Fd(this._dataReader,"Transaction.update",c._key,n,i,s):Md(this._dataReader,"Transaction.update",c._key,n),this._transaction.update(c._key,d),this}delete(t){const n=fi(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=fi(e,this._firestore),n=new di(this._firestore);return super.get(e).then(i=>new Mr(this._firestore,n,t._key,i._document,new hs(!1,!1),t.converter))}}function Wd(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new j("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Up(){if(typeof Uint8Array>"u")throw new j("unimplemented","Uint8Arrays are not available in this environment.")}function Bp(){if(!function ia(){return typeof atob<"u"}())throw new j("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){on=Qe.SDK_VERSION,(0,Qe._registerComponent)(new bn.wA("firestore",(n,{instanceIdentifier:i,options:s})=>{const c=n.getProvider("app").getImmediate(),d=new je(new _r(n.getProvider("auth-internal")),new Cn(n.getProvider("app-check-internal")),function(m,y){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new j(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new In(m.options.projectId,y)}(c,i),c);return s=Object.assign({useFetchStreams:t},s),d._setSettings(s),d},"PUBLIC").setMultipleInstances(!0)),(0,Qe.registerVersion)(be,"4.7.0",e),(0,Qe.registerVersion)(be,"4.7.0","esm2017")}();class iu{constructor(e){this._delegate=e}static fromBase64String(e){return Bp(),new iu(pr.fromBase64String(e))}static fromUint8Array(e){return Up(),new iu(pr.fromUint8Array(e))}toBase64(){return Bp(),this._delegate.toBase64()}toUint8Array(){return Up(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Kd(r){return function hy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class dy{enableIndexedDbPersistence(e,t){return function d_(r,e){_p(r=Ae(r,je));const t=it(r);if(t._uninitializedComponentsProvider)throw new j(U.FAILED_PRECONDITION,"SDK cache is already specified.");ot("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Mo;return gp(t,i,new Td(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function f_(r){_p(r=Ae(r,je));const e=it(r);if(e._uninitializedComponentsProvider)throw new j(U.FAILED_PRECONDITION,"SDK cache is already specified.");ot("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Mo;return gp(e,n,new Jf(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function p_(r){if(r._initialized&&!r._terminated)throw new j(U.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Be;return r._queue.enqueueAndForgetEvenWhileRestricted((0,q.Z)(function*(){try{yield(t=(0,q.Z)(function*(i){if(!_e.D())return Promise.resolve();const s=i+"main";yield _e.delete(s)}),function n(i){return t.apply(this,arguments)})(wo(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class qp{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof In||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ot("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function dp(r,e,t,n={}){var i;const s=(r=Ae(r,Ha))._getSettings(),c=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==c&&ot("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:c,ssl:!1})),n.mockUserToken){let d,f;if("string"==typeof n.mockUserToken)d=n.mockUserToken,f=Le.MOCK_USER;else{d=(0,ge.Sg)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new j(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Le(m)}r._authCredentials=new Ti(new Ii(d,f))}}(this._delegate,e,t,n)}enableNetwork(){return function g_(r){return function Jg(r){return r.asyncQueue.enqueue((0,q.Z)(function*(){const e=yield ep(r),t=yield tp(r);return e.setNetworkEnabled(!0),function(i){const s=J(i);return s.L_.delete(0),Za(s)}(t)}))}(it(r=Ae(r,je)))}(this._delegate)}disableNetwork(){return function __(r){return function Yg(r){return r.asyncQueue.enqueue((0,q.Z)(function*(){const e=yield ep(r),t=yield tp(r);return e.setNetworkEnabled(!1),(n=(0,q.Z)(function*(s){const c=J(s);c.L_.add(0),yield Co(c),c.q_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(it(r=Ae(r,je)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,ap("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function m_(r){return function(t){const n=new Be;return t.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return function Dg(r,e){return od.apply(this,arguments)}(yield bd(t),n)})),n.promise}(it(r=Ae(r,je)))}(this._delegate)}onSnapshotsInSync(e){return function W_(r,e){return function n_(r,e){const t=new qc(e);return r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return i=yield Uo(r),s=t,J(i).Y_.add(s),void s.next();var i,s})),()=>{t.za(),r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return i=yield Uo(r),s=t,void J(i).Y_.delete(s);var i,s}))}}(it(r=Ae(r,je)),kd(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new j("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Go(this,fp(this._delegate,e))}catch(t){throw Qt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Sn(this,Wc(this._delegate,e))}catch(t){throw Qt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ht(this,function u_(r,e){if(r=Ae(r,Ha),xd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new j(U.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new xt(r,null,(n=e,new Zt(fe.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Qt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function ny(r,e,t){r=Ae(r,je);const n=Object.assign(Object.assign({},ey),t);return function(s){if(s.maxAttempts<1)throw new j(U.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,c,d){const f=new Be;return s.asyncQueue.enqueueAndForget((0,q.Z)(function*(){const m=yield function np(r){return zc(r).then(e=>e.datastore)}(s);new Qg(s.asyncQueue,m,d,c,f).ru()})),f.promise}(it(r),i=>e(new ty(r,i)),n)}(this._delegate,t=>e(new Gp(this,t)))}batch(){return it(this._delegate),new zp(new Op(this._delegate,e=>qo(this._delegate,e)))}loadBundle(e){return function y_(r,e){const t=it(r=Ae(r,je)),n=new l_;return function r_(r,e,t,n){const i=function(c,d){let f;return f="string"==typeof c?rc().encode(c):c,y=function(y,T){if(y instanceof Uint8Array)return Yf(y,T);if(y instanceof ArrayBuffer)return Yf(new Uint8Array(y),T);if(y instanceof ReadableStream)return y.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(f),new $g(y,d);var y}(t,$a(e));r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){!function Wg(r,e,t){const n=J(r);var i;(i=(0,q.Z)(function*(c,d,f){try{const m=yield d.getMetadata();if(yield function(W,Q){const Z=J(W),se=Xe(Q.createTime);return Z.persistence.runTransaction("hasNewerBundle","readonly",le=>Z.Gr.getBundleMetadata(le,Q.id)).then(le=>!!le&&le.createTime.compareTo(se)>=0)}(c.localStore,m))return yield d.close(),f._completeWith({taskState:"Success",documentsLoaded:(W=m).totalDocuments,bytesLoaded:W.totalBytes,totalDocuments:W.totalDocuments,totalBytes:W.totalBytes}),Promise.resolve(new Set);f._updateProgress(qf(m));const y=new Eg(m,c.localStore,d.serializer);let T=yield d.Ua();for(;T;){const O=yield y.la(T);O&&f._updateProgress(O),T=yield d.Ua()}const R=yield y.complete();return yield Or(c,R.Ia,void 0),yield function(W,Q){const Z=J(W);return Z.persistence.runTransaction("Save bundle","readwrite",se=>Z.Gr.saveBundleMetadata(se,Q))}(c.localStore,m),f._completeWith(R.progress),Promise.resolve(R.Pa)}catch(m){return ot("SyncEngine",`Loading bundle failed with ${m}`),f._failWith(m),Promise.resolve(new Set)}var W}),function s(c,d,f){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield bd(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function I_(r,e){return function i_(r,e){return r.asyncQueue.enqueue((0,q.Z)(function*(){return function(n,i){const s=J(n);return s.persistence.runTransaction("Get named query","readonly",c=>s.Gr.getNamedQuery(c,i))}(yield Fo(r),e)}))}(it(r=Ae(r,je)),e).then(t=>t?new xt(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Ht(this,t):null)}}class il extends Gd{constructor(e){super(),this.firestore=e}convertBytes(e){return new iu(new pr(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Sn.forKey(t,this.firestore,null)}}class Gp{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new il(e)}get(e){const t=fs(e);return this._delegate.get(t).then(n=>new su(this._firestore,new Mr(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=fs(e);return n?(Wd("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}}class zp{constructor(e){this._delegate=e}set(e,t,n){const i=fs(e);return n?(Wd("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ds{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new ru(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ou(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=ds.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new ds(e,new il(e),t),i.set(t,s)),s}}ds.INSTANCES=new WeakMap;class Sn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new il(e)}static forPath(e,t,n){if(e.length%2!=0)throw new j("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Sn(t,new et(t._delegate,n,new X(e)))}static forKey(e,t,n){return new Sn(t,new et(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Go(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Go(this.firestore,fp(this._delegate,e))}catch(t){throw Qt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ge.m9)(e))instanceof et&&pp(this._delegate,e)}set(e,t){t=Wd("DocumentReference.set",t);try{return t?kp(this._delegate,e,t):kp(this._delegate,e)}catch(n){throw Qt(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Np(this._delegate,e):Np(this._delegate,e,t,...n)}catch(i){throw Qt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function z_(r){return qo(Ae(r.firestore,je),[new ni(r._key,Ye.none())])}(this._delegate)}onSnapshot(...e){const t=jp(e),n=Wp(e,i=>new su(this.firestore,new Mr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Dp(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function F_(r){r=Ae(r,et);const e=Ae(r.firestore,je),t=it(e),n=new di(e);return function Xg(r,e){const t=new Be;return r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return(n=(0,q.Z)(function*(s,c,d){try{const f=yield function(y,T){const R=J(y);return R.persistence.runTransaction("read document","readonly",O=>R.localDocuments.getDocument(O,T))}(s,c);f.isFoundDocument()?d.resolve(f):f.isNoDocument()?d.resolve(null):d.reject(new j(U.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(f){const m=No(f,`Failed to get document '${c} from cache`);d.reject(m)}}),function i(s,c,d){return n.apply(this,arguments)})(yield Fo(r),e,t);var n})),t.promise}(t,r._key).then(i=>new Mr(e,n,r._key,i,new hs(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function U_(r){r=Ae(r,et);const e=Ae(r.firestore,je);return rp(it(e),r._key,{source:"server"}).then(t=>zd(e,r,t))}(this._delegate):function M_(r){r=Ae(r,et);const e=Ae(r.firestore,je);return rp(it(e),r._key).then(t=>zd(e,r,t))}(this._delegate),t.then(n=>new su(this.firestore,new Mr(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new Sn(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function Qt(r,e,t){return r.message=r.message.replace(e,t),r}function jp(r){for(const e of r)if("object"==typeof e&&!Kd(e))return e;return{}}function Wp(r,e){var t,n;let i;return i=Kd(r[0])?r[0]:Kd(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class su{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Sn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Vp(this._delegate,e._delegate)}}class ou extends su{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Is(r,e){r||Y()}(void 0!==t),t}}class Ht{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new il(e)}where(e,t,n){try{return new Ht(this.firestore,li(this._delegate,function P_(r,e,t){const n=e,i=Yc("where",r);return nu._create(i,n,t)}(e,t,n)))}catch(i){throw Qt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ht(this.firestore,li(this._delegate,function S_(r,e="asc"){const t=e,n=Yc("orderBy",r);return qd._create(n,t)}(e,t)))}catch(n){throw Qt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ht(this.firestore,li(this._delegate,function b_(r){return lp("limit",r),Xc._create("limit",r,"F")}(e)))}catch(t){throw Qt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ht(this.firestore,li(this._delegate,function C_(r){return lp("limitToLast",r),Xc._create("limitToLast",r,"L")}(e)))}catch(t){throw Qt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ht(this.firestore,li(this._delegate,function x_(...r){return el._create("startAt",r,!0)}(...e)))}catch(t){throw Qt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ht(this.firestore,li(this._delegate,function V_(...r){return el._create("startAfter",r,!1)}(...e)))}catch(t){throw Qt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ht(this.firestore,li(this._delegate,function k_(...r){return tl._create("endBefore",r,!1)}(...e)))}catch(t){throw Qt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ht(this.firestore,li(this._delegate,function N_(...r){return tl._create("endAt",r,!0)}(...e)))}catch(t){throw Qt(t,"endAt()","Query.endAt()")}}isEqual(e){return Vd(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function q_(r){r=Ae(r,xt);const e=Ae(r.firestore,je),t=it(e),n=new di(e);return function e_(r,e){const t=new Be;return r.asyncQueue.enqueueAndForget((0,q.Z)(function*(){return(n=(0,q.Z)(function*(s,c,d){try{const f=yield b(s,c,!0),m=new jf(c,f.Ts),y=m.ma(f.documents),T=m.applyChanges(y,!1);d.resolve(T.snapshot)}catch(f){const m=No(f,`Failed to execute query '${c} against cache`);d.reject(m)}}),function i(s,c,d){return n.apply(this,arguments)})(yield Fo(r),e,t);var n})),t.promise}(t,r._query).then(i=>new hi(e,n,r,i))}(this._delegate):"server"===e?.source?function G_(r){r=Ae(r,xt);const e=Ae(r.firestore,je),t=it(e),n=new di(e);return ip(t,r._query,{source:"server"}).then(i=>new hi(e,n,r,i))}(this._delegate):function B_(r){r=Ae(r,xt);const e=Ae(r.firestore,je),t=it(e),n=new di(e);return Rp(r._query),ip(t,r._query).then(i=>new hi(e,n,r,i))}(this._delegate),t.then(n=>new $d(this.firestore,new hi(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=jp(e),n=Wp(e,i=>new $d(this.firestore,new hi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Dp(this._delegate,t,n)}withConverter(e){return new Ht(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}class py{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ou(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class $d{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ht(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ou(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new py(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new ou(this._firestore,n))})}isEqual(e){return Vp(this._delegate,e._delegate)}}class Go extends Ht{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Sn(this.firestore,e):null}doc(e){try{return new Sn(this.firestore,void 0===e?Wc(this._delegate):Wc(this._delegate,e))}catch(t){throw Qt(t,"doc()","CollectionReference.doc()")}}add(e){return function j_(r,e){const t=Ae(r.firestore,je),n=Wc(r),i=nl(r.converter,e);return qo(t,[Qc(cs(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,Ye.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new Sn(this.firestore,t))}isEqual(e){return pp(this._delegate,e._delegate)}withConverter(e){return new Go(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function fs(r){return Ae(r,et)}class Zd{constructor(...e){this._delegate=new Lr(...e)}static documentId(){return new Zd(ke.keyField().canonicalString())}isEqual(e){return(e=(0,ge.m9)(e))instanceof Lr&&this._delegate._internalPath.isEqual(e._internalPath)}}class ps{constructor(e){this._delegate=e}static serverTimestamp(){const e=function iy(){return new Nd("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ps(e)}static delete(){const e=function ry(){return new Ya("deleteField")}();return e._methodName="FieldValue.delete",new ps(e)}static arrayUnion(...e){const t=function sy(...r){return new Dd("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ps(t)}static arrayRemove(...e){const t=function oy(...r){return new Od("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ps(t)}static increment(e){const t=function ay(r){return new Ld("increment",r)}(e);return t._methodName="FieldValue.increment",new ps(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const my={Firestore:qp,GeoPoint:Kc,Timestamp:Ve,Blob:iu,Transaction:Gp,WriteBatch:zp,DocumentReference:Sn,DocumentSnapshot:su,Query:Ht,QueryDocumentSnapshot:ou,QuerySnapshot:$d,CollectionReference:Go,FieldPath:Zd,FieldValue:ps,setLogLevel:function fy(r){!function an(r){Ot.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function Kp(r,e){return function yy(r,e=Ze.z){return new We.y(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function Qd(r,e){return Kp(r,e).pipe((0,Nt.U)(t=>({payload:t,type:"query"})))}!function _y(r){(function gy(r,e){r.INTERNAL.registerComponent(new bn.wA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},my)))})(r,(e,t)=>new qp(e,t,new dy)),r.registerVersion("@firebase/firestore-compat","0.3.35")}(gr.Z),re(7142);class $p{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Jp(n,t);return new Hp(i,s,this.afs)}snapshotChanges(){return function Iy(r,e){return Kp(r,e).pipe((0,ct.O)(void 0),jt(),(0,Nt.U)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Nt.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,qe.D)(this.ref.get(e)).pipe(ye.iC)}}function sl(r,e){return Qd(r,e).pipe((0,ct.O)(void 0),jt(),(0,Nt.U)(t=>{const[n,i]=t,s=i.payload.docChanges(),c=s.map(d=>({type:d.type,payload:d}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((d,f)=>{const m=s.find(T=>T.doc.ref.isEqual(d.ref)),y=n?.payload.docs.find(T=>T.ref.isEqual(d.ref));m&&JSON.stringify(m.doc.metadata)===JSON.stringify(d.metadata)||!m&&y&&JSON.stringify(y.metadata)===JSON.stringify(d.metadata)||c.push({type:"modified",payload:{oldIndex:f,newIndex:f,type:"modified",doc:d}})}),c}))}function Zp(r,e,t){return sl(r,t).pipe((0,dn.R)((n,i)=>function vy(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function Ty(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return Hd(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Hd(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Hd(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,yi.x)(),(0,Nt.U)(n=>n.map(i=>({type:i.type,payload:i}))))}function Hd(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Qp(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Hp{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=sl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Nt.U)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,ct.O)(void 0),jt(),(0,nn.h)(([n,i])=>i.length>0||!n),(0,Nt.U)(([,n])=>n),ye.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,dn.R)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Qp(e);return Zp(this.query,t,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return Qd(this.query,this.afs.schedulers.outsideAngular).pipe((0,Nt.U)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),ye.iC)}get(e){return(0,qe.D)(this.query.get(e)).pipe(ye.iC)}add(e){return this.ref.add(e)}doc(e){return new $p(this.ref.doc(e),this.afs)}}class Ey{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?sl(this.query,this.afs.schedulers.outsideAngular).pipe((0,Nt.U)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,nn.h)(t=>t.length>0),ye.iC):sl(this.query,this.afs.schedulers.outsideAngular).pipe(ye.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,dn.R)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Qp(e);return Zp(this.query,t,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return Qd(this.query,this.afs.schedulers.outsideAngular).pipe((0,Nt.U)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),ye.iC)}get(e){return(0,qe.D)(this.query.get(e)).pipe(ye.iC)}}const Ay=new ae.OlP("angularfire2.enableFirestorePersistence"),wy=new ae.OlP("angularfire2.firestore.persistenceSettings"),Ry=new ae.OlP("angularfire2.firestore.settings"),Py=new ae.OlP("angularfire2.firestore.use-emulator");function Jp(r,e=(t=>t)){return{query:e(r),ref:r}}let Sy=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,c,d,f,m,y,T,R,O,W,Q,Z,se,le){this.schedulers=f;const oe=(0,Tt.on)(t,d,n),pe=y;T&&(0,ut.nw)(oe,d,R,W,Q,Z,O,se),[this.firestore,this.persistenceEnabled$]=(0,Tt.cc)(`${oe.name}.firestore`,"AngularFirestore",oe.name,()=>{const we=d.runOutsideAngular(()=>oe.firestore());if(s&&we.settings(s),pe&&we.useEmulator(...pe),i&&!(0,A.PM)(c)){const Ie=()=>{try{return(0,qe.D)(we.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(k){return typeof console<"u"&&console.warn(k),(0,bt.of)(!1)}};return[we,d.runOutsideAngular(Ie)]}return[we,(0,bt.of)(!1)]},[s,pe,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:c}=Jp(i,n),d=this.schedulers.ngZone.run(()=>s);return new Hp(d,c,this)}collectionGroup(t,n){const i=n||(c=>c),s=this.firestore.collectionGroup(t);return new Ey(i(s),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>n);return new $p(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(ae.LFG(Tt.Dh),ae.LFG(Tt.xv,8),ae.LFG(Ay,8),ae.LFG(Ry,8),ae.LFG(ae.Lbi),ae.LFG(ae.R0b),ae.LFG(ye.HU),ae.LFG(wy,8),ae.LFG(Py,8),ae.LFG(ut.zQ,8),ae.LFG(ut.Qv,8),ae.LFG(ut.L6,8),ae.LFG(ut._Q,8),ae.LFG(ut.rT,8),ae.LFG(ut.lh,8),ae.LFG(ut.f7,8),ae.LFG(ye.Rf,8))};static \u0275prov=ae.Yz7({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),by=(()=>{class r{constructor(t){this._AngularFirestore=t,this.userToken=localStorage.getItem("token"),this.status=new w.X(!1),this.email=new w.X("")}addNote(t){return t.id=this._AngularFirestore.createId(),this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/notes`).add(t)}getAllNotes(){return this.userToken=localStorage.getItem("token"),this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/notes`).snapshotChanges()}deleteNote(t){return this._AngularFirestore.doc(`users/${JSON.parse(this.userToken)}/notes/${t.id}`).delete()}updateNote(t){return this._AngularFirestore.doc(`users/${JSON.parse(this.userToken)}/notes/${t.id}`)}static#e=this.\u0275fac=function(n){return new(n||r)(ae.LFG(Sy))};static#t=this.\u0275prov=ae.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()},940:(Pu,mr,re)=>{re.d(mr,{d:()=>Tt});var w=re(8645),ae=re(4552);class A extends w.x{constructor(Ze=1/0,We=1/0,qe=ae.l){super(),this._bufferSize=Ze,this._windowTime=We,this._timestampProvider=qe,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=We===1/0,this._bufferSize=Math.max(1,Ze),this._windowTime=Math.max(1,We)}next(Ze){const{isStopped:We,_buffer:qe,_infiniteTimeWindow:bt,_timestampProvider:ct,_windowTime:lt}=this;We||(qe.push(Ze),!bt&&qe.push(ct.now()+lt)),this._trimBuffer(),super.next(Ze)}_subscribe(Ze){this._throwIfClosed(),this._trimBuffer();const We=this._innerSubscribe(Ze),{_infiniteTimeWindow:qe,_buffer:bt}=this,ct=bt.slice();for(let lt=0;lt<ct.length&&!Ze.closed;lt+=qe?1:2)Ze.next(ct[lt]);return this._checkFinalizedStatuses(Ze),We}_trimBuffer(){const{_bufferSize:Ze,_timestampProvider:We,_buffer:qe,_infiniteTimeWindow:bt}=this,ct=(bt?1:2)*Ze;if(Ze<1/0&&ct<qe.length&&qe.splice(0,qe.length-ct),!bt){const lt=We.now();let kt=0;for(let jt=1;jt<qe.length&&qe[jt]<=lt;jt+=2)kt=jt;kt&&qe.splice(0,kt+1)}}}var ye=re(3020);function Tt(ut,Ze,We){let qe,bt=!1;return ut&&"object"==typeof ut?({bufferSize:qe=1/0,windowTime:Ze=1/0,refCount:bt=!1,scheduler:We}=ut):qe=ut??1/0,(0,ye.B)({connector:()=>new A(qe,Ze,We),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:bt})}},981:(Pu,mr,re)=>{re.d(mr,{zQ:()=>gt,rT:()=>ge,f7:()=>H,L6:()=>bn,_Q:()=>Pe,lh:()=>rn,Qv:()=>Qe,nw:()=>st}),re(6365);var ae=re(6814),A=re(5879),ye=re(8326),Tt=re(7217),ut=re(8645),Ze=re(2096),We=re(5592),qe=re(2459),bt=re(3019),ct=re(3093),lt=re(4664),kt=re(7398),jt=re(940),Nt=re(1374),dn=re(4674);function yi(Ue,sn){return(0,dn.m)(sn)?(0,lt.w)(()=>Ue,sn):(0,lt.w)(()=>Ue)}var nn=re(5137),qr=re(2181);re(7142);const Qe=new A.OlP("angularfire2.auth.use-emulator"),bn=new A.OlP("angularfire2.auth.settings"),Pe=new A.OlP("angularfire2.auth.tenant-id"),ge=new A.OlP("angularfire2.auth.langugage-code"),rn=new A.OlP("angularfire2.auth.use-device-language"),H=new A.OlP("angularfire.auth.persistence"),st=(Ue,sn,Ct,Et,Kt,_t,ft,fn)=>(0,Tt.cc)(`${Ue.name}.auth`,"AngularFireAuth",Ue.name,()=>{const Dt=sn.runOutsideAngular(()=>Ue.auth());if(Ct&&Dt.useEmulator(...Ct),Et&&(Dt.tenantId=Et),Dt.languageCode=Kt,_t&&Dt.useDeviceLanguage(),ft)for(const[Se,be]of Object.entries(ft))Dt.settings[Se]=be;return fn&&Dt.setPersistence(fn),Dt},[Ct,Et,Kt,_t,ft,fn]);let gt=(()=>{class Ue{authState;idToken;user;idTokenResult;credential;constructor(Ct,Et,Kt,_t,ft,fn,Dt,Se,be,Le,on,Ot){const pt=new ut.x,an=(0,Ze.of)(void 0).pipe((0,ct.Q)(ft.outsideAngular),(0,lt.w)(()=>_t.runOutsideAngular(()=>Promise.resolve().then(re.bind(re,6365)))),(0,kt.U)(()=>(0,Tt.on)(Ct,_t,Et)),(0,kt.U)(K=>st(K,_t,fn,Se,be,Le,Dt,on)),(0,jt.d)({bufferSize:1,refCount:!1}));if((0,ae.PM)(Kt))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Ze.of)(null);else{an.pipe((0,Nt.P)()).subscribe();const K=an.pipe((0,lt.w)(xe=>xe.getRedirectResult().then(Y=>Y,()=>null)),ye.iC,(0,jt.d)({bufferSize:1,refCount:!1})),Ge=an.pipe((0,lt.w)(xe=>new We.y(Y=>({unsubscribe:_t.runOutsideAngular(()=>xe.onAuthStateChanged(ne=>Y.next(ne),ne=>Y.error(ne),()=>Y.complete()))})))),ot=an.pipe((0,lt.w)(xe=>new We.y(Y=>({unsubscribe:_t.runOutsideAngular(()=>xe.onIdTokenChanged(ne=>Y.next(ne),ne=>Y.error(ne),()=>Y.complete()))}))));this.authState=K.pipe(yi(Ge),(0,nn.R)(ft.outsideAngular),(0,ct.Q)(ft.insideAngular)),this.user=K.pipe(yi(ot),(0,nn.R)(ft.outsideAngular),(0,ct.Q)(ft.insideAngular)),this.idToken=this.user.pipe((0,lt.w)(xe=>xe?(0,qe.D)(xe.getIdToken()):(0,Ze.of)(null))),this.idTokenResult=this.user.pipe((0,lt.w)(xe=>xe?(0,qe.D)(xe.getIdTokenResult()):(0,Ze.of)(null))),this.credential=(0,bt.T)(K,pt,this.authState.pipe((0,qr.h)(xe=>!xe))).pipe((0,kt.U)(xe=>xe?.user?xe:null),(0,nn.R)(ft.outsideAngular),(0,ct.Q)(ft.insideAngular))}return(0,Tt.pX)(this,an,_t,{spy:{apply:(K,Ge,ot)=>{(K.startsWith("signIn")||K.startsWith("createUser"))&&ot.then(xe=>pt.next(xe))}}})}static \u0275fac=function(Et){return new(Et||Ue)(A.LFG(Tt.Dh),A.LFG(Tt.xv,8),A.LFG(A.Lbi),A.LFG(A.R0b),A.LFG(ye.HU),A.LFG(Qe,8),A.LFG(bn,8),A.LFG(Pe,8),A.LFG(ge,8),A.LFG(rn,8),A.LFG(H,8),A.LFG(ye.Rf,8))};static \u0275prov=A.Yz7({token:Ue,factory:Ue.\u0275fac,providedIn:"any"})}return Ue})()},6365:(Pu,mr,re)=>{re.r(mr);var w=re(5861),ae=re(3106),A=re(8398),ye=re(9058),Ze=(re(534),re(7879),re(4537));function We(){return window}function ct(){return ct=(0,w.Z)(function*(B,x,P){var z;const{BuildInfo:te}=We();(0,A.au)(x.sessionId,"AuthEvent did not contain a session ID");const de=yield function nn(B){return qr.apply(this,arguments)}(x.sessionId),Ce={};return(0,A.av)()?Ce.ibi=te.packageName:(0,A.aw)()?Ce.apn=te.packageName:(0,A.ax)(B,"operation-not-supported-in-this-environment"),te.displayName&&(Ce.appDisplayName=te.displayName),Ce.sessionId=de,(0,A.ay)(B,P,x.type,void 0,null!==(z=x.eventId)&&void 0!==z?z:void 0,Ce)}),ct.apply(this,arguments)}function kt(){return(kt=(0,w.Z)(function*(B){const{BuildInfo:x}=We(),P={};(0,A.av)()?P.iosBundleId=x.packageName:(0,A.aw)()?P.androidPackageName=x.packageName:(0,A.ax)(B,"operation-not-supported-in-this-environment"),yield(0,A.az)(B,P)})).apply(this,arguments)}function dn(){return(dn=(0,w.Z)(function*(B,x,P){const{cordova:z}=We();let te=()=>{};try{yield new Promise((de,Ce)=>{let Te=null;function He(){var _e;de();const Xt=null===(_e=z.plugins.browsertab)||void 0===_e?void 0:_e.close;"function"==typeof Xt&&Xt(),"function"==typeof P?.close&&P.close()}function V(){Te||(Te=window.setTimeout(()=>{Ce((0,A.aB)(B,"redirect-cancelled-by-user"))},2e3))}function At(){"visible"===document?.visibilityState&&V()}x.addPassiveListener(He),document.addEventListener("resume",V,!1),(0,A.aw)()&&document.addEventListener("visibilitychange",At,!1),te=()=>{x.removePassiveListener(He),document.removeEventListener("resume",V,!1),document.removeEventListener("visibilitychange",At,!1),Te&&window.clearTimeout(Te)}})}finally{te()}})).apply(this,arguments)}function qr(){return(qr=(0,w.Z)(function*(B){const x=function gr(B){if((0,A.au)(/[0-9a-zA-Z]+/.test(B),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(B);const x=new ArrayBuffer(B.length),P=new Uint8Array(x);for(let z=0;z<B.length;z++)P[z]=B.charCodeAt(z);return P}(B),P=yield crypto.subtle.digest("SHA-256",x);return Array.from(new Uint8Array(P)).map(te=>te.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class Qe extends A.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(x=>{this.resolveInitialized=x})}addPassiveListener(x){this.passiveListeners.add(x)}removePassiveListener(x){this.passiveListeners.delete(x)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(x){return this.resolveInitialized(),this.passiveListeners.forEach(P=>P(x)),super.onEvent(x)}initialized(){var x=this;return(0,w.Z)(function*(){yield x.initPromise})()}}function ge(B){return rn.apply(this,arguments)}function rn(){return(rn=(0,w.Z)(function*(B){const x=yield gt()._get(Wt(B));return x&&(yield gt()._remove(Wt(B))),x})).apply(this,arguments)}function st(){const B=[];for(let P=0;P<20;P++){const z=Math.floor(62*Math.random());B.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(z))}return B.join("")}function gt(){return(0,A.aE)(A.b)}function Wt(B){return(0,A.aF)("authEvent",B.config.apiKey,B.name)}function Ct(B){if(!B?.includes("?"))return{};const[x,...P]=B.split("?");return(0,ye.zd)(P.join("?"))}const _t=class Kt{constructor(){this._redirectPersistence=A.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=A.aG,this._overrideRedirectResult=A.aH}_initialize(x){var P=this;return(0,w.Z)(function*(){const z=x._key();let te=P.eventManagers.get(z);return te||(te=new Qe(x),P.eventManagers.set(z,te),P.attachCallbackListeners(x,te)),te})()}_openPopup(x){(0,A.ax)(x,"operation-not-supported-in-this-environment")}_openRedirect(x,P,z,te){var de=this;return(0,w.Z)(function*(){!function yi(B){var x,P,z,te,de,Ce,Te,He,V,At;const _e=We();(0,A.aC)("function"==typeof(null===(x=_e?.universalLinks)||void 0===x?void 0:x.subscribe),B,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,A.aC)(typeof(null===(P=_e?.BuildInfo)||void 0===P?void 0:P.packageName)<"u",B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,A.aC)("function"==typeof(null===(de=null===(te=null===(z=_e?.cordova)||void 0===z?void 0:z.plugins)||void 0===te?void 0:te.browsertab)||void 0===de?void 0:de.openUrl),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,A.aC)("function"==typeof(null===(He=null===(Te=null===(Ce=_e?.cordova)||void 0===Ce?void 0:Ce.plugins)||void 0===Te?void 0:Te.browsertab)||void 0===He?void 0:He.isAvailable),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,A.aC)("function"==typeof(null===(At=null===(V=_e?.cordova)||void 0===V?void 0:V.InAppBrowser)||void 0===At?void 0:At.open),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(x);const Ce=yield de._initialize(x);yield Ce.initialized(),Ce.resetRedirect(),(0,A.aI)(),yield de._originValidation(x);const Te=function bn(B,x,P=null){return{type:x,eventId:P,urlResponse:null,sessionId:st(),postBody:null,tenantId:B.tenantId,error:(0,A.aB)(B,"no-auth-event")}}(x,z,te);yield function Pe(B,x){return gt()._set(Wt(B),x)}(x,Te);const He=yield function bt(B,x,P){return ct.apply(this,arguments)}(x,Te,P),V=yield function jt(B){const{cordova:x}=We();return new Promise(P=>{x.plugins.browsertab.isAvailable(z=>{let te=null;z?x.plugins.browsertab.openUrl(B):te=x.InAppBrowser.open(B,(0,A.aA)()?"_blank":"_system","location=yes"),P(te)})})}(He);return function Nt(B,x,P){return dn.apply(this,arguments)}(x,Ce,V)})()}_isIframeWebStorageSupported(x,P){throw new Error("Method not implemented.")}_originValidation(x){const P=x._key();return this.originValidationPromises[P]||(this.originValidationPromises[P]=function lt(B){return kt.apply(this,arguments)}(x)),this.originValidationPromises[P]}attachCallbackListeners(x,P){const{universalLinks:z,handleOpenURL:te,BuildInfo:de}=We(),Ce=setTimeout((0,w.Z)(function*(){yield ge(x),P.onEvent(ft())}),500),Te=function(){var At=(0,w.Z)(function*(_e){clearTimeout(Ce);const Xt=yield ge(x);let Ai=null;Xt&&_e?.url&&(Ai=function H(B,x){var P,z;const te=function sn(B){const x=Ct(B),P=x.link?decodeURIComponent(x.link):void 0,z=Ct(P).link,te=x.deep_link_id?decodeURIComponent(x.deep_link_id):void 0;return Ct(te).link||te||z||P||B}(x);if(te.includes("/__/auth/callback")){const de=Ct(te),Ce=de.firebaseError?function Ue(B){try{return JSON.parse(B)}catch{return null}}(decodeURIComponent(de.firebaseError)):null,Te=null===(z=null===(P=Ce?.code)||void 0===P?void 0:P.split("auth/"))||void 0===z?void 0:z[1],He=Te?(0,A.aB)(Te):null;return He?{type:B.type,eventId:B.eventId,tenantId:B.tenantId,error:He,urlResponse:null,sessionId:null,postBody:null}:{type:B.type,eventId:B.eventId,tenantId:B.tenantId,sessionId:B.sessionId,urlResponse:te,postBody:null}}return null}(Xt,_e.url)),P.onEvent(Ai||ft())});return function(Xt){return At.apply(this,arguments)}}();typeof z<"u"&&"function"==typeof z.subscribe&&z.subscribe(null,Te);const He=te,V=`${de.packageName.toLowerCase()}://`;We().handleOpenURL=function(){var At=(0,w.Z)(function*(_e){if(_e.toLowerCase().startsWith(V)&&Te({url:_e}),"function"==typeof He)try{He(_e)}catch(Xt){console.error(Xt)}});return function(_e){return At.apply(this,arguments)}}()}};function ft(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,A.aB)("no-auth-event")}}function Le(){var B;return(null===(B=self?.location)||void 0===B?void 0:B.protocol)||null}function Ot(B=(0,ye.z$)()){return!("file:"!==Le()&&"ionic:"!==Le()&&"capacitor:"!==Le()||!B.toLowerCase().match(/iphone|ipad|ipod|android/))}function ot(){try{const B=self.localStorage,x=A.aN();if(B)return B.setItem(x,"1"),B.removeItem(x),!function Ge(B=(0,ye.z$)()){return function an(){return(0,ye.w1)()&&11===document?.documentMode}()||function K(B=(0,ye.z$)()){return/Edge\/\d+/.test(B)}(B)}()||(0,ye.hl)()}catch{return xe()&&(0,ye.hl)()}return!1}function xe(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Y(){return(function on(){return"http:"===Le()||"https:"===Le()}()||(0,ye.ru)()||Ot())&&!function pt(){return(0,ye.b$)()||(0,ye.UG)()}()&&ot()&&!xe()}function ne(){return Ot()&&typeof document<"u"}function J(){return(J=(0,w.Z)(function*(){return!!ne()&&new Promise(B=>{const x=setTimeout(()=>{B(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(x),B(!0)})})})).apply(this,arguments)}const j={LOCAL:"local",NONE:"none",SESSION:"session"},Be=A.aC,Ii="persistence";function Ti(B){return _r.apply(this,arguments)}function _r(){return(_r=(0,w.Z)(function*(B){yield B._initializationPromise;const x=Gr(),P=A.aF(Ii,B.config.apiKey,B.name);x&&x.setItem(P,B._getPersistence())})).apply(this,arguments)}function Gr(){var B;try{return(null===(B=function U(){return typeof window<"u"?window:null}())||void 0===B?void 0:B.sessionStorage)||null}catch{return null}}const qn=A.aC;class Cn{constructor(){this.browserResolver=A.aE(A.k),this.cordovaResolver=A.aE(_t),this.underlyingResolver=null,this._redirectPersistence=A.a,this._completeRedirectFn=A.aG,this._overrideRedirectResult=A.aH}_initialize(x){var P=this;return(0,w.Z)(function*(){return yield P.selectUnderlyingResolver(),P.assertedUnderlyingResolver._initialize(x)})()}_openPopup(x,P,z,te){var de=this;return(0,w.Z)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openPopup(x,P,z,te)})()}_openRedirect(x,P,z,te){var de=this;return(0,w.Z)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openRedirect(x,P,z,te)})()}_isIframeWebStorageSupported(x,P){this.assertedUnderlyingResolver._isIframeWebStorageSupported(x,P)}_originValidation(x){return this.assertedUnderlyingResolver._originValidation(x)}get _shouldInitProactively(){return ne()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return qn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var x=this;return(0,w.Z)(function*(){if(x.underlyingResolver)return;const P=yield function Is(){return J.apply(this,arguments)}();x.underlyingResolver=P?x.cordovaResolver:x.browserResolver})()}}function $o(B){return B.unwrap()}function zr(B){return pn(B)}function pn(B){const{_tokenResponse:x}=B instanceof ye.ZR?B.customData:B;if(!x)return null;if(!(B instanceof ye.ZR)&&"temporaryProof"in x&&"phoneNumber"in x)return A.P.credentialFromResult(B);const P=x.providerId;if(!P||P===A.p.PASSWORD)return null;let z;switch(P){case A.p.GOOGLE:z=A.X;break;case A.p.FACEBOOK:z=A.W;break;case A.p.GITHUB:z=A.Y;break;case A.p.TWITTER:z=A.$;break;default:const{oauthIdToken:te,oauthAccessToken:de,oauthTokenSecret:Ce,pendingToken:Te,nonce:He}=x;return de||Ce||te||Te?Te?P.startsWith("saml.")?A.aQ._create(P,Te):A.N._fromParams({providerId:P,signInMethod:P,pendingToken:Te,idToken:te,accessToken:de}):new A.Z(P).credential({idToken:te,accessToken:de,rawNonce:He}):null}return B instanceof ye.ZR?z.credentialFromError(B):z.credentialFromResult(B)}function Ke(B,x){return x.catch(P=>{throw P instanceof ye.ZR&&function he(B,x){var P;const z=null===(P=x.customData)||void 0===P?void 0:P._tokenResponse;if("auth/multi-factor-auth-required"===x?.code)x.resolver=new yr(B,A.as(B,x));else if(z){const te=pn(x),de=x;te&&(de.credential=te,de.tenantId=z.tenantId||void 0,de.email=z.email||void 0,de.phoneNumber=z.phoneNumber||void 0)}}(B,P),P}).then(P=>{const te=P.user;return{operationType:P.operationType,credential:zr(P),additionalUserInfo:A.aq(P),user:fe.getOrCreate(te)}})}function Ve(B,x){return ue.apply(this,arguments)}function ue(){return(ue=(0,w.Z)(function*(B,x){const P=yield x;return{verificationId:P.verificationId,confirm:z=>Ke(B,P.confirm(z))}})).apply(this,arguments)}class yr{constructor(x,P){this.resolver=P,this.auth=function Ei(B){return B.wrapped()}(x)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(x){return Ke($o(this.auth),this.resolver.resolveSignIn(x))}}class fe{constructor(x){this._delegate=x,this.multiFactor=A.at(x)}static getOrCreate(x){return fe.USER_MAP.has(x)||fe.USER_MAP.set(x,new fe(x)),fe.USER_MAP.get(x)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(x){return this._delegate.getIdTokenResult(x)}getIdToken(x){return this._delegate.getIdToken(x)}linkAndRetrieveDataWithCredential(x){return this.linkWithCredential(x)}linkWithCredential(x){var P=this;return(0,w.Z)(function*(){return Ke(P.auth,A.a2(P._delegate,x))})()}linkWithPhoneNumber(x,P){var z=this;return(0,w.Z)(function*(){return Ve(z.auth,A.l(z._delegate,x,P))})()}linkWithPopup(x){var P=this;return(0,w.Z)(function*(){return Ke(P.auth,A.d(P._delegate,x,Cn))})()}linkWithRedirect(x){var P=this;return(0,w.Z)(function*(){return yield Ti(A.aJ(P.auth)),A.g(P._delegate,x,Cn)})()}reauthenticateAndRetrieveDataWithCredential(x){return this.reauthenticateWithCredential(x)}reauthenticateWithCredential(x){var P=this;return(0,w.Z)(function*(){return Ke(P.auth,A.a3(P._delegate,x))})()}reauthenticateWithPhoneNumber(x,P){return Ve(this.auth,A.r(this._delegate,x,P))}reauthenticateWithPopup(x){return Ke(this.auth,A.e(this._delegate,x,Cn))}reauthenticateWithRedirect(x){var P=this;return(0,w.Z)(function*(){return yield Ti(A.aJ(P.auth)),A.h(P._delegate,x,Cn)})()}sendEmailVerification(x){return A.ag(this._delegate,x)}unlink(x){var P=this;return(0,w.Z)(function*(){return yield A.ap(P._delegate,x),P})()}updateEmail(x){return A.al(this._delegate,x)}updatePassword(x){return A.am(this._delegate,x)}updatePhoneNumber(x){return A.u(this._delegate,x)}updateProfile(x){return A.ak(this._delegate,x)}verifyBeforeUpdateEmail(x,P){return A.ah(this._delegate,x,P)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}fe.USER_MAP=new WeakMap;const un=A.aC;let ke=(()=>{class B{constructor(P,z){if(this.app=P,z.isInitialized())return this._delegate=z.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:te}=P.options;un(te,"invalid-api-key",{appName:P.name}),un(te,"invalid-api-key",{appName:P.name});const de=typeof window<"u"?Cn:void 0;this._delegate=z.initialize({options:{persistence:mn(te,P.name),popupRedirectResolver:de}}),this._delegate._updateErrorMap(A.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?fe.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(P){this._delegate.languageCode=P}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(P){this._delegate.tenantId=P}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(P,z){A.K(this._delegate,P,z)}applyActionCode(P){return A.a7(this._delegate,P)}checkActionCode(P){return A.a8(this._delegate,P)}confirmPasswordReset(P,z){return A.a6(this._delegate,P,z)}createUserWithEmailAndPassword(P,z){var te=this;return(0,w.Z)(function*(){return Ke(te._delegate,A.aa(te._delegate,P,z))})()}fetchProvidersForEmail(P){return this.fetchSignInMethodsForEmail(P)}fetchSignInMethodsForEmail(P){return A.af(this._delegate,P)}isSignInWithEmailLink(P){return A.ad(this._delegate,P)}getRedirectResult(){var P=this;return(0,w.Z)(function*(){un(Y(),P._delegate,"operation-not-supported-in-this-environment");const z=yield A.j(P._delegate,Cn);return z?Ke(P._delegate,Promise.resolve(z)):{credential:null,user:null}})()}addFrameworkForLogging(P){!function fn(B,x){(0,A.aJ)(B)._logFramework(x)}(this._delegate,P)}onAuthStateChanged(P,z,te){const{next:de,error:Ce,complete:Te}=X(P,z,te);return this._delegate.onAuthStateChanged(de,Ce,Te)}onIdTokenChanged(P,z,te){const{next:de,error:Ce,complete:Te}=X(P,z,te);return this._delegate.onIdTokenChanged(de,Ce,Te)}sendSignInLinkToEmail(P,z){return A.ac(this._delegate,P,z)}sendPasswordResetEmail(P,z){return A.a5(this._delegate,P,z||void 0)}setPersistence(P){var z=this;return(0,w.Z)(function*(){let te;switch(function vi(B,x){Be(Object.values(j).includes(x),B,"invalid-persistence-type"),(0,ye.b$)()?Be(x!==j.SESSION,B,"unsupported-persistence-type"):(0,ye.UG)()?Be(x===j.NONE,B,"unsupported-persistence-type"):xe()?Be(x===j.NONE||x===j.LOCAL&&(0,ye.hl)(),B,"unsupported-persistence-type"):Be(x===j.NONE||ot(),B,"unsupported-persistence-type")}(z._delegate,P),P){case j.SESSION:te=A.a;break;case j.LOCAL:te=(yield A.aE(A.i)._isAvailable())?A.i:A.b;break;case j.NONE:te=A.U;break;default:return A.ax("argument-error",{appName:z._delegate.name})}return z._delegate.setPersistence(te)})()}signInAndRetrieveDataWithCredential(P){return this.signInWithCredential(P)}signInAnonymously(){return Ke(this._delegate,A.a0(this._delegate))}signInWithCredential(P){return Ke(this._delegate,A.a1(this._delegate,P))}signInWithCustomToken(P){return Ke(this._delegate,A.a4(this._delegate,P))}signInWithEmailAndPassword(P,z){return Ke(this._delegate,A.ab(this._delegate,P,z))}signInWithEmailLink(P,z){return Ke(this._delegate,A.ae(this._delegate,P,z))}signInWithPhoneNumber(P,z){return Ve(this._delegate,A.s(this._delegate,P,z))}signInWithPopup(P){var z=this;return(0,w.Z)(function*(){return un(Y(),z._delegate,"operation-not-supported-in-this-environment"),Ke(z._delegate,A.c(z._delegate,P,Cn))})()}signInWithRedirect(P){var z=this;return(0,w.Z)(function*(){return un(Y(),z._delegate,"operation-not-supported-in-this-environment"),yield Ti(z._delegate),A.f(z._delegate,P,Cn)})()}updateCurrentUser(P){return this._delegate.updateCurrentUser(P)}verifyPasswordResetCode(P){return A.a9(this._delegate,P)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return B.Persistence=j,B})();function X(B,x,P){let z=B;"function"!=typeof B&&({next:z,error:x,complete:P}=B);const te=z;return{next:Ce=>te(Ce&&fe.getOrCreate(Ce)),error:x,complete:P}}function mn(B,x){const P=function vs(B,x){const P=Gr();if(!P)return[];const z=A.aF(Ii,B,x);switch(P.getItem(z)){case j.NONE:return[A.U];case j.LOCAL:return[A.i,A.a];case j.SESSION:return[A.a];default:return[]}}(B,x);if(typeof self<"u"&&!P.includes(A.i)&&P.push(A.i),typeof window<"u")for(const z of[A.b,A.a])P.includes(z)||P.push(z);return P.includes(A.U)||P.push(A.U),P}class Ir{constructor(){this.providerId="phone",this._delegate=new A.P($o(ae.Z.auth()))}static credential(x,P){return A.P.credential(x,P)}verifyPhoneNumber(x,P){return this._delegate.verifyPhoneNumber(x,P)}unwrap(){return this._delegate}}Ir.PHONE_SIGN_IN_METHOD=A.P.PHONE_SIGN_IN_METHOD,Ir.PROVIDER_ID=A.P.PROVIDER_ID;const gn=A.aC;class Zo{constructor(x,P,z=ae.Z.app()){var te;gn(null===(te=z.options)||void 0===te?void 0:te.apiKey,"invalid-api-key",{appName:z.name}),this._delegate=new A.R(z.auth(),x,P),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Qo(B){B.INTERNAL.registerComponent(new Ze.wA("auth-compat",x=>{const P=x.getProvider("app-compat").getImmediate(),z=x.getProvider("auth");return new ke(P,z)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:A.A.EMAIL_SIGNIN,PASSWORD_RESET:A.A.PASSWORD_RESET,RECOVER_EMAIL:A.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:A.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:A.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:A.A.VERIFY_EMAIL}},EmailAuthProvider:A.V,FacebookAuthProvider:A.W,GithubAuthProvider:A.Y,GoogleAuthProvider:A.X,OAuthProvider:A.Z,SAMLAuthProvider:A._,PhoneAuthProvider:Ir,PhoneMultiFactorGenerator:A.m,RecaptchaVerifier:Zo,TwitterAuthProvider:A.$,Auth:ke,AuthCredential:A.L,Error:ye.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),B.registerVersion("@firebase/auth-compat","0.5.12")}(ae.Z)}}]);